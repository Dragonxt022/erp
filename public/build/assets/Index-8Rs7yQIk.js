import{L as N}from"./LayoutFranqueado-DpJwz_I1.js";import{o as s,e as a,h,a as e,t as m,l as E,d as f,m as T,j as S,s as j,F as P,g as U,b as y,f as $,k as R,v as A,u as z,c as B,w as Q,Z as O}from"./app-BzqJKBn-.js";import{_ as K}from"./LabelModel-aEgYjVhV.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as G}from"./InputModel-xnoKagCT.js";import{B as H}from"./ButtonCancelar-TM9_EmN_.js";import{B as M}from"./ButtonPrimaryMedio-CmGm7hhn.js";import{d as J}from"./index-DfCrRVvi.js";import"./user-CeF2F2D8.js";const Z={class:"login-btn-text w-full"},W=["src"],X={class:"text-center text-[15px] font-semibold font-['Figtree'] leading-tight"},Y={__name:"ButtonPrimaryCarrinho",props:{text:{type:String,default:"Label"},iconPath:{type:String,required:!1}},setup(r){return(i,c)=>(s(),a("button",Z,[r.iconPath?(s(),a("img",{key:0,src:r.iconPath,alt:"icon",class:"h-6 w-6 mr-2"},null,8,W)):h("",!0),e("span",X,m(r.text),1)]))}},ee=C(Y,[["__scopeId","data-v-75ecbfc3"]]),oe={key:0,class:"elemento-fixo"},te={class:"mb-6 relative"},re={class:"relative"},se=["disabled"],ae=["value"],ne={class:"w-full h-[150px] bg-white rounded-[20px] p-12"},ie={class:"relative w-full h-full"},de={class:"flex items-center"},le={class:"w-1/1 flex justify-center"},ce=["src"],ue={class:"w-2/3 pl-5"},pe={class:"text-[#262a27] text-[28px] font-bold font-['Figtree'] leading-[30px] tracking-tight"},fe={key:0,class:"mt-8"},me={class:"min-w-full table-auto"},ve={class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tr-2xl"},xe={key:0,class:"text-center"},ge={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},he={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},_e={key:2,class:"text-center"},ye={class:"mt-12"},be={class:"up w-full h-[18.63px] text-[#6d6d6d] text-[15px] font-semibold font-['Figtree'] leading-tight mt-3 mb-3"},we={class:"mt-5 flex gap-2"},ke={__name:"DetalhesProdutoPedidos",props:{produto:{type:Object,required:!0}},emits:["adicionarAoCarrinho"],setup(r,{emit:i}){const c=E(),v=r,n=f({precos:[]}),x=i,p=f(!1),_=f(!1),b=f(!1),w=f([]),u=f(""),g=f(""),F=()=>{x("finalizar")},q=()=>{if(!u.value){c.warning("Por favor, selecione o fornecedor!");return}if(!g.value){c.warning("É necessário informar uma quantidade!");return}if(!n.value||!n.value.precos){c.error("Houve um erro com o produto, tente novamente ou chame o suporte.");return}const o=n.value.precos.find(L=>L.fornecedor_id===u.value);if(!o){c.warning("Este fornecedor não está disponível no momento!");return}const t=w.value.find(L=>L.id===u.value),l=o?o.preco_unitario:0,k={id:n.value.id,nome:n.value.nome,unidadeDeMedida:n.value.unidadeDeMedida,fornecedorId:u.value,nomeFornecedor:t?t.razao_social:"Fornecedor desconhecido",quantidade:parseFloat(g.value),preco:l};x("adicionarAoCarrinho",k),c.success("Item adicionado a sua lista de pedido."),g.value="",b.value=!0};(async()=>{try{const o=await R.get("/api/estoque/fornecedores");w.value=o.data.data.map(t=>({id:t.id||"N/D",razao_social:t.razao_social||"N/D"}))}catch(o){console.error("Erro ao carregar fornecedores:",o)}})();const I=o=>(o/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),D=async()=>{p.value=!0;try{if(v.produto&&v.produto.id){const t=(await R.get("/api/produtos/lista")).data;n.value=t.find(l=>l.id===v.produto.id)||{}}}catch(o){console.error("Erro ao buscar o produto:",o)}finally{p.value=!1}},d=o=>o?new URL(o,window.location.origin).href:"/storage/images/no_imagem.svg";return T(()=>v.produto,()=>{D()},{immediate:!0}),(o,t)=>_.value?h("",!0):(s(),a("div",oe,[e("div",null,[t[3]||(t[3]=e("h3",{class:"text-xl font-bold mb-4 text-gray-500"}," Enviar pedido para o fornecedor ",-1)),e("div",te,[e("div",re,[S(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),id:"fornecedor",disabled:b.value,class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-green-600 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[t[2]||(t[2]=e("option",{value:"",disabled:""},"Selecione um fornecedor",-1)),(s(!0),a(P,null,U(w.value,l=>(s(),a("option",{key:l.id,value:l.id},m(l.razao_social),9,ae))),128))],8,se),[[j,u.value]])])])]),e("div",ne,[e("div",ie,[e("div",de,[e("div",le,[e("img",{src:d(r.produto.profile_photo),alt:"Foto do Produto",class:"w-20 h-20 rounded-md shadow-lg"},null,8,ce)]),e("div",ue,[e("div",pe,m(r.produto.nome||"N/A"),1)])])])]),_.value?h("",!0):(s(),a("div",fe,[y(K,{text:"valor por fornecedor",class:"tracking-wider uppercase"}),e("table",me,[e("thead",null,[e("tr",null,[t[4]||(t[4]=e("th",{class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tl-2xl"}," Fornecedor ",-1)),e("th",ve," Preço "+m(r.produto.unidadeDeMedida==="unitario"?"Por Unidade":"Por Kg"),1)])]),e("tbody",null,[p.value?(s(),a("tr",xe,t[5]||(t[5]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},[e("div",{class:"flex justify-center items-center"},[e("svg",{class:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]),$(" Carregando... ")])],-1)]))):n.value.precos&&n.value.precos.length>0?(s(!0),a(P,{key:1},U(n.value.precos,(l,k)=>(s(),a("tr",{key:k,class:"text-center"},[e("td",ge,m(l.fornecedor),1),e("td",he,m(I(l.preco_unitario)),1)]))),128)):(s(),a("tr",_e,t[6]||(t[6]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"}," Nenhum preço disponível para este produto. ",-1)])))])])])),e("div",ye,[e("label",be,m(r.produto.unidadeDeMedida==="unitario"?"Unitario":"A Granel"),1),y(G,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l)},null,8,["modelValue"])]),e("div",we,[y(ee,{disabled:p.value,text:"adicionar ao carrinho",iconPath:"/storage/images/carrinho.svg",onClick:q,class:"uppercase"},null,8,["disabled"]),y(M,{class:"w-full",text:"Finalizar Pedido",iconPath:"/storage/images/arrow_left_alt.svg",onClick:F})])]))}},$e=C(ke,[["__scopeId","data-v-a3ada7df"]]),Pe={data(){return{produtos:[],searchQuery:""}},mounted(){this.fetchProdutos()},methods:{async fetchProdutos(){try{const r=await R.get("/api/produtos/lista");console.log("Produtos carregados:",r.data),this.produtos=Object.values(r.data)}catch(r){console.error("Erro ao carregar os produtos:",r)}},getProfilePhotoUrl(r){return r?new URL(r,window.location.origin).href:"/storage/images/no_imagem.svg"},selecionarProduto(r){this.$emit("produto-selecionado",r)}},computed:{filteredProdutos(){const r=this.searchQuery.toLowerCase();return this.produtos.filter(i=>i.nome.toLowerCase().includes(r))}}},Ce={class:"search-container relative flex items-center w-full mb-4"},Fe={class:"card-container compromissos-container overflow-hidden"},qe=["onClick"],De={class:"card-inner"},Ue={class:"icon-container"},Ie={class:"icon-leaf"},Le=["src"],Be={class:"text-container flex justify-between items-center p-2"},Re={class:"city"};function Se(r,i,c,v,n,x){return s(),a("div",null,[i[3]||(i[3]=e("div",{class:"painel-title"},"Novo pedido",-1)),i[4]||(i[4]=e("div",{class:"painel-subtitle"},[e("p",null,"Efetuar novo pedido de insumos com fornecedor")],-1)),e("div",Ce,[i[1]||(i[1]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),S(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=p=>n.searchQuery=p),placeholder:"Buscar um produto",class:"search-input pl-10 w-full py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[A,n.searchQuery]])]),e("div",Fe,[(s(!0),a(P,null,U(x.filteredProdutos,p=>(s(),a("div",{key:p.id,class:"card cursor-pointer transform transition-transform duration-200 hover:shadow-lg",onClick:_=>x.selecionarProduto(p)},[e("div",De,[e("div",Ue,[i[2]||(i[2]=e("div",{class:"icon-bg"},null,-1)),e("div",Ie,[e("img",{src:x.getProfilePhotoUrl(p.profile_photo),alt:"Imagem do produto",class:"w-12 h-12 rounded-lg"},null,8,Le)])]),e("div",Be,[e("div",Re,m(p.nome),1)])])],8,qe))),128))])])}const Ve=C(Pe,[["render",Se],["__scopeId","data-v-c47b3520"]]),Ee={class:"flex gap-5"},Ae={key:0,class:"loading-overlay"},ze={class:"flex-1"},Me={class:"mt-[20%] text-[#6d6d6d] text-[18px] font-normal font-['Figtree'] leading-[23px] tracking-tight"},Ne={class:"text-[#6db631] text-xl font-bold font-['Figtree'] leading-[25px] tracking-tight mt-12"},Te={class:"flex-1"},je={class:"min-w-full table-auto"},Qe=["onDblclick"],Oe={class:"px-6 py-4 text-[16px] text-left text-gray-500 font-semibold"},Ke={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-center"},Ge=["onUpdate:modelValue"],He={key:1},Je={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-left"},Ze={class:"px-6 py-4 text-[16px] text-gray-500 text-center font-semibold"},We={class:"px-6 py-4 text-center"},Xe=["onClick"],Ye={class:"bg-[#e4f6de]"},eo={class:"px-6 py-4 text-[16px] text-center text-gray-500 font-semibold"},oo={key:0,class:"botao-container"},to={__name:"ResumoCarrinhoPedidos",props:{carrinho:{type:Array,required:!0}},emits:["confirmar","cancelar"],setup(r,{emit:i}){var D;const c=E(),v=r,n=i,x=f(!1),p=f(!1),_=f(null),b=((D=v.carrinho[0])==null?void 0:D.nomeFornecedor)||"Sem fornecedor",w=d=>{v.carrinho.splice(d,1),c.info("Item removido com sucesso!")},u=d=>{_.value=d},g=d=>(d.preco||0)/100,F=d=>(d.quantidade||0)*(d.preco||0)/100,q=()=>v.carrinho.reduce((d,o)=>d+(o.quantidade||0)*(o.preco||0)/100,0),V=async()=>{x.value=!0,p.value=!0;try{const d={itens:v.carrinho.map(t=>({fornecedor_id:t.fornecedorId,id:t.id,nome:t.nome,nomeFornecedor:t.nomeFornecedor,quantidade:t.quantidade,valor_unitario:t.preco,valor_total_item:F(t),unidadeDeMedida:t.unidadeDeMedida})),valor_total_carrinho:q(),nomePrimeiroFornecedor:b};console.log("Dados a ser enviado:",JSON.stringify(d,null,2));const o=await axios.post("/api/estoque/criar-pedido",d);o.status===201?(console.log("Resposta da API:",o.data),c.success("Lista de itens está sendo enviada."),J.Inertia.visit(route("franqueado.inventario"))):c.error("Erro ao enviar os itens.")}catch(d){console.error("Erro ao enviar:",d),c.error("Erro ao confirmar o envio. Tente novamente ou chame o suporte.")}finally{x.value=!1}},I=()=>{n("cancelar")};return(d,o)=>(s(),a("div",Ee,[x.value?(s(),a("div",Ae,o[0]||(o[0]=[e("div",{class:"spinner"},null,-1)]))):h("",!0),e("div",ze,[o[2]||(o[2]=e("div",{class:"painel-title"},"Confirmar pedido",-1)),o[3]||(o[3]=e("div",{class:"painel-subtitle"},[e("p",null,"Verifique seu pedido antes de enviar")],-1)),e("div",Me,[o[1]||(o[1]=e("p",null,[$(" Verifique se o seu pedido "),e("br"),$(" está correto antes de enviar "),e("br"),$(" para o fornecedor ")],-1)),e("span",Ne,m(z(b)||"Fornecedor desconhecido")+". ",1)]),o[4]||(o[4]=e("div",{class:"mt-[20%] text-[#ff2d55] text-[15px] font-normal font-['Figtree'] leading-[18px] tracking-tight"},[e("p",null,[$(" * valor atualizado semanalmente, "),e("br"),$(" podendo sofrer alterações, confirme "),e("br"),$(" com o fornecedor no ato do envio do pedido. ")])],-1))]),e("div",Te,[e("table",je,[o[8]||(o[8]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-xs text-left font-medium text-gray-500 uppercase tracking-wider TrRedonEsquerda"}," Item "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," QTD. "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," V. UN/KG "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," TOTAL "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider TrRedonDireita"}," AÇÃO ")])],-1)),e("tbody",null,[(s(!0),a(P,null,U(r.carrinho,(t,l)=>(s(),a("tr",{key:t.id,onDblclick:k=>u(l)},[e("td",Oe,m(t.nome),1),e("td",Ke,[_.value===l?S((s(),a("input",{key:0,type:"number","onUpdate:modelValue":k=>t.quantidade=k,class:"border border-gray-300 rounded px-2 py-1 w-16"},null,8,Ge)),[[A,t.quantidade,void 0,{number:!0}]]):(s(),a("span",He,m(t.quantidade)+" "+m(t.unidadeDeMedida==="a_granel"?"KG":"UN"),1))]),e("td",Je," R$ "+m(g(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",Ze," R$ "+m(F(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",We,[e("button",{onClick:k=>w(l),class:"w-[16] h-[16]"},o[5]||(o[5]=[e("img",{src:"/storage/images/delete.svg",alt:"icone de excluir",class:"w-[16px] h-[16px]"},null,-1)]),8,Xe)])],40,Qe))),128)),e("tr",Ye,[o[6]||(o[6]=e("td",{class:"px-6 py-8 text-[16px] text-left text-gray-500 font-semibold",colspan:"3"}," Total do Pedido ",-1)),e("td",eo," R$ "+m(q(d.item).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),o[7]||(o[7]=e("td",null,null,-1))])])]),p.value?h("",!0):(s(),a("div",oo,[y(H,{text:"Voltar",onClick:I}),y(M,{text:"Confirmar",onClick:V})]))])]))}},ro=C(to,[["__scopeId","data-v-672780cc"]]),so={key:0,class:"mt-6"},ao={class:"grid grid-cols-1 gap-[3rem] mt-3 sm:grid-cols-2 card-container h-full overflow-hidden"},no={key:0},io={class:"flex flex-col gap-4"},lo={__name:"Index",setup(r){const i=f([]),c=f(null),v=f(0),n=f(!1);f(!1);const x=()=>{n.value=!n.value},p=u=>{i.value.push(u)},_=()=>{console.log("atualizando a lista"),c.value=null,v.value+=1},b=()=>{var g;(g=f("listarUnidades").value)==null||g.fetchUnidades()},w=u=>{u&&typeof u=="object"?c.value=u:console.warn("Dados inválidos recebidos no evento produto-selecionado:",u)};return(u,g)=>(s(),B(N,null,{default:Q(()=>[y(z(O),{title:"Novo Pedido"}),n.value?(s(),a("div",so,[y(ro,{carrinho:i.value,isVisible:n.value,onCancelar:x},null,8,["carrinho","isVisible"])])):h("",!0),e("div",ao,[n.value?h("",!0):(s(),a("div",no,[(s(),B(Ve,{key:v.value,ref:"listarUnidades",onUnidadeCadastrada:b,onProdutoSelecionado:w}))])),e("div",io,[n.value?h("",!0):(s(),a(P,{key:0},[c.value?(s(),B($e,{key:0,onAtualizar:_,produto:c.value,onFinalizar:x,onAdicionarAoCarrinho:p},null,8,["produto"])):h("",!0)],64))])])]),_:1}))}},_o=C(lo,[["__scopeId","data-v-b1c0aaaf"]]);export{_o as default};
