import{d as n,j as Z,i as j,$ as I,e as g,o as d,a as e,b as k,t as o,n as h,w as R,f as $,F as A,h as L,s as W,k as C,c as G,u as H,Z as J}from"./app-DJ-haiWO.js";import{C as U,r as K}from"./chart-lMt0pmU3.js";import{A as Q}from"./LayoutFranqueadora-DVPV_mct.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as X}from"./CalendarSimples2-BLhH6dB7.js";import"./dayjs.min-CJrrStcH.js";import"./pt-br-QAGhE_E_.js";const Y={class:"relative inline-block w-full"},ee={class:"flex items-center gap-2"},te={class:"text-gray-900 text-[15px] font-semibold"},se={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ae=["onClick"],oe={class:"font-semibold text-[15px]"},ne={class:"text-xs text-gray-500"},ie={key:0,class:"px-4 py-6 text-center text-gray-500 text-sm"},re={key:1,class:"px-4 py-6 text-center text-gray-500 text-sm"},le={__name:"UnidadeSelectorDropdown",emits:["unit-selected"],setup(P,{emit:_}){const v=_,m=n(!1),c=n([]),l=n(null),p=n(!1),b=Z(()=>{if(l.value===null)return"Todas as Unidades";const t=c.value.find(r=>r.id===l.value);return t?t.cidade:"Selecione uma unidade"}),y=()=>{m.value=!m.value},x=t=>{l.value=t,m.value=!1,v("unit-selected",t)},w=async()=>{p.value=!0;try{const t=await C.get("/api/admin/painel/unidades");c.value=t.data.unidades||[]}catch(t){console.error("Erro ao buscar unidades:",t)}finally{p.value=!1}},f=t=>{t.target.closest(".relative")||(m.value=!1)};return j(()=>{w(),document.addEventListener("click",f)}),I(()=>{document.removeEventListener("click",f)}),(t,r)=>(d(),g("div",Y,[e("button",{onClick:y,class:"w-full bg-white border border-gray-300 rounded-lg px-4 py-2 text-left flex items-center justify-between hover:border-gray-400 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"},[e("div",ee,[r[1]||(r[1]=e("img",{src:"/storage/images/store.svg",alt:"Unidade",class:"w-5 h-5"},null,-1)),e("span",te,o(b.value),1)]),(d(),g("svg",{class:h(["w-5 h-5 text-gray-500 transition-transform",{"rotate-180":m.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[2]||(r[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),k(W,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:R(()=>[m.value?(d(),g("div",se,[e("button",{onClick:r[0]||(r[0]=u=>x(null)),class:h(["w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors flex items-center gap-3",{"bg-green-50 text-green-700":l.value===null,"text-gray-700":l.value!==null}])},[e("div",{class:h(["w-2 h-2 rounded-full",{"bg-green-500":l.value===null,"bg-gray-300":l.value!==null}])},null,2),r[3]||(r[3]=e("div",null,[e("p",{class:"font-semibold text-[15px]"},"Todas as Unidades"),e("p",{class:"text-xs text-gray-500"},"Dados agregados")],-1))],2),r[4]||(r[4]=e("div",{class:"border-t border-gray-200"},null,-1)),(d(!0),g(A,null,L(c.value,u=>(d(),g("button",{key:u.id,onClick:D=>x(u.id),class:h(["w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors flex items-center gap-3",{"bg-green-50 text-green-700":l.value===u.id,"text-gray-700":l.value!==u.id}])},[e("div",{class:h(["w-2 h-2 rounded-full",{"bg-green-500":l.value===u.id,"bg-gray-300":l.value!==u.id}])},null,2),e("div",null,[e("p",oe,o(u.cidade),1),e("p",ne," ID: "+o(String(u.id).padStart(4,"0")),1)])],10,ae))),128)),c.value.length===0&&!p.value?(d(),g("div",ie," Nenhuma unidade encontrada ")):$("",!0),p.value?(d(),g("div",re," Carregando unidades... ")):$("",!0)])):$("",!0)]),_:1})]))}},de=E(le,[["__scopeId","data-v-3edbd73c"]]),ce={class:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4"},ue={class:"flex flex-col sm:flex-row gap-3 w-full md:w-auto"},ge={class:"w-full sm:w-64"},me={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},pe={class:"flex items-center space-x-2"},ve={class:"text-gray-900 text-[17px] font-semibold"},fe={key:0,class:"flex justify-center items-center py-20"},_e={key:1,class:"mt-5"},xe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},he={class:"md:row-span-3"},be={class:"bg-white rounded-lg p-5 h-full"},ye={class:"compromissos-container flex flex-col gap-3"},we={class:"flex flex-col flex-1"},ke={class:"text-[14px] font-medium text-gray-900"},$e={class:"text-sm text-gray-600"},Ce=["src","alt"],Fe={key:0,class:"text-center py-8 text-gray-500"},Se={class:"bg-white rounded-lg p-7"},De={class:"text-[#262a27] text-[40px] font-bold font-['Figtree'] leading-[48px] tracking-wide"},Ue={class:"flex items-center gap-2 mt-[35px]"},je={class:"w-6 h-6 rounded-full flex items-center justify-center"},Ie=["src"],Re={class:"text-[#6d6d6d] text-[13px] font-semibold font-['Figtree'] leading-[18px]"},Ae={class:"bg-white rounded-lg p-7"},Le={class:"text-[#262a27] text-[40px] font-bold font-['Figtree'] leading-[48px] tracking-wide"},Ee={class:"flex items-center gap-2 mt-[35px]"},Pe={class:"w-6 h-6 rounded-full flex items-center justify-center"},Te=["src"],qe={class:"text-[#6d6d6d] text-[13px] font-semibold font-['Figtree'] leading-[18px]"},Be={class:"bg-white rounded-lg p-7"},Ne={class:"text-[#262a27] text-[40px] font-bold font-['Figtree'] leading-[48px] tracking-wide"},Ve={class:"flex items-center gap-2 mt-[35px]"},Me={class:"w-6 h-6 rounded-full flex items-center justify-center"},ze=["src"],Oe={class:"text-[#6d6d6d] text-[13px] font-semibold font-['Figtree'] leading-[18px]"},Ze={class:"bg-white rounded-lg p-4"},We={class:"text-[#262a27] text-[40px] font-bold font-['Figtree'] leading-[48px] tracking-wide"},Ge={class:"flex items-center gap-2 mt-[35px]"},He={class:"w-6 h-6 rounded-full flex items-center justify-center"},Je=["src"],Ke={class:"text-[#6d6d6d] text-[13px] font-semibold font-['Figtree'] leading-[18px]"},Qe={class:"bg-white rounded-lg p-4 col-span-1 md:col-span-3"},Xe={class:"w-full h-[220px]"},Ye={__name:"Index",setup(P){U.register(...K);const _=n(null),v=n(null),m=n(!1),c=n(null),l=n(null),p=n(null),b=n("0,00"),y=n("0,00"),x=n("0,00"),w=n(0),f=n([]),t=n({faturamento:{percentage:0,direction:"neutral",formatted:"0%"},cmv:{percentage:0,direction:"neutral",formatted:"0%"},ticket_medio:{percentage:0,direction:"neutral",formatted:"0%"},pedidos:{percentage:0,direction:"neutral",formatted:"0%"}}),r=n([]),u=n([]),D=s=>{c.value=s,F()},T=s=>{l.value=s.start_date,p.value=s.end_date,F()},F=async()=>{m.value=!0;try{await Promise.all([q(),B(),N()])}catch(s){console.error("Erro ao buscar dados:",s)}finally{m.value=!1}},q=async()=>{try{const s=new URLSearchParams;c.value!==null&&s.append("unidade_id",c.value),l.value&&s.append("start_date",l.value),p.value&&s.append("end_date",p.value);const i=(await C.get(`/api/admin/painel/indicadores?${s.toString()}`)).data;b.value=i.faturamento||"0,00",y.value=i.cmv||"0,00",x.value=i.ticket_medio||"0,00",w.value=i.quantidade_pedidos||0,t.value=i.comparisons||t.value}catch(s){console.error("Erro ao buscar indicadores:",s)}},B=async()=>{try{const s=new URLSearchParams;c.value!==null&&s.append("unidade_id",c.value);const i=(await C.get(`/api/admin/painel/faturamento-diario?${s.toString()}`)).data;i.faturamento&&Array.isArray(i.faturamento)&&(u.value=i.faturamento.map(S=>S.dia),r.value=i.faturamento.map(S=>parseFloat(S.total)),V())}catch(s){console.error("Erro ao buscar faturamento diário:",s)}},N=async()=>{try{const s=new URLSearchParams;c.value!==null&&s.append("unidade_id",c.value);const a=await C.get(`/api/admin/painel/compromissos?${s.toString()}`);f.value=a.data.compromissos||[]}catch(s){console.error("Erro ao buscar compromissos:",s)}},V=()=>{v.value&&v.value.destroy(),_.value&&(v.value=new U(_.value.getContext("2d"),{type:"bar",data:{labels:u.value,datasets:[{label:"Faturamento Diário",data:r.value,backgroundColor:"rgba(75, 192, 75, 0.6)",borderColor:"rgba(75, 192, 75, 1)",borderWidth:2,borderRadius:8,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{enabled:!0,callbacks:{label:function(s){return"R$ "+s.parsed.y.toLocaleString("pt-BR",{minimumFractionDigits:2})}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(s){return s>=1e3?`${s/1e3}k`:s}}}}}}))},M=s=>{const a=s.split("-");return`${a[2]}/${a[1]}/${a[0]}`},z={pendente:"/storage/images/check_circle_laranja.svg",pago:"/storage/images/check_circle_verde.svg",agendada:"/storage/images/agendada.svg",atrasado:"/storage/images/atrasada.svg"},O=s=>z[s]||"/storage/images/check_circle_laranja.svg";return j(()=>{F()}),I(()=>{v.value&&v.value.destroy()}),(s,a)=>(d(),G(Q,null,{default:R(()=>[k(H(J),{title:"Painel"}),e("div",ce,[a[1]||(a[1]=e("div",null,[e("div",{class:"painel-title"},"Visão geral da franquia"),e("div",{class:"painel-subtitle"},[e("p",null,"Acompanhe o desempenho das unidades")])],-1)),e("div",ue,[e("div",ge,[k(de,{onUnitSelected:D})]),e("div",me,[e("div",pe,[a[0]||(a[0]=e("img",{src:"/storage/images/calendar_month.svg",alt:"Filtro",class:"w-5 h-5"},null,-1)),e("span",ve,[k(X,{onDateRangeSelected:T})])])])])]),m.value?(d(),g("div",fe,a[2]||(a[2]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"},null,-1)]))):(d(),g("div",_e,[e("div",xe,[e("div",he,[e("div",be,[a[4]||(a[4]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"}," Compromissos Próximos ",-1)),e("div",ye,[(d(!0),g(A,null,L(f.value,i=>(d(),g("div",{key:i.id,class:"flex justify-between items-center bg-[#F5FAF4] p-3 rounded-lg hover:bg-gray-100 transition-all cursor-pointer"},[e("div",we,[e("p",ke,o(i.nome),1),e("p",$e,o(i.valor_formatado)+" - Vence em "+o(M(i.vencimento)),1)]),e("div",null,[e("img",{src:O(i.status),alt:"Status: "+i.status,class:"w-6 h-6 object-contain"},null,8,Ce)])]))),128)),f.value.length===0?(d(),g("div",Fe,a[3]||(a[3]=[e("p",null,"Nenhum compromisso próximo",-1)]))):$("",!0)])])]),e("div",Se,[a[5]||(a[5]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Faturamento",-1)),e("div",De," R$ "+o(b.value),1),e("div",Ue,[e("div",je,[e("img",{src:t.value.faturamento.direction==="up"?"/storage/images/trending_up.svg":t.value.faturamento.direction==="down"?"/storage/images/trending_down.svg":"/storage/images/trending_neutral.svg",alt:"Tendência"},null,8,Ie)]),e("div",Re,o(t.value.faturamento.formatted)+" "+o(t.value.faturamento.direction==="up"?"maior":t.value.faturamento.direction==="down"?"menor":"igual")+" que no período anterior ",1)])]),e("div",Ae,[a[6]||(a[6]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"CMV",-1)),e("div",Le," R$ "+o(y.value),1),e("div",Ee,[e("div",Pe,[e("img",{src:t.value.cmv.direction==="up"?"/storage/images/trending_up.svg":t.value.cmv.direction==="down"?"/storage/images/trending_down.svg":"/storage/images/trending_neutral.svg",alt:"Tendência"},null,8,Te)]),e("div",qe,o(t.value.cmv.formatted)+" "+o(t.value.cmv.direction==="up"?"maior":t.value.cmv.direction==="down"?"menor":"igual")+" que no período anterior ",1)])]),e("div",Be,[a[7]||(a[7]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Ticket médio",-1)),e("div",Ne," R$ "+o(x.value),1),e("div",Ve,[e("div",Me,[e("img",{src:t.value.ticket_medio.direction==="up"?"/storage/images/trending_up.svg":t.value.ticket_medio.direction==="down"?"/storage/images/trending_down.svg":"/storage/images/trending_neutral.svg",alt:"Tendência"},null,8,ze)]),e("div",Oe,o(t.value.ticket_medio.formatted)+" "+o(t.value.ticket_medio.direction==="up"?"maior":t.value.ticket_medio.direction==="down"?"menor":"igual")+" que no período anterior ",1)])]),e("div",Ze,[a[8]||(a[8]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Pedidos",-1)),e("div",We,o(w.value),1),e("div",Ge,[e("div",He,[e("img",{src:t.value.pedidos.direction==="up"?"/storage/images/trending_up.svg":t.value.pedidos.direction==="down"?"/storage/images/trending_down.svg":"/storage/images/trending_neutral.svg",alt:"Tendência"},null,8,Je)]),e("div",Ke,o(t.value.pedidos.formatted)+" "+o(t.value.pedidos.direction==="up"?"maior":t.value.pedidos.direction==="down"?"menor":"igual")+" que no período anterior ",1)])]),e("div",Qe,[a[9]||(a[9]=e("h3",{class:"text-lg font-semibold text-gray-700"}," Faturamento diário ",-1)),e("div",Xe,[e("canvas",{ref_key:"barChart",ref:_},null,512)])])])]))]),_:1}))}},rt=E(Ye,[["__scopeId","data-v-098b83c5"]]);export{rt as default};
