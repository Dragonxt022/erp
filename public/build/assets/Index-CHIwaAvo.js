import{L as z}from"./LayoutFranqueado-BoPvO9rA.js";import{o as r,e as n,t as p,l as S,d as m,m as Q,a as e,j as B,s as j,F as P,g as D,b as h,f as q,h as _,k as I,v as A,u as M,c as V,w as O,Z as G}from"./app-KKwG3xn3.js";import{_ as K,I as H,B as T,a as N}from"./ButtonCancelar-kCZg2iD1.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CYHsVbzh.js";import"./user-CVPpoSeQ.js";const J={class:"login-btn-text"},Z={__name:"ButtonPrimaryCarrinho",props:{text:{type:String,default:"Label"}},setup(s){return(i,d)=>(r(),n("button",J,p(s.text),1))}},W={key:0,class:"elemento-fixo"},X={class:"mb-6 relative"},Y={class:"relative"},ee=["disabled"],te=["value"],oe={class:"w-full h-[150px] bg-white rounded-[20px] p-12"},se={class:"relative w-full h-full"},re={class:"flex items-center"},ae={class:"w-1/1 flex justify-center"},ne=["src"],ie={class:"w-2/3 pl-5"},de={class:"text-[#262a27] text-[28px] font-bold font-['Figtree'] leading-[30px] tracking-tight"},le={key:0,class:"mt-8"},ce={class:"min-w-full table-auto"},ue={class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tr-2xl"},pe={key:0,class:"text-center"},fe={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},me={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},ve={key:2,class:"text-center"},xe={class:"mt-12"},ge={class:"up w-full h-[18.63px] text-[#6d6d6d] text-[15px] font-semibold font-['Figtree'] leading-tight mt-3 mb-3"},_e={class:"mt-5 flex gap-4"},he={__name:"DetalhesProdutoPedidos",props:{produto:{type:Object,required:!0}},emits:["adicionarAoCarrinho"],setup(s,{emit:i}){const d=S(),v=s,a=m({precos:[]}),x=i,l=m(!1),y=m(!1),w=m(!1),k=m([]),g=m(""),f=m(""),b=()=>{x("finalizar")},C=()=>{if(!g.value){d.warning("Por favor, selecione o fornecedor!");return}if(!f.value){d.warning("É necessário informar uma quantidade!");return}if(!a.value||!a.value.precos){d.error("Houve um erro com o produto, tente novamente ou chame o suporte.");return}const o=a.value.precos.find(R=>R.fornecedor_id===g.value);if(!o){d.warning("Este fornecedor não está disponível no momento!");return}const t=k.value.find(R=>R.id===g.value),u=o?o.preco_unitario:0,$={id:a.value.id,nome:a.value.nome,unidadeDeMedida:a.value.unidadeDeMedida,fornecedorId:g.value,nomeFornecedor:t?t.razao_social:"Fornecedor desconhecido",quantidade:parseFloat(f.value),preco:u};x("adicionarAoCarrinho",$),d.success("Item adicionado a sua lista de pedido."),f.value="",w.value=!0};(async()=>{try{const o=await I.get("/api/estoque/fornecedores");k.value=o.data.data.map(t=>({id:t.id||"N/D",razao_social:t.razao_social||"N/D"}))}catch(o){console.error("Erro ao carregar fornecedores:",o)}})();const L=o=>(o/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),F=async()=>{l.value=!0;try{if(v.produto&&v.produto.id){const t=(await I.get("/api/produtos/lista")).data;a.value=t.find(u=>u.id===v.produto.id)||{}}}catch(o){console.error("Erro ao buscar o produto:",o)}finally{l.value=!1}},c=o=>o?new URL(o,window.location.origin).href:"/storage/images/no_imagem.svg";return Q(()=>v.produto,()=>{F()},{immediate:!0}),(o,t)=>y.value?_("",!0):(r(),n("div",W,[e("div",null,[t[3]||(t[3]=e("h3",{class:"text-xl font-bold mb-4 text-gray-500"}," Enviar pedido para o fornecedor ",-1)),e("div",X,[e("div",Y,[B(e("select",{"onUpdate:modelValue":t[0]||(t[0]=u=>g.value=u),id:"fornecedor",disabled:w.value,class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-green-600 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[t[2]||(t[2]=e("option",{value:"",disabled:""},"Selecione um fornecedor",-1)),(r(!0),n(P,null,D(k.value,u=>(r(),n("option",{key:u.id,value:u.id},p(u.razao_social),9,te))),128))],8,ee),[[j,g.value]])])])]),e("div",oe,[e("div",se,[e("div",re,[e("div",ae,[e("img",{src:c(s.produto.profile_photo),alt:"Foto do Produto",class:"w-20 h-20 rounded-md shadow-lg"},null,8,ne)]),e("div",ie,[e("div",de,p(s.produto.nome||"N/A"),1)])])])]),y.value?_("",!0):(r(),n("div",le,[h(K,{text:"valor por fornecedor",class:"tracking-wider uppercase"}),e("table",ce,[e("thead",null,[e("tr",null,[t[4]||(t[4]=e("th",{class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tl-2xl"}," Fornecedor ",-1)),e("th",ue," Preço "+p(s.produto.unidadeDeMedida==="unitario"?"Unitario":"A Granel"),1)])]),e("tbody",null,[l.value?(r(),n("tr",pe,t[5]||(t[5]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},[e("div",{class:"flex justify-center items-center"},[e("svg",{class:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]),q(" Carregando... ")])],-1)]))):a.value.precos&&a.value.precos.length>0?(r(!0),n(P,{key:1},D(a.value.precos,(u,$)=>(r(),n("tr",{key:$,class:"text-center"},[e("td",fe,p(u.fornecedor),1),e("td",me,p(L(u.preco_unitario)),1)]))),128)):(r(),n("tr",ve,t[6]||(t[6]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"}," Nenhum preço disponível para este produto. ",-1)])))])])])),e("div",xe,[e("label",ge,p(s.produto.unidadeDeMedida==="unitario"?"Unitario":"A Granel"),1),h(H,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=u=>f.value=u)},null,8,["modelValue"])]),e("div",_e,[h(T,{text:"Finalizar",onClick:b}),h(Z,{disabled:l.value,text:"adicionar ao carrinho",onClick:C,class:"uppercase"},null,8,["disabled"])])]))}},ye=U(he,[["__scopeId","data-v-3677cbea"]]),be={data(){return{produtos:[],searchQuery:""}},mounted(){this.fetchProdutos()},methods:{async fetchProdutos(){try{const s=await I.get("/api/estoque/lista");console.log("Produtos carregados:",s.data),this.produtos=Object.values(s.data)}catch(s){console.error("Erro ao carregar os produtos:",s)}},getProfilePhotoUrl(s){return s?new URL(s,window.location.origin).href:"/storage/images/no_imagem.svg"},selecionarProduto(s){this.$emit("produto-selecionado",s)},getQuantidadeTotal(s){return s.reduce((i,d)=>i+d.quantidade,0)}},computed:{filteredProdutos(){const s=this.searchQuery.toLowerCase();return this.produtos.filter(i=>i.nome.toLowerCase().includes(s))}}},we={class:"search-container relative flex items-center w-full mb-4"},ke={class:"card-container"},$e=["onClick"],Pe={class:"card-inner"},Ce={class:"icon-container"},Fe={class:"icon-leaf"},qe=["src"],De={class:"text-container flex justify-between items-center p-2"},Ue={class:"city"},Le={class:"quantidade text-gray-600 font-semibold"},Re={class:"text-gray-600 font-semibold"};function Ve(s,i,d,v,a,x){return r(),n("div",null,[i[3]||(i[3]=e("div",{class:"painel-title"},"Novo pedido",-1)),i[4]||(i[4]=e("div",{class:"painel-subtitle"},[e("p",null,"Efetuar novo pedido de insumos com fornecedor")],-1)),e("div",we,[i[1]||(i[1]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),B(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=l=>a.searchQuery=l),placeholder:"Buscar um produto",class:"search-input pl-10 w-full py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[A,a.searchQuery]])]),e("div",ke,[(r(!0),n(P,null,D(x.filteredProdutos,l=>(r(),n("div",{key:l.id,class:"card cursor-pointer transform transition-transform duration-200 hover:shadow-lg",onClick:y=>x.selecionarProduto(l)},[e("div",Pe,[e("div",Ce,[i[2]||(i[2]=e("div",{class:"icon-bg"},null,-1)),e("div",Fe,[e("img",{src:x.getProfilePhotoUrl(l.profile_photo),alt:"Imagem do produto",class:"w-12 h-12 rounded-lg"},null,8,qe)])]),e("div",De,[e("div",Ue,p(l.nome),1),e("div",Le,[e("div",Re,p(x.getQuantidadeTotal(l.lotes))+" "+p(l.unidadeDeMedida==="unitario"?"uni":"kg"),1)])])])],8,$e))),128))])])}const Ie=U(be,[["render",Ve],["__scopeId","data-v-bce6f987"]]),Be={class:"flex gap-5"},Ee={key:0,class:"loading-overlay"},Se={class:"flex-1"},Ae={class:"mt-[20%] text-[#6d6d6d] text-[18px] font-normal font-['Figtree'] leading-[23px] tracking-tight"},Me={class:"text-[#6db631] text-xl font-bold font-['Figtree'] leading-[25px] tracking-tight mt-12"},Te={class:"flex-1"},Ne={class:"min-w-full table-auto"},ze=["onDblclick"],Qe={class:"px-6 py-4 text-[16px] text-left text-gray-500 font-semibold"},je={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-center"},Oe=["onUpdate:modelValue"],Ge={key:1},Ke={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-left"},He={class:"px-6 py-4 text-[16px] text-gray-500 text-center font-semibold"},Je={class:"px-6 py-4 text-center"},Ze=["onClick"],We={class:"bg-[#e4f6de]"},Xe={class:"px-6 py-4 text-[16px] text-center text-gray-500 font-semibold"},Ye={key:0,class:"botao-container"},et={__name:"ResumoCarrinhoPedidos",props:{carrinho:{type:Array,required:!0}},emits:["confirmar","cancelar"],setup(s,{emit:i}){var F;const d=S(),v=s,a=i,x=m(!1),l=m(!1),y=m(null),w=((F=v.carrinho[0])==null?void 0:F.nomeFornecedor)||"Sem fornecedor",k=c=>{v.carrinho.splice(c,1),d.info("Item removido com sucesso!")},g=c=>{y.value=c},f=c=>(c.preco||0)/100,b=c=>(c.quantidade||0)*(c.preco||0)/100,C=()=>v.carrinho.reduce((c,o)=>c+(o.quantidade||0)*(o.preco||0)/100,0),E=async()=>{x.value=!0;try{const c={itens:v.carrinho.map(t=>({fornecedor_id:t.fornecedorId,id:t.id,nome:t.nome,nomeFornecedor:t.nomeFornecedor,quantidade:t.quantidade,valor_unitario:t.preco,valor_total_item:b(t),unidadeDeMedida:t.unidadeDeMedida})),valor_total_carrinho:C(),nomePrimeiroFornecedor:w};console.log("Dados a ser enviado:",JSON.stringify(c,null,2));const o=await axios.post("/api/estoque/criar-pedido",c);o.status===201?(console.log("Resposta da API:",o.data),d.success("Lista de itens está sendo enviada.")):d.error("Erro ao enviar os itens.")}catch(c){console.error("Erro ao enviar:",c),d.error("Erro ao confirmar o envio. Tente novamente ou chame o suporte.")}finally{x.value=!1}},L=()=>{a("cancelar")};return(c,o)=>(r(),n("div",Be,[x.value?(r(),n("div",Ee,o[0]||(o[0]=[e("div",{class:"spinner"},null,-1)]))):_("",!0),e("div",Se,[o[2]||(o[2]=e("div",{class:"painel-title"},"Confirmar pedido",-1)),o[3]||(o[3]=e("div",{class:"painel-subtitle"},[e("p",null,"Verifique seu pedido antes de enviar")],-1)),e("div",Ae,[o[1]||(o[1]=e("p",null,[q(" Verifique se o seu pedido "),e("br"),q(" está correto antes de enviar "),e("br"),q(" para o fornecedor ")],-1)),e("span",Me,p(M(w)||"Fornecedor desconhecido")+". ",1)])]),e("div",Te,[e("table",Ne,[o[7]||(o[7]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-xs text-left font-medium text-gray-500 uppercase tracking-wider TrRedonEsquerda"}," Item "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," QTD. "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," V. UN/KG "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," TOTAL "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider TrRedonDireita"}," AÇÃO ")])],-1)),e("tbody",null,[(r(!0),n(P,null,D(s.carrinho,(t,u)=>(r(),n("tr",{key:t.id,onDblclick:$=>g(u)},[e("td",Qe,p(t.nome),1),e("td",je,[y.value===u?B((r(),n("input",{key:0,type:"number","onUpdate:modelValue":$=>t.quantidade=$,class:"border border-gray-300 rounded px-2 py-1 w-16"},null,8,Oe)),[[A,t.quantidade,void 0,{number:!0}]]):(r(),n("span",Ge,p(t.quantidade)+" "+p(t.unidadeDeMedida==="a_granel"?"KG":"UN"),1))]),e("td",Ke," R$ "+p(f(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",He," R$ "+p(b(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",Je,[e("button",{onClick:$=>k(u),class:"w-[16] h-[16]"},o[4]||(o[4]=[e("img",{src:"/storage/images/delete.svg",alt:"icone de excluir",class:"w-[16px] h-[16px]"},null,-1)]),8,Ze)])],40,ze))),128)),e("tr",We,[o[5]||(o[5]=e("td",{class:"px-6 py-8 text-[16px] text-left text-gray-500 font-semibold",colspan:"3"}," Total do Pedido ",-1)),e("td",Xe," R$ "+p(C(c.item).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),o[6]||(o[6]=e("td",null,null,-1))])])]),l.value?_("",!0):(r(),n("div",Ye,[h(T,{text:"Voltar",onClick:L}),h(N,{text:"Confirmar",onClick:E})]))])]))}},tt=U(et,[["__scopeId","data-v-bf575ae5"]]),ot={key:0,class:"mt-6"},st={class:"grid grid-cols-1 gap-[3rem] mt-3 sm:grid-cols-2 card-container h-full overflow-hidden"},rt={key:0},at={class:"flex flex-col gap-4"},nt={key:1,class:"absolute bottom-4 right-4"},it={__name:"Index",setup(s){const i=m([]),d=m(null),v=m(0),a=m(!1),x=m(!1),l=()=>{a.value=!a.value},y=f=>{i.value.push(f)},w=()=>{console.log("atualizando a lista"),d.value=null,v.value+=1},k=()=>{var b;(b=m("listarUnidades").value)==null||b.fetchUnidades()},g=f=>{f&&typeof f=="object"?d.value=f:console.warn("Dados inválidos recebidos no evento produto-selecionado:",f)};return(f,b)=>(r(),V(z,null,{default:O(()=>[h(M(G),{title:"Novo Pedido"}),a.value?(r(),n("div",ot,[h(tt,{carrinho:i.value,isVisible:a.value,onCancelar:l},null,8,["carrinho","isVisible"])])):_("",!0),e("div",st,[a.value?_("",!0):(r(),n("div",rt,[(r(),V(Ie,{key:v.value,ref:"listarUnidades",onUnidadeCadastrada:k,onProdutoSelecionado:g}))])),e("div",at,[a.value?_("",!0):(r(),n(P,{key:0},[d.value?(r(),V(ye,{key:0,onAtualizar:w,produto:d.value,onFinalizar:l,onAdicionarAoCarrinho:y},null,8,["produto"])):_("",!0),!a.value&&!d.value&&!x.value?(r(),n("div",nt,[h(N,{text:"Efetuar Pedido",iconPath:"/storage/images/arrow_left_alt.svg",onClick:l})])):_("",!0)],64))])])]),_:1}))}},mt=U(it,[["__scopeId","data-v-0c5a224a"]]);export{mt as default};
