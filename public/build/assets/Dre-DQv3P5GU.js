import{d as n,Q as O,i as G,j as T,c as W,o as l,w as H,b as D,a as e,e as r,f as R,u as Q,Z,F as u,h as g,t as d,n as q,k as K}from"./app-Dt5SICIA.js";import{A as X}from"./LayoutFranqueadora-Dm0gjYAB.js";import{p as Y}from"./chartjs-plugin-datalabels.esm-puCX0kls.js";import{C as P,A as ee,p as te,a as oe,D as se,P as ae,b as le,i as re}from"./chart-CQTgaRiN.js";import{_ as ne}from"./CalendarFilterDre-Cczv4hNs.js";import{U as de}from"./UnidadeSelectorDropdown-BuVs-1aV.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dayjs.min-CG72Gvm2.js";import"./pt-br-BQ0LdYk8.js";const ue={class:"flex flex-col md:flex-row justify-end items-center mb-4 gap-3"},ce={class:"w-full md:w-64"},me={class:"flex items-center"},pe={xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",style:{fill:"#018f7f",transform:"msfilter"}},ge={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},fe={class:"flex items-center space-x-2 justify-end"},ve={class:"text-gray-900 text-[17px] font-semibold"},_e={class:"mt-5"},he={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},xe={class:"rounded-lg bg-white overflow-hidden shadow-sm"},be={class:"w-full text-left text-[14px] border-collapse font-['Figtree']"},ye={key:0},we={key:1},$e={class:"bg-white"},ke={class:"px-5 py-2 text-right valores"},Ce={class:"bg-[#174111] text-white"},De={colspan:"2",class:"p-1 px-5"},Re={key:0},Fe={key:1},Ae={class:"p-1 px-5 categorias align-middle"},Se={class:"px-5 py-1 text-right valores"},Be={class:"bg-[#174111] text-white"},je={colspan:"1",class:"p-2 px-5 text-right font-bold"},Ne={class:"bg-white rounded-lg p-5 flex justify-center w-full min-h-[480px] shadow-sm"},Le={key:0,class:"flex items-center text-gray-400"},Pe={key:0,class:"mt-4 p-4 bg-green-100 text-green-800 rounded shadow-sm font-medium text-sm border-l-4 border-green-500"},ze={class:"mt-5"},Ee={class:"bg-white rounded-lg shadow-sm border overflow-hidden"},Me={class:"overflow-y-auto max-h-96 scroll-hidden"},Ue={class:"space-y-0"},Ve={key:0},Ie={class:"text-center text-gray-600 font-semibold align-middle"},Je={class:"text-center text-gray-600 font-medium align-middle"},Oe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ge={class:"bg-white rounded-lg max-w-xl p-8 shadow-xl relative animate-in fade-in zoom-in duration-200"},Te={class:"text-gray-700 leading-relaxed text-sm whitespace-pre-line max-h-[60vh] overflow-y-auto pr-2"},We={class:"mt-8 flex justify-end"},He={__name:"Dre",setup(Qe){const x=n("0,00"),F=n("0,00"),b=n("0,00"),y=n([]),i=n([]),A=n(""),c=n(!0),f=n(!1),z=O(),m=n(z.props.auth.user.unidade_id),S=n(""),B=n(""),E=n("pie");let p=null;const v=n([]),w=n([]),_=n([]),M=a=>{m.value=a,j(S.value,B.value)},U=a=>{S.value=a.startDate,B.value=a.endDate,j(a.startDate,a.endDate)},V=()=>{const a=m.value?`/relatorios/faturamento-anual?unidade_id=${m.value}`:"/relatorios/faturamento-anual";window.open(a,"_blank")},j=async(a,t)=>{if(m.value){c.value=!0;try{const s=(await K.get("/api/painel-dre/analitycs-dre",{params:{start_date:a,end_date:t,unidade_id:m.value}})).data;x.value=s.total_caixas||"0,00",F.value=s.total_salarios||"0,00",b.value=s.resultado_do_periodo||"0,00",y.value=s.grupos||[],i.value=s.calendario||[],A.value=s.explicacao_dre||"",w.value=s.grafico_data.labels||[],v.value=s.grafico_data.data||[],_.value=s.grafico_data.porcentagens||[],J()}catch(o){console.error("Erro ao buscar dados do DRE:",o),I()}finally{c.value=!1}}},I=()=>{x.value="0,00",F.value="0,00",b.value="0,00",y.value=[],i.value=[],w.value=[],v.value=[],_.value=[],p&&(p.destroy(),p=null)};P.register(ee,te,oe,se,ae,le,re,Y);const J=()=>{const a=document.getElementById("myChart");a&&(p&&p.destroy(),p=new P(a,{type:E.value,data:{labels:w.value,datasets:[{data:v.value,backgroundColor:["#6DB631","#FF9500","#FF2D55","#5856D6","#F7464A","#FF7F50"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(t){const o=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.raw),s=_.value[t.dataIndex];return`${t.label}: ${o} (${s})`}}},legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,boxWidth:10,font:{size:12}}},datalabels:{display:!0,color:"#fff",formatter:(t,o)=>{const s=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),h=_.value[o.dataIndex];return`${s}
(${h})`},font:{weight:"bold",size:10},anchor:"end",align:"start",offset:10}}}}))},$=a=>a?Number(a.replace(/\./g,"").replace(",",".")):0,N=G(()=>{if(!i.value||i.value.length===0)return"";const t=new Date().getMonth()+1,o=i.value.find(C=>C.nome_mes.toLowerCase()===L(t).toLowerCase()),s=i.value.find(C=>C.nome_mes.toLowerCase()===L(t-1).toLowerCase());if(!o)return"";const h=$(o.resultado_do_periodo),k=s?$(s.resultado_do_periodo):null;return k===null?`OlÃ¡! No mÃªs de ${o.nome_mes}, seu resultado foi de R$ ${o.resultado_do_periodo}. Vamos continuar assim! ðŸš€`:h>k?`Boa notÃ­cia! Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) melhorou em relaÃ§Ã£o a ${s.nome_mes} (R$ ${s.resultado_do_periodo}). Continue assim! ðŸŽ‰`:h<k?`AtenÃ§Ã£o: o resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) estÃ¡ abaixo do mÃªs anterior (${s.nome_mes} - R$ ${s.resultado_do_periodo}). Vamos analisar juntos para melhorar`:`Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) estÃ¡ estÃ¡vel em relaÃ§Ã£o a ${s.nome_mes}. Seguimos firmes! ðŸ‘`}),L=a=>{const t=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];let o=a;return o<1&&(o=12+o),o>12&&(o=o%12),t[o-1]};return T(()=>{}),(a,t)=>(l(),W(X,null,{default:H(()=>[D(Q(Z),{title:"Painel"}),t[14]||(t[14]=e("div",{class:"painel-title"},"DRE Gerencial",-1)),t[15]||(t[15]=e("div",{class:"painel-subtitle"},[e("p",null,"Acompanhe a saÃºde da operaÃ§Ã£o das unidades")],-1)),e("div",ue,[e("div",ce,[D(de,{"default-unit-id":m.value,onUnitSelected:M},null,8,["default-unit-id"])]),e("div",me,[e("button",{onClick:t[0]||(t[0]=o=>f.value=!0),class:"mr-2",title:"Ajuda a entender esses grÃ¡ficos!"},[(l(),r("svg",pe,t[3]||(t[3]=[e("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"},null,-1)])))]),e("button",{onClick:V,class:"mr-3 bg-[#174111] hover:bg-[#12330d] text-white font-bold py-1 px-3 rounded text-sm transition duration-300"}," Imprimir RelatÃ³rio Anual "),e("div",ge,[e("div",fe,[e("span",ve,[D(ne,{onUpdateFilters:U,"default-to-previous-month":!0})])])])])]),e("div",_e,[e("div",he,[e("div",xe,[e("table",be,[t[8]||(t[8]=e("thead",null,[e("tr",{class:"bg-[#174111] text-white"},[e("th",{colspan:"2",class:"p-1 px-5"},"Faturamento do PerÃ­odo")])],-1)),c.value?(l(),r("tbody",ye,[(l(),r(u,null,g(1,o=>e("tr",{key:o},t[4]||(t[4]=[e("td",{class:"p-1 px-5 flex items-center"},[e("div",{class:"shimmer h-6 w-full rounded"})],-1),e("td",{class:"p-1 px-5 text-right w-1/4"},[e("div",{class:"shimmer h-6 w-full rounded"})],-1)]))),64))])):(l(),r("tbody",we,[e("tr",$e,[t[5]||(t[5]=e("td",{class:"p-1 px-5 categorias"},"Faturamento do PerÃ­odo",-1)),e("td",ke," R$ "+d(x.value),1)])])),(l(!0),r(u,null,g(y.value,o=>(l(),r(u,{key:o.nome_grupo},[e("thead",null,[e("tr",Ce,[e("th",De,d(o.nome_grupo),1)])]),c.value?(l(),r("tbody",Re,[(l(!0),r(u,null,g(o.categorias.length||3,s=>(l(),r("tr",{key:s},t[6]||(t[6]=[e("td",{class:"p-1 px-5"},[e("div",{class:"shimmer h-6 w-full rounded"})],-1),e("td",{class:"p-1 px-5 text-right w-1/4"},[e("div",{class:"shimmer h-6 w-full rounded"})],-1)])))),128))])):(l(),r("tbody",Fe,[(l(!0),r(u,null,g(o.categorias,s=>(l(),r("tr",{key:s.categoria,class:"odd:bg-gray-100 even:bg-white p-1 px-5 transition-colors"},[e("td",Ae,d(s.categoria),1),e("td",Se," R$ "+d(s.total),1)]))),128))]))],64))),128)),e("thead",null,[e("tr",Be,[t[7]||(t[7]=e("th",{colspan:"1",class:"p-2 px-5"},"Resultado do PerÃ­odo",-1)),e("th",je," R$ "+d(b.value),1)])])])]),e("div",null,[e("div",Ne,[t[9]||(t[9]=e("canvas",{id:"myChart"},null,-1)),!c.value&&v.value.length===0?(l(),r("div",Le,"Sem dados para exibir no grÃ¡fico")):R("",!0)]),N.value?(l(),r("div",Pe,d(N.value),1)):R("",!0),e("div",ze,[t[12]||(t[12]=e("div",{class:"flex items-center justify-between mb-2 px-1"},[e("h3",{class:"text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"}," HistÃ³rico de Resultados ")],-1)),e("div",Ee,[t[11]||(t[11]=e("div",{class:"bg-[#164110] grid grid-cols-3 gap-4 py-2 px-6 text-xs font-semibold text-white uppercase tracking-wider rounded-tl-2xl rounded-tr-2xl"},[e("span",{class:"text-center"},"MÃŠS"),e("span",{class:"text-center"},"CMV"),e("span",{class:"text-center"},"RESULTADO")],-1)),e("div",Me,[e("ul",Ue,[c.value?(l(),r("li",Ve,[(l(),r(u,null,g(5,o=>e("div",{key:o,class:"grid grid-cols-3 gap-4 px-6 py-2"},t[10]||(t[10]=[e("span",{class:"shimmer h-5 w-full rounded"},null,-1),e("span",{class:"shimmer h-5 w-full rounded"},null,-1),e("span",{class:"shimmer h-5 w-full rounded"},null,-1)]))),64))])):(l(!0),r(u,{key:1},g(i.value,o=>(l(),r("li",{key:o.nome_mes,class:"hover:bg-gray-200 grid grid-cols-3 text-[15px] p-2 border-b last:border-0 transition-colors"},[e("span",Ie,d(o.nome_mes),1),e("span",Je," R$ "+d(o.valor_cmv),1),e("span",{class:q(["text-center font-bold align-middle",$(o.resultado_do_periodo)>=0?"text-green-600":"text-red-600"])}," R$ "+d(o.resultado_do_periodo),3)]))),128))])])])])])])]),f.value?(l(),r("div",Oe,[e("div",Ge,[e("button",{onClick:t[1]||(t[1]=o=>f.value=!1),class:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold leading-none"}," Ã— "),t[13]||(t[13]=e("h2",{class:"text-xl font-bold mb-4 text-gray-800"},"Como funcionam os cÃ¡lculos do DRE",-1)),e("div",Te,d(A.value),1),e("div",We,[e("button",{onClick:t[2]||(t[2]=o=>f.value=!1),class:"px-6 py-2 bg-[#164110] text-white rounded-lg hover:bg-opacity-90 transition-colors font-semibold"},"Fechar")])])])):R("",!0)]),_:1}))}},at=ie(He,[["__scopeId","data-v-c1df8f1d"]]);export{at as default};
