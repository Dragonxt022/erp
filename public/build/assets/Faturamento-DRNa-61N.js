import{Q as E,d as m,i as L,j as z,c as k,o as r,w as P,b as C,a as e,u as V,Z as M,e as i,f as g,t as u,F,h as j,n as B,l as U,k as S}from"./app-BpJtz6--.js";import{A as T}from"./LayoutFranqueadora-CnM3gdKX.js";import{p as q}from"./chartjs-plugin-datalabels.esm-BFtiKef5.js";import{C as h,B as O,c as Q,L as Z,d as H,e as W,b as G,f as J,p as K,a as X,i as Y}from"./chart-CX66tr7T.js";import{U as ee}from"./UnidadeSelectorDropdown-370y_UFc.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"flex flex-col md:flex-row justify-end items-center mb-6 gap-4"},se={class:"w-full md:w-64"},oe={class:"mt-5"},le={class:"grid grid-cols-1 gap-6"},re={class:"bg-white rounded-xl p-6 shadow-sm border border-gray-100"},ne={class:"h-[450px] relative"},ie={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-10"},de={class:"bg-white rounded-xl p-6 shadow-sm border border-gray-100"},ce={class:"flex items-center justify-between mb-8"},ue={class:"flex items-center gap-3"},me={class:"text-sm text-gray-500"},pe={class:"h-[400px] relative"},fe={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-10"},ge={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},xe={class:"overflow-x-auto"},be={class:"w-full text-left border-collapse"},ye={key:0,class:"divide-y divide-gray-100"},ve={key:1,class:"divide-y divide-gray-100"},he={class:"px-6 py-4"},we={class:"flex flex-col"},_e={class:"font-bold text-gray-800"},ke={class:"text-xs text-gray-400"},Ce={class:"px-6 py-4 text-right font-bold text-gray-900 text-base"},Fe={class:"px-6 py-4 text-right"},je={key:0,class:"text-xs"},Be={key:1,class:"text-xs"},Re={class:"font-semibold"},De={class:"px-6 py-4 text-right"},Ie={key:0,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4 sm:p-6"},Ae={class:"relative bg-white rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden transform transition-all animate-fade-in-up"},Ne={class:"p-6 sm:p-8"},$e={class:"flex items-center justify-between mb-6"},Ee={class:"mt-8 flex justify-end"},Le={__name:"Faturamento",setup(ze){h.register(O,Q,Z,H,W,G,J,K,X,Y,q);const R=E(),x=m(R.props.auth.user.unidade_id),p=m(!0),f=m(!1),n=m([]),b=m([]),w=m(0);let y=null,v=null;const D=L(()=>[...n.value].reverse()),I=l=>{x.value=l,_()},_=async()=>{p.value=!0;try{const l=await S.get("/api/admin/painel/faturamento-analitico",{params:{unidade_id:x.value}});n.value=l.data.dados||[],b.value=l.data.projecao||[],w.value=l.data.media_crescimento||0,A(),N()}catch(l){console.error("Erro ao buscar faturamento analítico:",l)}finally{p.value=!1}},A=()=>{const l=document.getElementById("revenueChart");if(!l)return;y&&y.destroy();const t=n.value.map(a=>`${a.nome_mes.substring(0,3)}/${a.ano.substring(2)}`),s=n.value.map(a=>a.faturamento),d=n.value.map(a=>a.diferenca);y=new h(l,{type:"bar",data:{labels:t,datasets:[{label:"Faturamento",data:s,backgroundColor:"#164110",borderRadius:4,order:2,yAxisID:"y",datalabels:{color:"#164110",anchor:"end",align:"top",offset:4,font:{weight:"bold",size:10,family:"Figtree"},formatter:a=>a===0?"":new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(a)}},{label:"Variação",data:d,backgroundColor:n.value.map(a=>a.diferenca>=0?"#6DB631":"#FF2D55"),borderRadius:4,order:1,yAxisID:"y1",datalabels:{display:!0,color:a=>a.dataset.backgroundColor[a.dataIndex],anchor:"start",align:"bottom",offset:4,font:{weight:"bold",size:9,family:"Figtree"},formatter:a=>a===0?"":(a>0?"+":"")+new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(a)}}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{grid:{display:!1},ticks:{font:{family:"Figtree",weight:"600"}}},y:{type:"linear",display:!0,position:"left",grid:{color:"#f3f4f6"},ticks:{font:{family:"Figtree"},callback:a=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(a)}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},ticks:{font:{family:"Figtree"},callback:a=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(a)}}},plugins:{legend:{display:!1},tooltip:{padding:12,backgroundColor:"#164110",titleFont:{family:"Figtree",size:14,weight:"bold"},bodyFont:{family:"Figtree",size:13},cornerRadius:8,callbacks:{label:function(a){let c=a.dataset.label||"";return c&&(c+=": "),a.parsed.y!==null&&(c+=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.parsed.y)),c}}}}}})},N=()=>{const l=document.getElementById("projectionChart");if(!l)return;v&&v.destroy(),n.value.map(o=>`${o.nome_mes.substring(0,3)}/${o.ano.substring(2)}`);const t=b.value.map(o=>`${o.nome_mes.substring(0,3)}/${o.ano.substring(2)}`);let s=-1;for(let o=n.value.length-1;o>=0;o--)if(n.value[o].faturamento>0){s=o;break}if(s===-1)return;const d=n.value[s],c=[`${d.nome_mes.substring(0,3)}/${d.ano.substring(2)}`,...t],$=[d.faturamento,...b.value.map(o=>o.faturamento)];v=new h(l,{type:"line",data:{labels:c,datasets:[{label:"Projeção de Faturamento",data:$,borderColor:"#164110",backgroundColor:"rgba(22, 65, 16, 0.1)",borderWidth:3,borderDash:[5,5],fill:!0,tension:.4,pointRadius:4,pointBackgroundColor:"#164110",datalabels:{color:"#164110",anchor:"end",align:"top",offset:8,font:{weight:"bold",size:10,family:"Figtree"},formatter:o=>new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(o)}}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{padding:12,backgroundColor:"#164110",callbacks:{label:function(o){return"Estimativa: "+new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.parsed.y)}}}},scales:{x:{grid:{display:!1},ticks:{font:{family:"Figtree",weight:"600"}}},y:{beginAtZero:!1,grid:{color:"#f3f4f6"},ticks:{font:{family:"Figtree"},callback:o=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(o)}}}}})};return z(()=>{_()}),(l,t)=>(r(),k(T,null,{default:P(()=>[C(V(M),{title:"Faturamento Analítico"}),t[19]||(t[19]=e("div",{class:"painel-title"},"Faturamento Analítico",-1)),t[20]||(t[20]=e("div",{class:"painel-subtitle"},[e("p",null,"Análise comparativa de faturamento dos últimos 12 meses")],-1)),e("div",ae,[e("div",se,[C(ee,{"default-unit-id":x.value,onUnitSelected:I},null,8,["default-unit-id"])])]),e("div",oe,[e("div",le,[e("div",re,[t[6]||(t[6]=e("div",{class:"flex items-center justify-between mb-8"},[e("div",null,[e("h3",{class:"text-xl font-bold text-gray-800"},"Evolução de 12 Meses"),e("p",{class:"text-sm text-gray-500"},"Comparativo mensal e variação nominal")]),e("div",{class:"flex flex-wrap gap-4"},[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-4 h-4 bg-[#164110] rounded-sm shadow-sm"}),e("div",{class:"flex flex-col"},[e("span",{class:"text-xs font-bold text-gray-700"},"Faturamento"),e("span",{class:"text-[10px] text-gray-400"},"Total do mês")])]),e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-4 h-4 bg-[#6DB631] rounded-sm shadow-sm"}),e("div",{class:"flex flex-col"},[e("span",{class:"text-xs font-bold text-green-700"},"Crescimento"),e("span",{class:"text-[10px] text-gray-400"},"Variação positiva")])]),e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-4 h-4 bg-[#FF2D55] rounded-sm shadow-sm"}),e("div",{class:"flex flex-col"},[e("span",{class:"text-xs font-bold text-red-700"},"Queda"),e("span",{class:"text-[10px] text-gray-400"},"Variação negativa")])])])],-1)),e("div",ne,[p.value?(r(),i("div",ie,t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#164110]"},null,-1)]))):g("",!0),t[5]||(t[5]=e("canvas",{id:"revenueChart"},null,-1))])]),e("div",de,[e("div",ce,[e("div",ue,[e("div",null,[t[7]||(t[7]=e("h3",{class:"text-xl font-bold text-gray-800"},"Projeção para os Próximos 12 Meses",-1)),e("p",me,"Estimativa baseada na média de crescimento histórico ("+u(w.value)+"%)",1)]),e("button",{onClick:t[0]||(t[0]=s=>f.value=!0),class:"p-1.5 hover:bg-blue-50 rounded-full transition-colors group"},t[8]||(t[8]=[e("img",{src:"/storage/images/info_iconverde.svg",alt:"Informação",class:"w-5 h-5 opacity-40 group-hover:opacity-100 transition-opacity"},null,-1)]))]),t[9]||(t[9]=e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-8 h-1 bg-[#164110] border-t-2 border-dashed border-[#164110]"}),e("span",{class:"text-xs font-bold text-gray-700"},"Tendência Projetada")],-1))]),e("div",pe,[p.value?(r(),i("div",fe,t[10]||(t[10]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#164110]"},null,-1)]))):g("",!0),t[11]||(t[11]=e("canvas",{id:"projectionChart"},null,-1))])]),e("div",ge,[t[14]||(t[14]=e("div",{class:"p-6 border-b border-gray-50"},[e("h3",{class:"text-lg font-bold text-gray-800"},"Detalhamento Mensal")],-1)),e("div",xe,[e("table",be,[t[13]||(t[13]=e("thead",null,[e("tr",{class:"bg-gray-50 text-[11px] font-bold text-gray-500 uppercase tracking-wider"},[e("th",{class:"px-6 py-4"},"Período"),e("th",{class:"px-6 py-4 text-right"},"Faturamento Total"),e("th",{class:"px-6 py-4 text-right"},"Variação Nominal"),e("th",{class:"px-6 py-4 text-right"},"Variação Percentual")])],-1)),p.value?(r(),i("tbody",ye,[(r(),i(F,null,j(5,s=>e("tr",{key:s},t[12]||(t[12]=[e("td",{class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-100 rounded w-24 animate-pulse"})],-1),e("td",{class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-100 rounded w-20 animate-pulse ml-auto"})],-1),e("td",{class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-100 rounded w-20 animate-pulse ml-auto"})],-1),e("td",{class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-100 rounded w-16 animate-pulse ml-auto"})],-1)]))),64))])):(r(),i("tbody",ve,[(r(!0),i(F,null,j(D.value,(s,d)=>(r(),i("tr",{key:d,class:"hover:bg-gray-50 transition-colors"},[e("td",he,[e("div",we,[e("span",_e,u(s.nome_mes),1),e("span",ke,u(s.ano),1)])]),e("td",Ce," R$ "+u(s.faturamento_formatado),1),e("td",Fe,[e("div",{class:B(["flex items-center justify-end gap-1",s.diferenca>=0?"text-green-600":"text-red-600"])},[s.diferenca>0?(r(),i("span",je,"▲")):s.diferenca<0?(r(),i("span",Be,"▼")):g("",!0),e("span",Re,"R$ "+u(s.diferenca_formatada),1)],2)]),e("td",De,[e("span",{class:B(["px-2 py-1 rounded-full text-xs font-bold",s.percentual>=0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},u(s.percentual>=0?"+":"")+u(s.percentual)+"% ",3)])]))),128))]))])])])])]),(r(),k(U,{to:"body"},[f.value?(r(),i("div",Ie,[e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t[1]||(t[1]=s=>f.value=!1)}),e("div",Ae,[e("div",Ne,[e("div",$e,[t[16]||(t[16]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center"},[e("img",{src:"/storage/images/info_iconverde.svg",class:"w-6 h-6",alt:"Info"})]),e("div",null,[e("h4",{class:"text-xl font-bold text-gray-900 font-figtree"},"Como funciona a Projeção?"),e("p",{class:"text-sm text-gray-500"},"Entenda a inteligência por trás dos dados")])],-1)),e("button",{onClick:t[2]||(t[2]=s=>f.value=!1),class:"text-gray-400 hover:text-gray-600 transition-colors"},t[15]||(t[15]=[e("span",{class:"text-2xl"},"×",-1)]))]),t[17]||(t[17]=e("div",{class:"space-y-6"},[e("div",{class:"flex gap-4"},[e("div",{class:"flex-shrink-0 w-8 h-8 rounded-full bg-green-100 text-green-700 flex items-center justify-center font-bold text-sm"},"1"),e("div",null,[e("h5",{class:"font-bold text-gray-800 mb-1"},"DNA da Unidade"),e("p",{class:"text-sm text-gray-600 leading-relaxed"},"Analisamos o comportamento real dos últimos 12 meses da unidade selecionada para extrair sua variação percentual média.")])]),e("div",{class:"flex gap-4"},[e("div",{class:"flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold text-sm"},"2"),e("div",null,[e("h5",{class:"font-bold text-gray-800 mb-1"},"Filtro de Ruídos"),e("p",{class:"text-sm text-gray-600 leading-relaxed"},"Crescimentos ou quedas atípicas (ex: inaugurações ou reformas) são ignorados para que a projeção seja baseada em um ritmo sustentável.")])]),e("div",{class:"flex gap-4"},[e("div",{class:"flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center font-bold text-sm"},"3"),e("div",null,[e("h5",{class:"font-bold text-gray-800 mb-1"},"Média de Tendência"),e("p",{class:"text-sm text-gray-600 leading-relaxed"},"Calculamos uma média móvel de crescimento, limitada entre -2% e +5% ao mês, garantindo uma estimativa conservadora e segura.")])]),e("div",{class:"flex gap-4"},[e("div",{class:"flex-shrink-0 w-8 h-8 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center font-bold text-sm"},"4"),e("div",null,[e("h5",{class:"font-bold text-gray-800 mb-1"},"Cálculo Composto"),e("p",{class:"text-sm text-gray-600 leading-relaxed"},"A projeção usa a lógica de juros compostos: o crescimento de cada mês futuro é aplicado sobre o valor projetado do mês anterior.")])])],-1)),t[18]||(t[18]=e("div",{class:"mt-8 p-4 bg-gray-50 rounded-xl border border-gray-100 italic text-xs text-gray-500 leading-relaxed"}," * Nota: A projeção é uma estimativa matemática baseada em dados passados e não garante resultados futuros. O sistema ignora meses incompletos para manter a precisão. ",-1)),e("div",Ee,[e("button",{onClick:t[3]||(t[3]=s=>f.value=!1),class:"bg-[#164110] text-white px-8 py-2.5 rounded-xl font-bold hover:bg-[#1a4d13] transition-colors shadow-lg shadow-green-900/10"}," Entendi ")])])])])):g("",!0)]))]),_:1}))}},qe=te(Le,[["__scopeId","data-v-335aa3e3"]]);export{qe as default};
