import{L as N}from"./LayoutFranqueado-DXsD8Pkt.js";import{o as r,e as a,h as _,a as e,t as f,l as A,d as m,m as z,j as S,s as Q,F as k,g as U,b as y,f as D,k as B,v as E,u as M,c as R,w as j,Z as O}from"./app-BlKfMOOe.js";import{_ as G,I as K,a as T,B as H}from"./ButtonCancelar-BrUOfQZz.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Xq5OVTbn.js";import"./user-_R9GIEcP.js";const J={class:"login-btn-text w-full"},Z=["src"],W={class:"text-center text-[15px] font-semibold font-['Figtree'] leading-tight"},X={__name:"ButtonPrimaryCarrinho",props:{text:{type:String,default:"Label"},iconPath:{type:String,required:!1}},setup(s){return(n,d)=>(r(),a("button",J,[s.iconPath?(r(),a("img",{key:0,src:s.iconPath,alt:"icon",class:"h-6 w-6 mr-2"},null,8,Z)):_("",!0),e("span",W,f(s.text),1)]))}},Y=P(X,[["__scopeId","data-v-75ecbfc3"]]),ee={key:0,class:"elemento-fixo"},te={class:"mb-6 relative"},oe={class:"relative"},se=["disabled"],re=["value"],ae={class:"w-full h-[150px] bg-white rounded-[20px] p-12"},ne={class:"relative w-full h-full"},ie={class:"flex items-center"},de={class:"w-1/1 flex justify-center"},le=["src"],ce={class:"w-2/3 pl-5"},ue={class:"text-[#262a27] text-[28px] font-bold font-['Figtree'] leading-[30px] tracking-tight"},pe={key:0,class:"mt-8"},fe={class:"min-w-full table-auto"},me={class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tr-2xl"},ve={key:0,class:"text-center"},xe={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},ge={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},_e={key:2,class:"text-center"},he={class:"mt-12"},ye={class:"up w-full h-[18.63px] text-[#6d6d6d] text-[15px] font-semibold font-['Figtree'] leading-tight mt-3 mb-3"},be={class:"mt-5 flex gap-2"},we={__name:"DetalhesProdutoPedidos",props:{produto:{type:Object,required:!0}},emits:["adicionarAoCarrinho"],setup(s,{emit:n}){const d=A(),x=s,i=m({precos:[]}),v=n,u=m(!1),h=m(!1),b=m(!1),w=m([]),p=m(""),g=m(""),C=()=>{v("finalizar")},F=()=>{if(!p.value){d.warning("Por favor, selecione o fornecedor!");return}if(!g.value){d.warning("É necessário informar uma quantidade!");return}if(!i.value||!i.value.precos){d.error("Houve um erro com o produto, tente novamente ou chame o suporte.");return}const o=i.value.precos.find(I=>I.fornecedor_id===p.value);if(!o){d.warning("Este fornecedor não está disponível no momento!");return}const t=w.value.find(I=>I.id===p.value),c=o?o.preco_unitario:0,$={id:i.value.id,nome:i.value.nome,unidadeDeMedida:i.value.unidadeDeMedida,fornecedorId:p.value,nomeFornecedor:t?t.razao_social:"Fornecedor desconhecido",quantidade:parseFloat(g.value),preco:c};v("adicionarAoCarrinho",$),d.success("Item adicionado a sua lista de pedido."),g.value="",b.value=!0};(async()=>{try{const o=await B.get("/api/estoque/fornecedores");w.value=o.data.data.map(t=>({id:t.id||"N/D",razao_social:t.razao_social||"N/D"}))}catch(o){console.error("Erro ao carregar fornecedores:",o)}})();const L=o=>(o/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),q=async()=>{u.value=!0;try{if(x.produto&&x.produto.id){const t=(await B.get("/api/produtos/lista")).data;i.value=t.find(c=>c.id===x.produto.id)||{}}}catch(o){console.error("Erro ao buscar o produto:",o)}finally{u.value=!1}},l=o=>o?new URL(o,window.location.origin).href:"/storage/images/no_imagem.svg";return z(()=>x.produto,()=>{q()},{immediate:!0}),(o,t)=>h.value?_("",!0):(r(),a("div",ee,[e("div",null,[t[3]||(t[3]=e("h3",{class:"text-xl font-bold mb-4 text-gray-500"}," Enviar pedido para o fornecedor ",-1)),e("div",te,[e("div",oe,[S(e("select",{"onUpdate:modelValue":t[0]||(t[0]=c=>p.value=c),id:"fornecedor",disabled:b.value,class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-green-600 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[t[2]||(t[2]=e("option",{value:"",disabled:""},"Selecione um fornecedor",-1)),(r(!0),a(k,null,U(w.value,c=>(r(),a("option",{key:c.id,value:c.id},f(c.razao_social),9,re))),128))],8,se),[[Q,p.value]])])])]),e("div",ae,[e("div",ne,[e("div",ie,[e("div",de,[e("img",{src:l(s.produto.profile_photo),alt:"Foto do Produto",class:"w-20 h-20 rounded-md shadow-lg"},null,8,le)]),e("div",ce,[e("div",ue,f(s.produto.nome||"N/A"),1)])])])]),h.value?_("",!0):(r(),a("div",pe,[y(G,{text:"valor por fornecedor",class:"tracking-wider uppercase"}),e("table",fe,[e("thead",null,[e("tr",null,[t[4]||(t[4]=e("th",{class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tl-2xl"}," Fornecedor ",-1)),e("th",me," Preço "+f(s.produto.unidadeDeMedida==="unitario"?"Unitario":"A Granel"),1)])]),e("tbody",null,[u.value?(r(),a("tr",ve,t[5]||(t[5]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},[e("div",{class:"flex justify-center items-center"},[e("svg",{class:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]),D(" Carregando... ")])],-1)]))):i.value.precos&&i.value.precos.length>0?(r(!0),a(k,{key:1},U(i.value.precos,(c,$)=>(r(),a("tr",{key:$,class:"text-center"},[e("td",xe,f(c.fornecedor),1),e("td",ge,f(L(c.preco_unitario)),1)]))),128)):(r(),a("tr",_e,t[6]||(t[6]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"}," Nenhum preço disponível para este produto. ",-1)])))])])])),e("div",he,[e("label",ye,f(s.produto.unidadeDeMedida==="unitario"?"Unitario":"A Granel"),1),y(K,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=c=>g.value=c)},null,8,["modelValue"])]),e("div",be,[y(Y,{disabled:u.value,text:"adicionar ao carrinho",iconPath:"/storage/images/carrinho.svg",onClick:F,class:"uppercase"},null,8,["disabled"]),y(T,{class:"w-full",text:"Finalizar Pedido",iconPath:"/storage/images/arrow_left_alt.svg",onClick:C})])]))}},$e=P(we,[["__scopeId","data-v-3d41c667"]]),ke={data(){return{produtos:[],searchQuery:""}},mounted(){this.fetchProdutos()},methods:{async fetchProdutos(){try{const s=await B.get("/api/estoque/lista");console.log("Produtos carregados:",s.data),this.produtos=Object.values(s.data)}catch(s){console.error("Erro ao carregar os produtos:",s)}},getProfilePhotoUrl(s){return s?new URL(s,window.location.origin).href:"/storage/images/no_imagem.svg"},selecionarProduto(s){this.$emit("produto-selecionado",s)},getQuantidadeTotal(s){return s.reduce((n,d)=>n+d.quantidade,0)}},computed:{filteredProdutos(){const s=this.searchQuery.toLowerCase();return this.produtos.filter(n=>n.nome.toLowerCase().includes(s))}}},Pe={class:"search-container relative flex items-center w-full mb-4"},Ce={class:"card-container"},Fe=["onClick"],qe={class:"card-inner"},De={class:"icon-container"},Ue={class:"icon-leaf"},Le=["src"],Ie={class:"text-container flex justify-between items-center p-2"},Re={class:"city"},Be={class:"quantidade text-gray-600 font-semibold"},Se={class:"text-gray-600 font-semibold"};function Ve(s,n,d,x,i,v){return r(),a("div",null,[n[3]||(n[3]=e("div",{class:"painel-title"},"Novo pedido",-1)),n[4]||(n[4]=e("div",{class:"painel-subtitle"},[e("p",null,"Efetuar novo pedido de insumos com fornecedor")],-1)),e("div",Pe,[n[1]||(n[1]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),S(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=u=>i.searchQuery=u),placeholder:"Buscar um produto",class:"search-input pl-10 w-full py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[E,i.searchQuery]])]),e("div",Ce,[(r(!0),a(k,null,U(v.filteredProdutos,u=>(r(),a("div",{key:u.id,class:"card cursor-pointer transform transition-transform duration-200 hover:shadow-lg",onClick:h=>v.selecionarProduto(u)},[e("div",qe,[e("div",De,[n[2]||(n[2]=e("div",{class:"icon-bg"},null,-1)),e("div",Ue,[e("img",{src:v.getProfilePhotoUrl(u.profile_photo),alt:"Imagem do produto",class:"w-12 h-12 rounded-lg"},null,8,Le)])]),e("div",Ie,[e("div",Re,f(u.nome),1),e("div",Be,[e("div",Se,f(v.getQuantidadeTotal(u.lotes))+" "+f(u.unidadeDeMedida==="unitario"?"uni":"kg"),1)])])])],8,Fe))),128))])])}const Ae=P(ke,[["render",Ve],["__scopeId","data-v-bce6f987"]]),Ee={class:"flex gap-5"},Me={key:0,class:"loading-overlay"},Te={class:"flex-1"},Ne={class:"mt-[20%] text-[#6d6d6d] text-[18px] font-normal font-['Figtree'] leading-[23px] tracking-tight"},ze={class:"text-[#6db631] text-xl font-bold font-['Figtree'] leading-[25px] tracking-tight mt-12"},Qe={class:"flex-1"},je={class:"min-w-full table-auto"},Oe=["onDblclick"],Ge={class:"px-6 py-4 text-[16px] text-left text-gray-500 font-semibold"},Ke={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-center"},He=["onUpdate:modelValue"],Je={key:1},Ze={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-left"},We={class:"px-6 py-4 text-[16px] text-gray-500 text-center font-semibold"},Xe={class:"px-6 py-4 text-center"},Ye=["onClick"],et={class:"bg-[#e4f6de]"},tt={class:"px-6 py-4 text-[16px] text-center text-gray-500 font-semibold"},ot={key:0,class:"botao-container"},st={__name:"ResumoCarrinhoPedidos",props:{carrinho:{type:Array,required:!0}},emits:["confirmar","cancelar"],setup(s,{emit:n}){var q;const d=A(),x=s,i=n,v=m(!1),u=m(!1),h=m(null),b=((q=x.carrinho[0])==null?void 0:q.nomeFornecedor)||"Sem fornecedor",w=l=>{x.carrinho.splice(l,1),d.info("Item removido com sucesso!")},p=l=>{h.value=l},g=l=>(l.preco||0)/100,C=l=>(l.quantidade||0)*(l.preco||0)/100,F=()=>x.carrinho.reduce((l,o)=>l+(o.quantidade||0)*(o.preco||0)/100,0),V=async()=>{v.value=!0;try{const l={itens:x.carrinho.map(t=>({fornecedor_id:t.fornecedorId,id:t.id,nome:t.nome,nomeFornecedor:t.nomeFornecedor,quantidade:t.quantidade,valor_unitario:t.preco,valor_total_item:C(t),unidadeDeMedida:t.unidadeDeMedida})),valor_total_carrinho:F(),nomePrimeiroFornecedor:b};console.log("Dados a ser enviado:",JSON.stringify(l,null,2));const o=await axios.post("/api/estoque/criar-pedido",l);o.status===201?(console.log("Resposta da API:",o.data),d.success("Lista de itens está sendo enviada.")):d.error("Erro ao enviar os itens.")}catch(l){console.error("Erro ao enviar:",l),d.error("Erro ao confirmar o envio. Tente novamente ou chame o suporte.")}finally{v.value=!1}},L=()=>{i("cancelar")};return(l,o)=>(r(),a("div",Ee,[v.value?(r(),a("div",Me,o[0]||(o[0]=[e("div",{class:"spinner"},null,-1)]))):_("",!0),e("div",Te,[o[2]||(o[2]=e("div",{class:"painel-title"},"Confirmar pedido",-1)),o[3]||(o[3]=e("div",{class:"painel-subtitle"},[e("p",null,"Verifique seu pedido antes de enviar")],-1)),e("div",Ne,[o[1]||(o[1]=e("p",null,[D(" Verifique se o seu pedido "),e("br"),D(" está correto antes de enviar "),e("br"),D(" para o fornecedor ")],-1)),e("span",ze,f(M(b)||"Fornecedor desconhecido")+". ",1)])]),e("div",Qe,[e("table",je,[o[7]||(o[7]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-xs text-left font-medium text-gray-500 uppercase tracking-wider TrRedonEsquerda"}," Item "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," QTD. "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," V. UN/KG "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," TOTAL "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider TrRedonDireita"}," AÇÃO ")])],-1)),e("tbody",null,[(r(!0),a(k,null,U(s.carrinho,(t,c)=>(r(),a("tr",{key:t.id,onDblclick:$=>p(c)},[e("td",Ge,f(t.nome),1),e("td",Ke,[h.value===c?S((r(),a("input",{key:0,type:"number","onUpdate:modelValue":$=>t.quantidade=$,class:"border border-gray-300 rounded px-2 py-1 w-16"},null,8,He)),[[E,t.quantidade,void 0,{number:!0}]]):(r(),a("span",Je,f(t.quantidade)+" "+f(t.unidadeDeMedida==="a_granel"?"KG":"UN"),1))]),e("td",Ze," R$ "+f(g(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",We," R$ "+f(C(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",Xe,[e("button",{onClick:$=>w(c),class:"w-[16] h-[16]"},o[4]||(o[4]=[e("img",{src:"/storage/images/delete.svg",alt:"icone de excluir",class:"w-[16px] h-[16px]"},null,-1)]),8,Ye)])],40,Oe))),128)),e("tr",et,[o[5]||(o[5]=e("td",{class:"px-6 py-8 text-[16px] text-left text-gray-500 font-semibold",colspan:"3"}," Total do Pedido ",-1)),e("td",tt," R$ "+f(F(l.item).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),o[6]||(o[6]=e("td",null,null,-1))])])]),u.value?_("",!0):(r(),a("div",ot,[y(H,{text:"Voltar",onClick:L}),y(T,{text:"Confirmar",onClick:V})]))])]))}},rt=P(st,[["__scopeId","data-v-bf575ae5"]]),at={key:0,class:"mt-6"},nt={class:"grid grid-cols-1 gap-[3rem] mt-3 sm:grid-cols-2 card-container h-full overflow-hidden"},it={key:0},dt={class:"flex flex-col gap-4"},lt={__name:"Index",setup(s){const n=m([]),d=m(null),x=m(0),i=m(!1);m(!1);const v=()=>{i.value=!i.value},u=p=>{n.value.push(p)},h=()=>{console.log("atualizando a lista"),d.value=null,x.value+=1},b=()=>{var g;(g=m("listarUnidades").value)==null||g.fetchUnidades()},w=p=>{p&&typeof p=="object"?d.value=p:console.warn("Dados inválidos recebidos no evento produto-selecionado:",p)};return(p,g)=>(r(),R(N,null,{default:j(()=>[y(M(O),{title:"Novo Pedido"}),i.value?(r(),a("div",at,[y(rt,{carrinho:n.value,isVisible:i.value,onCancelar:v},null,8,["carrinho","isVisible"])])):_("",!0),e("div",nt,[i.value?_("",!0):(r(),a("div",it,[(r(),R(Ae,{key:x.value,ref:"listarUnidades",onUnidadeCadastrada:b,onProdutoSelecionado:w}))])),e("div",dt,[i.value?_("",!0):(r(),a(k,{key:0},[d.value?(r(),R($e,{key:0,onAtualizar:h,produto:d.value,onFinalizar:v,onAdicionarAoCarrinho:u},null,8,["produto"])):_("",!0)],64))])])]),_:1}))}},xt=P(lt,[["__scopeId","data-v-b1c0aaaf"]]);export{xt as default};
