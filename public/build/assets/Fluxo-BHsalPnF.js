import{L}from"./LayoutFranqueado-C1_OybaX.js";import{o as l,e as d,a as e,t as _,h as g,l as M,d as h,i as y,y as N,c as j,w as U,b as c,u as A,Z as T,g as V,F as $,f as C,k as b}from"./app-CLF3Ajie.js";import{I as w}from"./InputModel-C4NGpV_3.js";import{B as z}from"./ButtonPrimaryMedio-Dy_dnZ7G.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as k}from"./index-CoI5cSg0.js";import"./user-ChZNVR2t.js";const O=["type"],Z={class:"text-center uppercase text-[#5a9f28] upp text-[15px] font-semibold font-['Figtree'] leading-tight"},G=["src"],H={__name:"ButtonSuave",props:{text:{type:String,required:!0,default:"Nome do Botão"},type:{type:String,default:"button"},iconPath:{type:String,required:!1}},emits:["click"],setup(p,{emit:r}){const i=r,u=()=>{i("click")};return(m,f)=>(l(),d("button",{type:p.type,onClick:u,class:"h-[46px] px-[38px] py-3 bg-white rounded-[133.33px] flex justify-center items-center gap-2.5"},[e("span",Z,_(p.text),1),p.iconPath?(l(),d("img",{key:0,src:p.iconPath,alt:"icon",class:"h-6 w-6"},null,8,G)):g("",!0)],8,O))}},P=S(H,[["__scopeId","data-v-0a3ca3a8"]]),J={key:0,class:"loading-overlay"},K={class:"mt-5"},Q={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-6"},W={class:"bg-white rounded-lg px-12 py-8"},X={class:"w-full"},Y={class:"py-3 flex items-center gap-5"},ee=["src","alt"],te={class:"w-fill text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"},ae={class:"py-2 w-ful"},se={class:"w-full h-[60px] bg-[#d2fac3] rounded-bl-[10px] rounded-br-[10px] px-12 flex justify-between items-center"},oe={class:"text-[#1d5915] text-xl font-bold font-['Figtree'] leading-snug"},ne={class:"bg-white rounded-lg px-12 py-8"},le={class:"w-full"},ie={class:"w-[85px]"},de=["src","alt"],re={class:"py-4 px-3 flex items-center gap-5"},ce={class:"w-fill text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug w-[170px]"},ue={class:"py-2"},me={class:"py-2"},_e={class:"w-full h-[60px] bg-[#d2fac3] rounded-bl-[10px] rounded-br-[10px] px-12 flex justify-between items-center"},pe={class:"text-[#1d5915] text-xl font-bold font-['Figtree'] leading-snug"},xe={class:"text-[#1d5915] text-xl font-bold font-['Figtree'] leading-snug"},ge={class:"mt-5 bottom-0 left-[250px] w-full max-w-screen-xl mx-auto"},fe={class:"w-full h-[85px] p-5 flex justify-between items-center"},ve={class:"flex gap-[13px]"},he={class:"flex justify-center items-center gap-2.5"},ye={__name:"Fluxo",setup(p){const r=M(),i=h(!1),u=h([]),m=h([]),f=y(()=>`R$ ${u.value.reduce((a,t)=>a+parseFloat(t.total_vendas_metodos_pagamento.replace("R$","").replace(/\./g,"").replace(",","."))||0,0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),F=y(()=>`R$ ${m.value.reduce((a,t)=>a+parseFloat(t.total_vendas_canais_vendas.replace("R$","").replace(/\./g,"").replace(",","."))||0,0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),B=y(()=>m.value.reduce((s,a)=>s+(parseInt(a.quantidade_vendas_canais_vendas)||0),0)),R=(s,a)=>{const t=s.target;let o=t.value.replace(/\D/g,"");o||(o="0");const n=o.slice(0,-2)||"0",v=o.slice(-2).padStart(2,"0"),x=`R$ ${Number(n).toLocaleString("pt-BR")},${v}`;t.value=x,a.total_vendas_metodos_pagamento=x},I=(s,a)=>{const t=s.target;let o=t.value.replace(/\D/g,"");o||(o="0");const n=o.slice(0,-2)||"0",v=o.slice(-2).padStart(2,"0"),x=`R$ ${Number(n).toLocaleString("pt-BR")},${v}`;t.value=x,a.total_vendas_canais_vendas=x},q=async()=>{i.value=!0;try{const s=await b.get("/api/caixas/metodos-canais-ativos");s.data.status==="success"?(console.log("Métodos de pagamento:",s.data.metodosPagamento),console.log("Canais de vendas:",s.data.canaisVendas),u.value=s.data.metodosPagamento.filter(a=>{var t;return(t=a.default_payment_method)==null?void 0:t.img_icon}).map(a=>({...a,total_vendas_metodos_pagamento:"R$ 0,00"})),m.value=s.data.canaisVendas.filter(a=>{var t;return(t=a.default_canal_de_vendas)==null?void 0:t.img_icon}).map(a=>({...a,total_vendas_canais_vendas:"R$ 0,00",quantidade_vendas_canais_vendas:0}))):r.error("Erro ao carregar os dados")}catch(s){console.error("Erro ao buscar métodos e canais ativos:",s),r.error("Erro ao carregar os dados")}finally{i.value=!1}},D=async()=>{i.value=!0;try{(await b.post("/api/caixas/fechar-caixa",{metodos:u.value,canais:m.value,total_metodos_pagamento:f.value,total_canais_vendas:F.value})).data.status==="success"?(r.success("Fechamento realizado com sucesso!"),k.Inertia.visit(route("franqueado.abrirCaixa"))):r.error("Erro ao realizar o fechamento")}catch(s){console.error("Erro ao enviar fechamento de caixa:",s),r.error("Erro ao realizar o fechamento")}finally{i.value=!1}},E=async()=>{i.value=!0;try{const s=await b.get("/api/caixas/abertos");s.data&&s.data.aberto?console.log("caixa aberto, permanecendo na pagina"):(r.warning("Abra o caixa primeiro!"),k.Inertia.visit(route("franqueado.abrirCaixa")))}catch(s){console.error("Erro ao verificar caixa aberto:",s)}finally{i.value=!1}};return N(()=>{E(),q()}),(s,a)=>(l(),j(L,null,{default:U(()=>[c(A(T),{title:"Fluxo do Caixa"}),i.value?(l(),d("div",J,a[0]||(a[0]=[e("div",{class:"spinner"},null,-1)]))):g("",!0),a[6]||(a[6]=e("div",{class:"flex justify-between items-center mb-4"},[e("div",null,[e("div",{class:"painel-title text-2xl sm:text-3xl md:text-4xl"}," Fluxo do caixa "),e("div",{class:"painel-subtitle"},[e("p",{class:"text-sm sm:text-base md:text-lg"}," Acompanhe seu negócio em tempo real ")])])],-1)),e("div",K,[e("div",Q,[e("div",null,[e("div",W,[e("table",X,[a[1]||(a[1]=e("thead",null,[e("tr",null,[e("th",{class:"text-gray-500 text-left text-sm sm:text-base md:text-lg font-semibold font-['Figtree'] leading-snug"}," Método de pagamento ")])],-1)),e("tbody",null,[(l(!0),d($,null,V(u.value,t=>{var o;return l(),d("tr",{key:t.id},[e("td",Y,[t.default_payment_method&&t.default_payment_method.img_icon?(l(),d("img",{key:0,src:`/${t.default_payment_method.img_icon}`,alt:t.default_payment_method.nome||"Método de pagamento",class:"w-8 h-8"},null,8,ee)):g("",!0),e("div",te,_(((o=t.default_payment_method)==null?void 0:o.nome)||"Desconhecido"),1)]),e("td",ae,[c(w,{modelValue:t.total_vendas_metodos_pagamento,"onUpdate:modelValue":n=>t.total_vendas_metodos_pagamento=n,onInput:n=>R(n,t),class:"w-[120px]"},null,8,["modelValue","onUpdate:modelValue","onInput"])])])}),128))])])]),e("div",se,[a[2]||(a[2]=e("div",{class:"text-[#1d5915] text-xl font-bold font-['Figtree'] leading-snug"}," TOTAL ",-1)),e("div",oe,_(f.value),1)])]),e("div",null,[e("div",ne,[e("table",le,[a[3]||(a[3]=e("thead",null,[e("tr",null,[e("th"),e("th",{class:"px-2 text-left text-gray-500 text-sm sm:text-base md:text-lg font-semibold font-['Figtree'] leading-snug"}," Canais de venda "),e("th",{class:"text-gray-500 text-sm sm:text-base md:text-lg font-semibold font-['Figtree'] leading-snug"}," Valor vendido "),e("th",{class:"text-gray-500 text-sm sm:text-base md:text-lg font-semibold font-['Figtree'] leading-snug"}," Pedidos ")])],-1)),e("tbody",null,[(l(!0),d($,null,V(m.value,t=>{var o;return l(),d("tr",{key:t.id},[e("td",ie,[t.default_canal_de_vendas&&t.default_canal_de_vendas.img_icon?(l(),d("img",{key:0,src:`/${t.default_canal_de_vendas.img_icon}`,alt:t.default_canal_de_vendas.nome||"Canal de venda",class:"h-7 w-17 fill-stone-950"},null,8,de)):g("",!0)]),e("td",re,[e("div",ce,_(((o=t.default_canal_de_vendas)==null?void 0:o.nome)||"Desconhecido"),1)]),e("td",ue,[c(w,{modelValue:t.total_vendas_canais_vendas,"onUpdate:modelValue":n=>t.total_vendas_canais_vendas=n,onInput:n=>I(n,t),class:"w-[120px]",placeholder:"R$ 0,00"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",me,[c(w,{modelValue:t.quantidade_vendas_canais_vendas,"onUpdate:modelValue":n=>t.quantidade_vendas_canais_vendas=n,placeholder:"0",class:"w-[120px]"},null,8,["modelValue","onUpdate:modelValue"])])])}),128))])])]),e("div",_e,[e("div",pe,[a[4]||(a[4]=e("span",null,"Total:",-1)),C(" "+_(F.value),1)]),e("div",xe,[a[5]||(a[5]=e("span",null,"Pedidos:",-1)),C(" "+_(B.value),1)])])])])]),e("div",ge,[e("div",fe,[e("div",ve,[c(P,{class:"w-full",text:"Suprimento",iconPath:""}),c(P,{class:"w-full",text:"Sangria",iconPath:""})]),e("div",he,[c(z,{class:"w-full max-w-[200px]",text:"Fechar caixa",iconPath:"/storage/images/arrow_left_alt.svg",onClick:D})])])])]),_:1}))}},Pe=S(ye,[["__scopeId","data-v-5ddcc7ed"]]);export{Pe as default};
