import{d as i,j as J,i as N,e as n,o as l,a as e,f as U,t as c,p as G,m as V,x as z,F as f,h,c as W,w as q,b as I,u as H,Z,k as K}from"./app-D3ViAvpV.js";import{L as Q}from"./LayoutFranqueado-poXwcgsC.js";import{p as X}from"./chartjs-plugin-datalabels.esm-BIjjlP_n.js";import{C as O,A as ee,p as te,a as oe,D as se,P as ae,b as le,i as re}from"./chart-lMt0pmU3.js";import{d as C}from"./dayjs.min-DYAvcHIQ.js";import"./pt-br-Bve-SIwC.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"relative flex items-center space-x-2"},de={class:"relative"},ue={class:"space-y-3"},ce=["value"],me=["value"],pe={__name:"CalendarFilterDre",emits:["update-filters"],setup(T,{emit:$}){C.locale("pt-br");const Y=$,u=i(C()),m=i(!1),g=i(C().month()),b=i(C().year()),_=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],L=J(()=>{const v=C().year(),r=[];for(let d=v-10;d<=v+2;d++)r.push(d);return r}),x=()=>{u.value=u.value.subtract(1,"month"),w()},D=()=>{u.value=u.value.add(1,"month"),w()},F=()=>{m.value=!m.value,m.value&&(g.value=u.value.month(),b.value=u.value.year())},y=()=>{m.value=!1},R=()=>{u.value=C().year(b.value).month(g.value),m.value=!1,w()},w=()=>{const v=u.value.startOf("month").format("DD-MM-YYYY"),r=u.value.endOf("month").format("DD-MM-YYYY");Y("update-filters",{startDate:v,endDate:r})};N(()=>{w()});const B=v=>{m.value&&!v.target.closest(".relative")&&(m.value=!1)};return N(()=>{document.addEventListener("click",B)}),(v,r)=>(l(),n("div",ie,[e("button",{onClick:x,class:"text-indigo-600 hover:underline"},r[3]||(r[3]=[e("img",{src:"/storage/images/arrow_drop_down_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)])),e("div",de,[e("span",{onClick:F,class:"font-semibold text-gray-900 text-[17px] cursor-pointer hover:text-[#6db631] transition-colors"},c(u.value.format("MMMM YYYY")),1),m.value?(l(),n("div",{key:0,class:"absolute right-[-33%] z-50 bg-white border rounded-lg shadow-lg p-4 mt-2 min-w-[250px]",onClick:r[2]||(r[2]=G(()=>{},["stop"]))},[e("div",ue,[e("div",null,[r[4]||(r[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"M√™s",-1)),V(e("select",{"onUpdate:modelValue":r[0]||(r[0]=d=>g.value=d),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#6db631]"},[(l(),n(f,null,h(_,(d,P)=>e("option",{key:P,value:P},c(d),9,ce)),64))],512),[[z,g.value]])]),e("div",null,[r[5]||(r[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Ano",-1)),V(e("select",{"onUpdate:modelValue":r[1]||(r[1]=d=>b.value=d),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#6db631]"},[(l(!0),n(f,null,h(L.value,d=>(l(),n("option",{key:d,value:d},c(d),9,me))),128))],512),[[z,b.value]])]),e("div",{class:"flex justify-end gap-2 pt-2"},[e("button",{onClick:y,class:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium"}," Cancelar "),e("button",{onClick:R,class:"px-4 py-2 text-sm bg-[#6db631] text-white rounded-md hover:bg-[#5a9929] font-medium"}," Aplicar ")])])])):U("",!0)]),e("button",{onClick:D,class:"text-indigo-600 hover:underline"},r[6]||(r[6]=[e("img",{src:"/storage/images/arrow_drop_direita_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)]))]))}},ge={class:"flex justify-end mb-4"},ve={xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",style:{fill:"#018f7f",transform:"msfilter"}},fe={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},xe={class:"flex items-center space-x-2 justify-end"},he={class:"text-gray-900 text-[17px] font-semibold"},be={class:"mt-5"},_e={class:"grid grid-cols-2 grid-rows-1 gap-4"},ye={class:"rounded-lg"},we={class:"w-full text-left text-[14px] border-collapse font-['Figtree']"},ke={key:0},Ce={key:1},$e={class:"px-5 py-2 text-right valores"},De={class:"bg-[#174111] text-white"},Fe={colspan:"2",class:"p-1 px-5"},Re={key:0},Me={key:1},Ae={class:"p-1 px-5 categorias align-middle"},Ye={class:"px-5 py-1 text-right valores"},Pe={class:"bg-[#174111] text-white"},Se={colspan:"1",class:"p-2 text-right font-bold"},Le={class:"mt-4 p-4 bg-green-100 text-green-800 rounded font-medium text-sm"},Be={class:"mt-5"},je={class:"bg-white rounded-lg shadow"},Ne={ref:"scrollContainer",class:"overflow-y-auto max-h-96 scroll-hidden"},Ee={class:"space-y-2"},Ve={key:0},ze={class:"text-center text-gray-600 font-semibold"},Ie={class:"text-center text-gray-600 font-medium"},Oe={class:"text-center text-gray-600 font-semibold"},Je={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ue={class:"bg-white rounded-lg max-w-xl p-6 shadow-lg relative"},Te={class:"text-gray-700 leading-relaxed text-sm whitespace-pre-line"},Ge={__name:"Index",setup(T){const $=i("0,00"),Y=i("0,00"),u=i("0,00"),m=i([]),g=i([]),b=i(""),_=i(!0),L=i("pie");let x=null;const D=i([]),F=i([]),y=i([]),R=i(!1),w=J(()=>P(g.value)),B=s=>{console.log("Filtros atualizados:",s),r(s.startDate,s.endDate)},v=()=>{window.open("/relatorios/faturamento-anual","_blank")},r=async(s,t)=>{_.value=!0;try{const o=(await K.get("/api/painel-dre/analitycs-dre",{params:{start_date:s,end_date:t}})).data;console.log("DRE API Response:",o),console.log("Total Salarios from API:",o.total_salarios),$.value=o.total_caixas||"0,00",Y.value=o.total_salarios||"0,00",u.value=o.resultado_do_periodo||"0,00",m.value=o.grupos||[],g.value=o.calendario||[],b.value=o.explicacao_dre||[],F.value=o.grafico_data.labels||[],D.value=o.grafico_data.data||[],y.value=o.grafico_data.porcentagens||[],d()}catch(a){console.error("Erro ao buscar os dados do DRE:",a),$.value="0,00",Y.value="0,00",u.value="0,00",m.value=[],g.value=[],F.value=[],D.value=[],y.value=[],x&&(x.destroy(),x=null)}finally{_.value=!1}};O.register(ee,te,oe,se,ae,le,re,X);const d=()=>{const s=document.getElementById("myChart");if(!s)return;const t=s.getContext("2d");x&&x.destroy();const a={type:L.value,data:{labels:F.value,datasets:[{data:D.value,backgroundColor:["#6DB631","#FF9500","#FF2D55","#5856D6","#F7464A","#FF7F50"],borderColor:void 0,borderWidth:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(o){const p=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.raw),k=y.value[o.dataIndex];return`${o.label}: ${p} (${k})`}}},legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,boxWidth:10}},datalabels:{display:!0,color:"#fff",formatter:(o,p)=>{const k=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),S=y.value[p.dataIndex];return`${k}
(${S})`},font:{weight:"bold",size:10},anchor:"end",align:"start",offset:10}},scales:{}}};x=new O(t,a)};N(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1).toLocaleDateString("pt-BR").split("/").join("-"),a=new Date(s.getFullYear(),s.getMonth()+1,0).toLocaleDateString("pt-BR").split("/").join("-");r(t,a)});const P=s=>{if(!s||s.length===0)return"";const t=new Date,a=t.getMonth()+1;t.getFullYear();const o=s.find(A=>A.nome_mes.toLowerCase()===E(a).toLowerCase()),p=s.find(A=>A.nome_mes.toLowerCase()===E(a-1).toLowerCase());if(!o)return"";const k=A=>Number(A.replace(/\./g,"").replace(",",".")),S=o?k(o.resultado_do_periodo):0,j=p?k(p.resultado_do_periodo):null;let M="";return j===null?M=`Ol√°! No m√™s de ${o.nome_mes}, seu resultado foi de R$ ${o.resultado_do_periodo}. Vamos continuar assim! üöÄ`:S>j?M=`Boa not√≠cia! Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) melhorou em rela√ß√£o a ${p.nome_mes} (R$ ${p.resultado_do_periodo}). Continue assim! üéâ`:S<j?M=`Aten√ß√£o: o resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° abaixo do m√™s anterior (${p.nome_mes} - R$ ${p.resultado_do_periodo}). Vamos analisar juntos para melhorar`:M=`Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° est√°vel em rela√ß√£o a ${p.nome_mes}. Seguimos firmes! üëç`,M},E=s=>{const t=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];return s<1&&(s=12+s),s>12&&(s=s%12),t[s-1]};return(s,t)=>(l(),W(Q,null,{default:q(()=>[I(H(Z),{title:"Painel"}),t[13]||(t[13]=e("div",{class:"painel-title"},"DRE Gerencial",-1)),t[14]||(t[14]=e("div",{class:"painel-subtitle"},[e("p",null,"Acompanhe a sa√∫de da sua opera√ß√£o")],-1)),e("div",ge,[e("button",{onClick:t[0]||(t[0]=a=>R.value=!0),class:"mr-2",placeholder:"Ajuda a entender esses gr√°ficos!"},[(l(),n("svg",ve,t[2]||(t[2]=[e("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"},null,-1)])))]),e("button",{onClick:v,class:"mr-3 bg-[#174111] hover:bg-[#12330d] text-white font-bold py-1 px-3 rounded text-sm transition duration-300"}," Imprimir Relat√≥rio Anual "),e("div",fe,[e("div",xe,[e("span",he,[I(pe,{onUpdateFilters:B})])])])]),e("div",be,[e("div",_e,[e("div",ye,[e("table",we,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"bg-[#174111] text-white"},[e("th",{colspan:"2",class:"p-1 px-5"},"Faturamento do Per√≠odo")])],-1)),_.value?(l(),n("tbody",ke,[(l(),n(f,null,h(1,a=>e("tr",{key:a},t[3]||(t[3]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)]))),64))])):(l(),n("tbody",Ce,[e("tr",null,[t[4]||(t[4]=e("td",{class:"p-1 px-5 categorias"},"Faturamento do Per√≠odo",-1)),e("td",$e," R$ "+c($.value),1)])])),(l(!0),n(f,null,h(m.value,a=>(l(),n(f,{key:a.nome_grupo},[e("thead",null,[e("tr",De,[e("th",Fe,c(a.nome_grupo),1)])]),_.value?(l(),n("tbody",Re,[(l(!0),n(f,null,h(a.categorias.length||3,o=>(l(),n("tr",{key:o},t[5]||(t[5]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)])))),128))])):(l(),n("tbody",Me,[(l(!0),n(f,null,h(a.categorias,o=>(l(),n("tr",{key:o.categoria,class:"odd:bg-gray-100 even:bg-white p-1 px-5"},[e("td",Ae,c(o.categoria),1),e("td",Ye," R$ "+c(o.total),1)]))),128))]))],64))),128)),e("thead",null,[e("tr",Pe,[t[6]||(t[6]=e("th",{colspan:"1",class:"p-2"},"Resultado do Per√≠odo",-1)),e("th",Se," R$ "+c(u.value),1)])])])]),e("div",null,[t[11]||(t[11]=e("div",{class:"bg-white rounded-lg p-5 flex justify-center w-full h-[480px]"},[e("canvas",{id:"myChart"})],-1)),e("div",Le,c(w.value),1),e("div",Be,[t[10]||(t[10]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"}," Hist√≥rico de Resultados ")],-1)),e("div",je,[t[9]||(t[9]=e("div",{class:"bg-[#164110] grid grid-cols-3 gap-4 py-2 px-6 text-xs font-semibold text-[#FFFFFF] uppercase tracking-wider rounded-tl-2xl rounded-tr-2xl"},[e("span",{class:"text-center px-5"},"M√äS"),e("span",{class:"text-center"},"CMV"),e("span",{class:"text-center"},"RESULTADO")],-1)),e("div",Ne,[e("ul",Ee,[_.value?(l(),n("li",Ve,[(l(),n(f,null,h(5,a=>e("div",{key:a,class:"grid grid-cols-3 gap-4 px-6 py-2"},t[8]||(t[8]=[e("span",{class:"shimmer h-5 w-3/4 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1)]))),64))])):(l(!0),n(f,{key:1},h(g.value,a=>(l(),n("li",{key:a.nome_mes,class:"hover:bg-gray-200 grid grid-cols-3 text-[15px] p-1"},[e("span",ze,c(a.nome_mes),1),e("span",Ie," R$ "+c(a.valor_cmv),1),e("span",Oe," R$ "+c(a.resultado_do_periodo),1)]))),128))])],512)])])])])]),R.value?(l(),n("div",Je,[e("div",Ue,[e("button",{onClick:t[1]||(t[1]=a=>R.value=!1),class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-xl font-bold"}," √ó "),t[12]||(t[12]=e("h2",{class:"text-xl font-bold mb-4"},"Como funcionam os c√°lculos do DRE",-1)),e("p",Te,c(b.value),1)])])):U("",!0)]),_:1}))}},et=ne(Ge,[["__scopeId","data-v-bb3055ca"]]);export{et as default};
