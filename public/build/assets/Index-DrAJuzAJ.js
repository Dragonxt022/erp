import{y as E,i as b,o as p,e as x,a as e,t as w,b as m,u as N,Z as B,r as D,l as z,d as c,c as Q,w as R,h as k,j as P,v as F,f as y,n as G,p as K,g as Z,F as H,k as I}from"./app-XQNgxGVt.js";import{u as J}from"./user-CtnA9HbC.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{B as W,a as j}from"./ButtonCancelar--0dajmno.js";const X={setup(){const i=J();E(async()=>{i.user||await i.fetchUserProfile()});const a=b(()=>i.user),d=b(()=>{var n;return(n=i.user)==null?void 0:n.unidade}),r=b(()=>{var n,l;return((n=a.value)==null?void 0:n.profile_photo_url)||`https://ui-avatars.com/api/?name=${v((l=a.value)==null?void 0:l.name)}&color=7F9CF5&background=EBF4FF`});function v(n){return n?n.split(" ").map(h=>h.charAt(0).toUpperCase()).join(""):"*"}return{user:a,profilePhoto:r,unidade:d}}},Y={class:"navbar"},ee={class:"navbar-content"},te={class:"navbar-left"},se={class:"navbar-logo"},ae=["href"],oe={class:"navbar-right"},re={class:"user-info"},ne=["src"],le={class:"user-details"},ie={class:"user-name"},de={class:"user-location"};function ue(i,a,d,r,v,n){var l,f;return p(),x("div",Y,[a[2]||(a[2]=e("div",{class:"navbar-background"},null,-1)),e("div",ee,[e("div",te,[e("div",se,[a[1]||(a[1]=e("div",{class:"mr-4"},[e("a",{href:"https://www.taiksu.com.br/office/",target:"_blank"},[e("img",{src:"/storage/images/quadrados_verdes.svg",alt:"Quadrados verdes",class:"w-full h-full"})])],-1)),e("div",null,[e("a",{href:i.route("franqueado.painel")},a[0]||(a[0]=[e("img",{src:"/storage/images/logo_tipo_verde.svg",alt:"logo tipo verde",class:"w-full h-full"},null,-1)]),8,ae)])])]),e("div",oe,[e("div",re,[e("img",{src:r.profilePhoto,alt:"Avatar",class:"avatar"},null,8,ne),e("div",le,[e("div",ie,w((l=r.user)==null?void 0:l.name),1),e("div",de,w(((f=r.unidade)==null?void 0:f.cidade)||"Taiksu Franchising"),1)])])])])])}const ce=C(X,[["render",ue],["__scopeId","data-v-7da9338b"]]),pe={class:"content"},fe={__name:"LayoutFranqueadoEstoque",props:{title:String},setup(i){return(a,d)=>(p(),x("div",null,[m(N(B),{title:i.title},null,8,["title"]),m(ce),e("main",pe,[D(a.$slots,"default",{},void 0,!0)])]))}},xe=C(fe,[["__scopeId","data-v-d6734dee"]]),ve={key:0,class:"loading-overlay"},ge={class:"search-container relative flex items-center mb-4 justify-self-end"},me={class:"flex justify-between items-center h-full px-6"},he={class:"flex gap-4"},_e={class:"w-[267px] h-[124.72px] relative"},be={class:"w-[267px] h-[43.91px] left-0 top-[80.80px] absolute"},we={class:"w-full h-[42.16px] left-0 top-[30px] absolute opacity-80 bg-white rounded-lg border-2 border-[#d7d7db] justify-start items-center inline-flex overflow-hidden"},ye={class:"grid"},ke={class:"min-w-full table-auto"},Ce={class:"text-[16px] text-left text-gray-900 font-semibold"},qe={class:"flex items-center gap-4"},$e=["src"],Pe={class:"text-[16px] text-gray-900 font-semibold text-center border-l border-r border-[#c4c4c4]"},Fe={class:"text-[16px] text-gray-900 font-semibold text-center"},Ie={class:"relative w-[200px] h-[56.76px] mx-auto flex items-center justify-between bg-[#efeff4] rounded-xl px-2"},je=["onClick"],Ee=["value","onInput"],Ne=["onClick"],Be={__name:"Index",setup(i){const a=z(),d=c([]),r=c({}),v=c("");let n=c(!1);const l=c(!1),f=c(!1),h=c(!1),g=c(""),M=async()=>{try{const s=await I.get("/api/estoque/lista-produtos");d.value=Object.values(s.data.produtos)}catch(s){console.error("Erro ao carregar os produtos:",s)}},q=(s,t)=>{const o=d.value.find(_=>_.id===s);if(!o)return;const u=r.value[s]||{id:o.id,nome:o.nome,quantidade:0};u.quantidade+=t,u.quantidade>0?(r.value[s]=u,l.value=!0):delete r.value[s]},A=(s,t)=>{t<0&&(t=0),r.value[s]={...r.value[s],quantidade:t}},L=async()=>{if(!g.value){a.info("Por favor, insira seu PIN.");return}const s=Object.values(r.value);if(s.length===0){a.warning("O carrinho está vazio. Adicione itens antes de continuar.");return}h.value=!0;try{console.log("Itens do carrinho:",s),console.log("PIN:",g.value);const t=await I.post("/api/estoque/consumir-estoque",{itens:s,pin:g.value});t.status===200?(a.success(t.data.message),r.value={},g.value="",$(),t.data.redirect_url&&(window.location.href=t.data.redirect_url)):console.error("Erro:",error)}catch(t){if(a.error(t.response.data.error),t.response){const{status:o,data:u}=t.response;o===403?a.error("PIN incorreto. Verifique e tente novamente."):o===400?a.error(u.error||"Estoque insuficiente para um ou mais itens."):console.error("Erro:",t)}else a.error("Ops! Ouve um erro.")}finally{h.value=!1}};E(M);const V=b(()=>d.value.map(s=>({...s,quantidade_total:s.quantidade_total||0}))),O=b(()=>V.value.filter(s=>s.nome.toLowerCase().includes(v.value.toLowerCase()))),S=()=>{n.value=!n.value,d.value=[...d.value].sort((s,t)=>n.value?t.nome.localeCompare(s.nome):s.nome.localeCompare(t.nome))},T=()=>{l.value=!1},U=()=>{l.value=!1,f.value=!0},$=()=>{f.value=!1};return(s,t)=>(p(),Q(xe,null,{default:R(()=>[m(N(B),{title:"Controle de Estoque"}),h.value?(p(),x("div",ve,t[3]||(t[3]=[e("div",{class:"spinner"},null,-1)]))):k("",!0),e("div",ge,[t[4]||(t[4]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),P(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),placeholder:"Buscar um produto",class:"search-input pl-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 w-[500px]"},null,512),[[F,v.value]])]),l.value?(p(),x("div",{key:1,class:G(["fixed bottom-0 left-0 right-0 w-full h-[148px] bg-white border-t-4 border-[#5a9f28] shadow-lg transform transition-all duration-500 ease-out",l.value?"translate-y-0":"translate-y-full"])},[e("div",me,[t[5]||(t[5]=e("div",{class:"w-[291px] h-[58.17px] text-black text-[28px] font-bold font-['Figtree'] leading-[34px] tracking-tight"},[y(" Prosseguir com a "),e("br"),y(" alteração de estoque? ")],-1)),e("div",he,[m(W,{onClick:T,text:"Cancelar"}),m(j,{text:"Continuar",iconPath:"/storage/images/arrow_left_alt.svg",onClick:U})])])],2)):k("",!0),f.value?(p(),x("div",{key:2,onClick:$,class:"fixed top-0 left-0 right-0 bottom-0 bg-opacity-50 bg-gray-900 flex justify-center items-center"},[e("div",{onClick:t[2]||(t[2]=K(()=>{},["stop"])),class:"w-[405px] h-[523px] px-[23px] py-[33px] bg-white rounded-[20px] flex-col justify-center items-center gap-[68px] inline-flex"},[t[7]||(t[7]=e("div",{class:"w-[267px] h-[229.61px] relative"},[e("div",{class:"left-[-0px] top-[93.84px] absolute text-center text-[#262a27] text-[42.18px] font-bold font-['Figtree'] leading-[50.61px] tracking-wide"},[y(" Autenticação "),e("br"),y(" Obrigatória ")]),e("div",{class:"left-[20.03px] top-[205.61px] absolute text-center text-[#6d6d6d] text-lg font-normal font-['Figtree'] leading-[23.20px]"}," Identifique-se para prosseguir "),e("div",{class:"w-[83.46px] h-[83.46px] left-[91.74px] top-0 absolute"},[e("div",{class:"w-[83.46px] h-[83.46px] left-0 top-0 absolute"},[e("img",{src:"/storage/images/security.svg",alt:""})])])],-1)),e("div",_e,[e("div",be,[m(j,{onClick:L,text:"Autenticar",class:"w-full"})]),e("div",we,[P(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>g.value=o),type:"password",class:"w-full h-full text-xs font-normal tracking-widest border-none outline-none",placeholder:"●●●●",autocomplete:"off"},null,512),[[F,g.value]])]),t[6]||(t[6]=e("div",{class:"w-[68.51px] left-0 top-0 absolute text-[#262a27] text-[14.93px] font-semibold font-['Figtree'] leading-tight"}," Seu PIN ",-1))])])])):k("",!0),e("div",ye,[e("table",ke,[e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-4 text-xs text-left font-medium text-gray-500 uppercase tracking-wider TrRedonEsquerda",onClick:S},t[8]||(t[8]=[e("div",{class:"flex items-center gap-2"},[e("span",null,"Item"),e("img",{src:"/storage/images/sync_alt.svg",class:"w-[19px] h-[19px]"})],-1)])),t[9]||(t[9]=e("th",{class:"px-4 py-4 text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estoque ",-1)),t[10]||(t[10]=e("th",{class:"px-4 py-4 text-xs font-medium text-gray-500 uppercase tracking-wider TrRedonDireita"}," Retirada ",-1))])]),e("tbody",null,[(p(!0),x(H,null,Z(O.value,o=>{var u;return p(),x("tr",{key:o.id},[e("td",Ce,[e("div",qe,[e("img",{src:`/${o.profile_photo}`,alt:"Imagem do Produto",class:"w-12 h-12"},null,8,$e),e("span",null,w(o.nome),1)])]),e("td",Pe,w(o.quantidade_total)+" "+w(o.unidadeDeMedida==="a_granel"?"KG":"UN"),1),e("td",Fe,[e("div",Ie,[e("button",{class:"w-[40px] h-[30px] flex justify-center items-center text-[#6d6d6d] rounded-full",onClick:_=>q(o.id,-1)},t[11]||(t[11]=[e("span",{class:"text-[50px] font-bold"},"−",-1)]),8,je),e("input",{type:"number",class:"w-[90px] h-[42px] text-xl text-center text-[#6d6d6d] bg-transparent border border-gray-100 rounded",value:((u=r.value[o.id])==null?void 0:u.quantidade)||0,onInput:_=>A(o.id,_.target.value)},null,40,Ee),e("button",{class:"w-[40px] h-[30px] flex justify-center items-center",onClick:_=>q(o.id,1)},t[12]||(t[12]=[e("span",null,[e("img",{class:"w-[28px] h-[28px]",src:"/storage/images/Plus_verde.svg"})],-1)]),8,Ne)])])])}),128))])])])]),_:1}))}},Oe=C(Be,[["__scopeId","data-v-c7dc238c"]]);export{Oe as default};
