import{Q as N,d as p,i as A,j as E,c as $,o as l,w as z,b as w,a as t,u as P,Z as V,e as i,f as y,t as u,F,h as k,n as C,k as M}from"./app-Dv-t-2ap.js";import{A as S}from"./LayoutFranqueadora-D-Ci0_wi.js";import{p as U}from"./chartjs-plugin-datalabels.esm-BFtiKef5.js";import{C as v,B as T,c as Q,L as Z,d as O,e as W,b as q,f as G,p as H,a as J,i as K}from"./chart-CX66tr7T.js";import{U as X}from"./UnidadeSelectorDropdown-C_fBU8kw.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const tt={class:"flex flex-col md:flex-row justify-end items-center mb-6 gap-4"},et={class:"w-full md:w-64"},at={class:"mt-5"},st={class:"grid grid-cols-1 gap-6"},ot={class:"bg-white rounded-xl p-6 shadow-sm border border-gray-100"},rt={class:"h-[450px] relative"},nt={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-10"},lt={class:"bg-white rounded-xl p-6 shadow-sm border border-gray-100"},it={class:"flex items-center justify-between mb-8"},dt={class:"text-sm text-gray-500"},ct={class:"h-[400px] relative"},ut={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-10"},mt={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},pt={class:"overflow-x-auto"},ft={class:"w-full text-left border-collapse"},gt={key:0,class:"divide-y divide-gray-100"},bt={key:1,class:"divide-y divide-gray-100"},xt={class:"px-6 py-4"},yt={class:"flex flex-col"},vt={class:"font-bold text-gray-800"},ht={class:"text-xs text-gray-400"},_t={class:"px-6 py-4 text-right font-bold text-gray-900 text-base"},wt={class:"px-6 py-4 text-right"},Ft={key:0,class:"text-xs"},kt={key:1,class:"text-xs"},Ct={class:"font-semibold"},Bt={class:"px-6 py-4 text-right"},Rt={__name:"Faturamento",setup(Dt){v.register(T,Q,Z,O,W,q,G,H,J,K,U);const B=N(),f=p(B.props.auth.user.unidade_id),m=p(!0),n=p([]),g=p([]),h=p(0);let b=null,x=null;const R=A(()=>[...n.value].reverse()),D=r=>{f.value=r,_()},_=async()=>{m.value=!0;try{const r=await M.get("/api/admin/painel/faturamento-analitico",{params:{unidade_id:f.value}});n.value=r.data.dados||[],g.value=r.data.projecao||[],h.value=r.data.media_crescimento||0,j(),I()}catch(r){console.error("Erro ao buscar faturamento analítico:",r)}finally{m.value=!1}},j=()=>{const r=document.getElementById("revenueChart");if(!r)return;b&&b.destroy();const e=n.value.map(a=>`${a.nome_mes.substring(0,3)}/${a.ano.substring(2)}`),s=n.value.map(a=>a.faturamento),d=n.value.map(a=>a.diferenca);b=new v(r,{type:"bar",data:{labels:e,datasets:[{label:"Faturamento",data:s,backgroundColor:"#164110",borderRadius:4,order:2,yAxisID:"y",datalabels:{color:"#164110",anchor:"end",align:"top",offset:4,font:{weight:"bold",size:10,family:"Figtree"},formatter:a=>a===0?"":new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(a)}},{label:"Variação",data:d,backgroundColor:n.value.map(a=>a.diferenca>=0?"#6DB631":"#FF2D55"),borderRadius:4,order:1,yAxisID:"y1",datalabels:{display:!0,color:a=>a.dataset.backgroundColor[a.dataIndex],anchor:"start",align:"bottom",offset:4,font:{weight:"bold",size:9,family:"Figtree"},formatter:a=>a===0?"":(a>0?"+":"")+new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(a)}}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{grid:{display:!1},ticks:{font:{family:"Figtree",weight:"600"}}},y:{type:"linear",display:!0,position:"left",grid:{color:"#f3f4f6"},ticks:{font:{family:"Figtree"},callback:a=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(a)}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},ticks:{font:{family:"Figtree"},callback:a=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(a)}}},plugins:{legend:{display:!1},tooltip:{padding:12,backgroundColor:"#164110",titleFont:{family:"Figtree",size:14,weight:"bold"},bodyFont:{family:"Figtree",size:13},cornerRadius:8,callbacks:{label:function(a){let c=a.dataset.label||"";return c&&(c+=": "),a.parsed.y!==null&&(c+=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.parsed.y)),c}}}}}})},I=()=>{const r=document.getElementById("projectionChart");if(!r)return;x&&x.destroy(),n.value.map(o=>`${o.nome_mes.substring(0,3)}/${o.ano.substring(2)}`);const e=g.value.map(o=>`${o.nome_mes.substring(0,3)}/${o.ano.substring(2)}`);let s=-1;for(let o=n.value.length-1;o>=0;o--)if(n.value[o].faturamento>0){s=o;break}if(s===-1)return;const d=n.value[s],c=[`${d.nome_mes.substring(0,3)}/${d.ano.substring(2)}`,...e],L=[d.faturamento,...g.value.map(o=>o.faturamento)];x=new v(r,{type:"line",data:{labels:c,datasets:[{label:"Projeção de Faturamento",data:L,borderColor:"#164110",backgroundColor:"rgba(22, 65, 16, 0.1)",borderWidth:3,borderDash:[5,5],fill:!0,tension:.4,pointRadius:4,pointBackgroundColor:"#164110",datalabels:{color:"#164110",anchor:"end",align:"top",offset:8,font:{weight:"bold",size:10,family:"Figtree"},formatter:o=>new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(o)}}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{padding:12,backgroundColor:"#164110",callbacks:{label:function(o){return"Estimativa: "+new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.parsed.y)}}}},scales:{x:{grid:{display:!1},ticks:{font:{family:"Figtree",weight:"600"}}},y:{beginAtZero:!1,grid:{color:"#f3f4f6"},ticks:{font:{family:"Figtree"},callback:o=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(o)}}}}})};return E(()=>{_()}),(r,e)=>(l(),$(S,null,{default:z(()=>[w(P(V),{title:"Faturamento Analítico"}),e[10]||(e[10]=t("div",{class:"painel-title"},"Faturamento Analítico",-1)),e[11]||(e[11]=t("div",{class:"painel-subtitle"},[t("p",null,"Análise comparativa de faturamento dos últimos 12 meses")],-1)),t("div",tt,[t("div",et,[w(X,{"default-unit-id":f.value,onUnitSelected:D},null,8,["default-unit-id"])])]),t("div",at,[t("div",st,[t("div",ot,[e[2]||(e[2]=t("div",{class:"flex items-center justify-between mb-8"},[t("div",null,[t("h3",{class:"text-xl font-bold text-gray-800"},"Evolução de 12 Meses"),t("p",{class:"text-sm text-gray-500"},"Comparativo mensal e variação nominal")]),t("div",{class:"flex flex-wrap gap-4"},[t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-4 h-4 bg-[#164110] rounded-sm shadow-sm"}),t("div",{class:"flex flex-col"},[t("span",{class:"text-xs font-bold text-gray-700"},"Faturamento"),t("span",{class:"text-[10px] text-gray-400"},"Total do mês")])]),t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-4 h-4 bg-[#6DB631] rounded-sm shadow-sm"}),t("div",{class:"flex flex-col"},[t("span",{class:"text-xs font-bold text-green-700"},"Crescimento"),t("span",{class:"text-[10px] text-gray-400"},"Variação positiva")])]),t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-4 h-4 bg-[#FF2D55] rounded-sm shadow-sm"}),t("div",{class:"flex flex-col"},[t("span",{class:"text-xs font-bold text-red-700"},"Queda"),t("span",{class:"text-[10px] text-gray-400"},"Variação negativa")])])])],-1)),t("div",rt,[m.value?(l(),i("div",nt,e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#164110]"},null,-1)]))):y("",!0),e[1]||(e[1]=t("canvas",{id:"revenueChart"},null,-1))])]),t("div",lt,[t("div",it,[t("div",null,[e[3]||(e[3]=t("h3",{class:"text-xl font-bold text-gray-800"},"Projeção para os Próximos 12 Meses",-1)),t("p",dt,"Estimativa baseada na média de crescimento histórico ("+u(h.value)+"%)",1)]),e[4]||(e[4]=t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-8 h-1 bg-[#164110] border-t-2 border-dashed border-[#164110]"}),t("span",{class:"text-xs font-bold text-gray-700"},"Tendência Projetada")],-1))]),t("div",ct,[m.value?(l(),i("div",ut,e[5]||(e[5]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#164110]"},null,-1)]))):y("",!0),e[6]||(e[6]=t("canvas",{id:"projectionChart"},null,-1))])]),t("div",mt,[e[9]||(e[9]=t("div",{class:"p-6 border-b border-gray-50"},[t("h3",{class:"text-lg font-bold text-gray-800"},"Detalhamento Mensal")],-1)),t("div",pt,[t("table",ft,[e[8]||(e[8]=t("thead",null,[t("tr",{class:"bg-gray-50 text-[11px] font-bold text-gray-500 uppercase tracking-wider"},[t("th",{class:"px-6 py-4"},"Período"),t("th",{class:"px-6 py-4 text-right"},"Faturamento Total"),t("th",{class:"px-6 py-4 text-right"},"Variação Nominal"),t("th",{class:"px-6 py-4 text-right"},"Variação Percentual")])],-1)),m.value?(l(),i("tbody",gt,[(l(),i(F,null,k(5,s=>t("tr",{key:s},e[7]||(e[7]=[t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-24 animate-pulse"})],-1),t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-20 animate-pulse ml-auto"})],-1),t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-20 animate-pulse ml-auto"})],-1),t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-16 animate-pulse ml-auto"})],-1)]))),64))])):(l(),i("tbody",bt,[(l(!0),i(F,null,k(R.value,(s,d)=>(l(),i("tr",{key:d,class:"hover:bg-gray-50 transition-colors"},[t("td",xt,[t("div",yt,[t("span",vt,u(s.nome_mes),1),t("span",ht,u(s.ano),1)])]),t("td",_t," R$ "+u(s.faturamento_formatado),1),t("td",wt,[t("div",{class:C(["flex items-center justify-end gap-1",s.diferenca>=0?"text-green-600":"text-red-600"])},[s.diferenca>0?(l(),i("span",Ft,"▲")):s.diferenca<0?(l(),i("span",kt,"▼")):y("",!0),t("span",Ct,"R$ "+u(s.diferenca_formatada),1)],2)]),t("td",Bt,[t("span",{class:C(["px-2 py-1 rounded-full text-xs font-bold",s.percentual>=0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},u(s.percentual>=0?"+":"")+u(s.percentual)+"% ",3)])]))),128))]))])])])])])]),_:1}))}},$t=Y(Rt,[["__scopeId","data-v-2d21810a"]]);export{$t as default};
