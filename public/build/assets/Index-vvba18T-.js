import{ae as G,k as C,e as g,o as v,a as e,t as _,i as M,j as w,a4 as N,b,u as D,Z as L,r as K,l as Z,d as p,c as H,w as J,f as k,m as I,v as j,n as W,g as y,p as X,F as Y,h as ee}from"./app-BCWFP67y.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{B}from"./ButtonPrimaryMedio-9fGTOSrL.js";import{B as te}from"./ButtonCancelar-CeYAldPs.js";const se=G("user",{state:()=>({user:null}),actions:{async fetchUserProfile(){if(!this.user)try{const i=await C.get("/api/navbar-profile");i.data.status==="success"?this.user=i.data.data:console.error("Erro ao carregar o perfil:",i.data.message)}catch(i){console.error("Erro ao buscar perfil:",i)}},clearUser(){this.user=null}}}),ae={setup(){const i=se();M(async()=>{i.user||await i.fetchUserProfile()});async function o(){N.post("/logout",{},{onFinish:()=>{i.user=null,N.visit("/login-estoque")}})}const d=w(()=>i.user),n=w(()=>{var l;return(l=i.user)==null?void 0:l.unidade}),m=w(()=>{var l,u;return((l=d.value)==null?void 0:l.profile_photo_url)||`https://ui-avatars.com/api/?name=${x((u=d.value)==null?void 0:u.name)}&color=7F9CF5&background=EBF4FF`});function x(l){return l?l.split(" ").map(c=>c.charAt(0).toUpperCase()).join(""):"*"}return{user:d,profilePhoto:m,unidade:n,logout:o}}},oe={class:"navbar"},re={class:"navbar-content"},ne={class:"navbar-left"},le={class:"navbar-logo"},ie=["href"],de={class:"navbar-right"},ue={class:"user-info"},ce=["src"],fe={class:"user-details"},pe={class:"user-name"},ve={class:"user-location"};function ge(i,o,d,n,m,x){var l,u;return v(),g("div",oe,[o[4]||(o[4]=e("div",{class:"navbar-background"},null,-1)),e("div",re,[e("div",ne,[e("div",le,[o[2]||(o[2]=e("div",{class:"mr-4"},[e("a",{href:"https://www.taiksu.com.br/office/",target:"_blank"},[e("img",{src:"/storage/images/quadrados_verdes.svg",alt:"Quadrados verdes",class:"w-full h-full"})])],-1)),e("div",null,[e("a",{href:i.route("franqueado.painel")},o[1]||(o[1]=[e("img",{src:"/storage/images/logo_tipo_verde.svg",alt:"logo tipo verde",class:"w-full h-full"},null,-1)]),8,ie)])])]),e("div",de,[e("div",ue,[e("img",{src:n.profilePhoto,alt:"Avatar",class:"avatar"},null,8,ce),e("div",fe,[e("div",pe,_((l=n.user)==null?void 0:l.name),1),e("div",ve,_(((u=n.unidade)==null?void 0:u.cidade)||"Taiksu Franchising"),1)])]),e("button",{onClick:o[0]||(o[0]=(...h)=>n.logout&&n.logout(...h)),class:"logout-button"},o[3]||(o[3]=[e("img",{src:"/storage/images/botao_sair.svg",alt:"Logout",class:"logout-icon"},null,-1)]))])])])}const me=F(ae,[["render",ge],["__scopeId","data-v-9533adbc"]]),xe={class:"content"},he={__name:"LayoutFranqueadoEstoque",props:{title:String},setup(i){return(o,d)=>(v(),g("div",null,[b(D(L),{title:i.title},null,8,["title"]),b(me),e("main",xe,[K(o.$slots,"default",{},void 0,!0)])]))}},be=F(he,[["__scopeId","data-v-d6734dee"]]),_e={key:0,class:"loading-overlay"},we={class:"search-container relative flex items-center mb-4 justify-self-end"},ye={class:"flex justify-between items-center h-full px-6"},qe={class:"flex gap-4"},ke={class:"w-[267px] h-[124.72px] relative"},Ce={class:"w-[267px] h-[43.91px] left-0 top-[80.80px] absolute"},Fe={class:"w-full h-[42.16px] left-0 top-[30px] absolute opacity-80 bg-white rounded-lg border-2 border-[#d7d7db] justify-start items-center inline-flex overflow-hidden"},$e={class:"grid"},Pe={class:"min-w-full table-auto"},Ee={class:"text-[16px] text-left text-gray-900 font-semibold"},Ne={class:"flex items-center gap-4"},Ie=["src"],je={class:"text-[16px] text-gray-900 font-semibold text-center border-l border-r border-[#c4c4c4]"},Be={class:"text-[16px] text-gray-900 font-semibold text-center"},Me={class:"relative w-[300px] h-[56.76px] mx-auto flex items-center justify-between bg-[#efeff4] rounded-xl px-2"},De=["onClick","disabled"],Le=["value","onInput","max","aria-invalid"],Se=["onClick","disabled"],Ae={__name:"Index",setup(i){const o=Z(),d=p([]),n=p({}),m=p("");let x=p(!1);const l=p(!1),u=p(!1),h=p(!1),c=p(""),S=async()=>{try{const a=await C.get("/api/estoque/lista-produtos");d.value=Object.values(a.data.produtos)}catch(a){console.error("Erro ao carregar os produtos:",a)}},$=(a,t)=>{const s=d.value.find(f=>f.id===a);if(!s)return;const r=n.value[a]||{id:s.id,nome:s.nome,quantidade:0};r.quantidade+=t,r.quantidade>0?(n.value[a]=r,l.value=!0):delete n.value[a]},A=a=>{const t=n.value[a],s=d.value.find(r=>r.id===a);return t&&(t.quantidade<0||t.quantidade>s.quantidade_total)},U=(a,t)=>{const s=d.value.find(f=>f.id===a);if(!s){o.error("Produto não encontrado.");return}t=t.replace(",",".");let r=parseFloat(t);if(isNaN(r)){o.warning("Quantidade inválida.");return}if(s.unidadeDeMedida==="a_granel"){r=Number(t);const f=r.toLocaleString("pt-BR",{minimumFractionDigits:4,maximumFractionDigits:4});r=parseFloat(f.replace(",","."))}else r=Math.floor(r);if(r<0||r>s.quantidade_total){o.warning(`Quantidade inválida. Deve ser entre 0 e ${s.quantidade_total} ${s.unidadeDeMedida==="a_granel"?"kg":"unidades"}.`);return}n.value[a]={...n.value[a],id:s.id,nome:s.nome,quantidade:r},l.value=!0,r===0&&delete n.value[a]};M(()=>{const a=document.getElementById("fullscreen-icon");a&&a.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}),S()});const O=w(()=>d.value.map(a=>({...a,quantidade_total:a.quantidade_total||0}))),T=w(()=>O.value.filter(a=>a.nome.toLowerCase().includes(m.value.toLowerCase()))),V=()=>{x.value=!x.value,d.value=[...d.value].sort((a,t)=>x.value?t.nome.localeCompare(a.nome):a.nome.localeCompare(t.nome))},Q=()=>{l.value=!1},R=()=>{l.value=!1,u.value=!0},P=()=>{u.value=!1},z=async()=>{if(!c.value||!/^\d{4,}$/.test(c.value)){o.info("Por favor, insira um PIN válido (mínimo 4 dígitos numéricos).");return}const a=Object.values(n.value);if(a.length===0){o.warning("O carrinho está vazio. Adicione itens antes de continuar.");return}h.value=!0;try{console.log("Itens do carrinho:",a),console.log("PIN:",c.value);const t=await C.post("/api/estoque/consumir-estoque",{itens:a,pin:c.value});t.status===200?(o.success(t.data.message),n.value={},c.value="",P(),t.data.redirect_url&&(window.location.href=t.data.redirect_url)):console.error("Erro:",error)}catch(t){if(o.error("Ouve um erro ao tentar enviar"),t.response){const{status:s,data:r}=t.response;s===403?o.error("PIN incorreto. Verifique e tente novamente."):s===400?o.error(r.error||"Estoque insuficiente para um ou mais itens."):console.error("Erro:",t)}else o.error("Ops! Ouve um erro.")}finally{h.value=!1}};return(a,t)=>(v(),H(be,null,{default:J(()=>[b(D(L),{title:"Controle de Estoque"}),h.value?(v(),g("div",_e,t[3]||(t[3]=[e("div",{class:"spinner"},null,-1)]))):k("",!0),e("div",we,[t[4]||(t[4]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),I(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),placeholder:"Buscar um produto",class:"search-input pl-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 w-[500px]"},null,512),[[j,m.value]]),t[5]||(t[5]=e("div",{id:"fullscreen-icon",class:"ml-5 cursor-pointer text-gray-500 hover:text-green-500",title:"Tela cheia"},[e("img",{src:"/storage/images/fullscreen.svg",alt:"fullscreen"})],-1))]),l.value?(v(),g("div",{key:1,class:W(["fixed bottom-0 left-0 right-0 w-full h-[148px] bg-white border-t-4 border-[#5a9f28] shadow-lg transform transition-all duration-500 ease-out",l.value?"translate-y-0":"translate-y-full"])},[e("div",ye,[t[6]||(t[6]=e("div",{class:"w-[291px] h-[58.17px] text-black text-[28px] font-bold font-['Figtree'] leading-[34px] tracking-tight"},[y(" Prosseguir com a "),e("br"),y(" alteração de estoque? ")],-1)),e("div",qe,[b(te,{onClick:Q,text:"Cancelar"}),b(B,{text:"Continuar",iconPath:"/storage/images/arrow_left_alt.svg",onClick:R})])])],2)):k("",!0),u.value?(v(),g("div",{key:2,onClick:P,class:"fixed top-0 left-0 right-0 bottom-0 bg-opacity-50 bg-gray-900 flex justify-center items-center"},[e("div",{onClick:t[2]||(t[2]=X(()=>{},["stop"])),class:"w-[405px] h-[523px] px-[23px] py-[33px] bg-white rounded-[20px] flex-col justify-center items-center gap-[68px] inline-flex"},[t[8]||(t[8]=e("div",{class:"w-[267px] h-[229.61px] relative"},[e("div",{class:"left-[-0px] top-[93.84px] absolute text-center text-[#262a27] text-[42.18px] font-bold font-['Figtree'] leading-[50.61px] tracking-wide"},[y(" Autenticação "),e("br"),y(" Obrigatória ")]),e("div",{class:"left-[20.03px] top-[205.61px] absolute text-center text-[#6d6d6d] text-lg font-normal font-['Figtree'] leading-[23.20px]"}," Identifique-se para prosseguir "),e("div",{class:"w-[83.46px] h-[83.46px] left-[91.74px] top-0 absolute"},[e("div",{class:"w-[83.46px] h-[83.46px] left-0 top-0 absolute"},[e("img",{src:"/storage/images/security.svg",alt:""})])])],-1)),e("div",ke,[e("div",Ce,[b(B,{onClick:z,text:"Autenticar",class:"w-full"})]),e("div",Fe,[I(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>c.value=s),type:"password",class:"w-full h-full text-xs font-normal tracking-widest border-none outline-none",placeholder:"●●●●",autocomplete:"off"},null,512),[[j,c.value]])]),t[7]||(t[7]=e("div",{class:"w-[68.51px] left-0 top-0 absolute text-[#262a27] text-[14.93px] font-semibold font-['Figtree'] leading-tight"}," Seu PIN ",-1))])])])):k("",!0),e("div",$e,[e("table",Pe,[e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-4 text-xs text-left font-medium text-gray-500 uppercase tracking-wider TrRedonEsquerda",onClick:V},t[9]||(t[9]=[e("div",{class:"flex items-center gap-2"},[e("span",null,"Item"),e("img",{src:"/storage/images/sync_alt.svg",class:"w-[19px] h-[19px]"})],-1)])),t[10]||(t[10]=e("th",{class:"px-4 py-4 text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estoque ",-1)),t[11]||(t[11]=e("th",{class:"px-4 py-4 text-xs font-medium text-gray-500 uppercase tracking-wider TrRedonDireita"}," Retirada ",-1))])]),e("tbody",null,[(v(!0),g(Y,null,ee(T.value,s=>{var r,f,E;return v(),g("tr",{key:s.id},[e("td",Ee,[e("div",Ne,[e("img",{src:`/${s.profile_photo}`,alt:"Imagem do Produto",class:"w-12 h-12"},null,8,Ie),e("span",null,_(s.nome),1)])]),e("td",je,_(s.quantidade_total)+" "+_(s.unidadeDeMedida==="a_granel"?"KG":"UN"),1),e("td",Be,[e("div",Me,[e("button",{class:"w-[40px] h-[30px] flex justify-center items-center text-[#6d6d6d] rounded-full",onClick:q=>$(s.id,-1),disabled:((r=n.value[s.id])==null?void 0:r.quantidade)<=0},t[12]||(t[12]=[e("span",{class:"text-[50px] font-bold"},"−",-1)]),8,De),e("input",{type:"number",class:"w-[150px] h-[42px] text-xl text-center text-[#6d6d6d] bg-transparent border border-gray-100 rounded",value:((f=n.value[s.id])==null?void 0:f.quantidade)??0,onInput:q=>U(s.id,q.target.value),max:s.quantidade_total,"aria-invalid":A(s.id)?"true":"false",step:"0.01"},null,40,Le),e("button",{class:"w-[40px] h-[30px] flex justify-center items-center",onClick:q=>$(s.id,1),disabled:((E=n.value[s.id])==null?void 0:E.quantidade)>=s.quantidade_total},t[13]||(t[13]=[e("span",null,[e("img",{class:"w-[28px] h-[28px]",src:"/storage/images/Plus_verde.svg"})],-1)]),8,Se)])])])}),128))])])])]),_:1}))}},Qe=F(Ae,[["__scopeId","data-v-68071eb8"]]);export{Qe as default};
