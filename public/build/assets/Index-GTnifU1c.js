import{s as $,o as l,e as c,a as e,j as E,v as Y,F as y,g as I,t as g,d as u,b as v,h as b,c as D,x as ee,i as F,y as L,w as se,u as ae,Z as oe}from"./app-CdeH1AjD.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{B as te,E as le,_ as C,I as V,C as ie,a as re,b as z,d as ne}from"./ConfirmDialog-KXNEAOhE.js";import{A as de}from"./AppLayout-CpTsiLAg.js";const ue={data(){return{usuarios:[],searchQuery:""}},mounted(){this.fetchUsuarios()},methods:{async fetchUsuarios(){try{const t=await $.get("/api/usuarios");this.usuarios=t.data}catch(t){console.error("Erro ao carregar usuários:",t)}},selecionarUsuario(t){this.$emit("usuario-selecionado",t)},getInitials(t){return t?t.split(" ").map(i=>i[0]).join("").slice(0,2).toUpperCase():"N/A"}},computed:{usuariosComFotos(){return this.usuarios.map(t=>({...t,profilePhoto:t.profile_photo_url||`https://ui-avatars.com/api/?name=${this.getInitials(t.name)}&color=7F9CF5&background=EBF4FF&size=55`}))},filteredUsuarios(){return this.usuariosComFotos.filter(t=>{const o=this.searchQuery.toLowerCase();return t.name.toLowerCase().includes(o)||t.cpf.toLowerCase().includes(o)})}}},ce={class:"search-container relative flex items-center w-full mb-4"},ve={class:"card-container"},pe=["onClick"],me={class:"card-inner"},fe={class:"icon-container"},ge={class:"icon-leaf"},he=["src"],_e={class:"text-container"},ye={class:"city"},be={class:"owner"};function xe(t,o,i,h,p,r){return l(),c("div",null,[o[4]||(o[4]=e("div",{class:"painel-title"},"Franqueados",-1)),o[5]||(o[5]=e("div",{class:"painel-subtitle"},[e("p",null,"Visualize os gestores das unidades")],-1)),e("div",ce,[o[1]||(o[1]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),E(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>p.searchQuery=n),placeholder:"Buscar por Nome ou CPF",class:"search-input pl-10 w-full py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[Y,p.searchQuery]])]),e("div",ve,[(l(!0),c(y,null,I(r.filteredUsuarios,n=>(l(),c("div",{key:n.id,class:"card cursor-pointer transform transition-transform duration-200 hover:shadow-lg",onClick:m=>r.selecionarUsuario(n)},[e("div",me,[e("div",fe,[o[2]||(o[2]=e("div",{class:"icon-bg"},null,-1)),e("div",ge,[e("img",{src:n.profilePhoto,alt:"Foto de perfil",class:"w-12 h-12 rounded-lg"},null,8,he)])]),e("div",_e,[e("div",ye,g(n.name),1),e("div",be,g(n.cpf),1)]),o[3]||(o[3]=e("div",{class:"action-icon"},null,-1))])],8,pe))),128))])])}const Ce=S(ue,[["render",xe],["__scopeId","data-v-e46bb4a3"]]),we={key:0,class:"w-full h-[350px] bg-white rounded-[20px] p-12 relative"},Ue={class:"relative w-full h-full"},$e={class:"flex items-center"},ke={class:"w-1/1 flex justify-center"},Fe=["src"],Ve={class:"w-2/3 pl-5"},Ee={class:"text-[#262a27] text-[28px] font-bold font-['Figtree'] leading-[30px] tracking-tight"},Ie={class:"owner"},De={class:"w-1/1"},Se={class:"mt-4"},qe={class:"flex items-center bg-[#f3f8f3] p-4 rounded-lg"},Be={class:"text-[#262a27] text-base font-semibold font-['Figtree'] leading-[13px] tracking-tight"},Pe={key:0,class:"absolute bottom-0 right-0"},je={__name:"DetalhesUsuario",props:{usuario:{type:Object,required:!0}},setup(t){const o=u(!1),i=()=>{o.value=!o.value},h=()=>{o.value=!1};return(p,r)=>(l(),c(y,null,[o.value?b("",!0):(l(),c("div",we,[e("div",Ue,[e("div",$e,[e("div",ke,[e("img",{src:t.usuario.profilePhoto||"/storage/images/default-profile.png",alt:"Foto do Usuário",class:"w-20 h-20 rounded-md shadow-lg"},null,8,Fe)]),e("div",Ve,[e("div",Ee,g(t.usuario.name||"N/A"),1),e("div",Ie,"CPF: "+g(t.usuario.cpf),1)]),e("div",De,[e("div",{class:"absolute top-4 right-4 cursor-pointer",onClick:r[0]||(r[0]=(...n)=>p.deleteUsuario&&p.deleteUsuario(...n))},r[1]||(r[1]=[e("img",{src:"/storage/images/delete.svg",alt:"Deletar Usuário",class:"w-6 h-6"},null,-1)]))])]),e("div",Se,[r[2]||(r[2]=e("p",{class:"p-3"},"E-mail",-1)),e("div",qe,[e("div",Be,g(t.usuario.email||"N/A"),1)])]),t.usuario.id?(l(),c("div",Pe,[v(te,{text:"Editar Usuário","icon-path":"/storage/images/border_color.svg",onClick:i,class:"px-4 py-2 bg-[#F8F8F8] text-white rounded-lg"})])):b("",!0)])])),o.value?(l(),D(le,{key:1,isVisible:o.value,unidade:t.usuario,onCancelar:h},null,8,["isVisible","unidade"])):b("",!0)],64))}},Me=S(je,[["__scopeId","data-v-6d77c72d"]]),Ne={key:0,class:"sidebar-container"},Le={key:0,class:"loading-overlay"},ze={key:1,class:"w-full h-[525px] bg-white rounded-[20px] p-12"},Ae={class:"flex justify-center mb-6 relative group"},Qe=["src"],Re={key:1,src:"/storage/images/arrow_upload_ready.svg",alt:"Ícone de upload"},Te={class:"w-full relative"},Je=["selected"],Oe=["value"],Xe={class:"w-full relative"},Ze=["selected"],Ge=["value"],He={key:0,class:"error-message"},Ke={class:"form-buttons"},We={__name:"CadastroFranqueado",props:{isVisible:{type:Boolean,required:!0}},emits:["cancelar"],setup(t,{emit:o}){const i=ee(),h=o,p=u(""),r=u(""),n=u(""),m=u(""),f=u(""),q=u(null),x=u(null),B=u([]),_=u(null),P=u([]),w=u(null),k=u(!1),U=u(!1),j=u(""),A=async()=>{try{const d=await $.get("/api/unidades");B.value=d.data.map(s=>({id:s.unidade.id,name:s.unidade.cidade||"Unidade Sem Nome"}))}catch{i.error("Erro ao carregar unidades.")}},Q=async()=>{try{const d=await $.get("/api/cargos");P.value=d.data.map(s=>({id:s.id,name:s.name}))}catch{i.error("Erro ao carregar cargos.")}};A(),Q();const R=()=>{var d;(d=q.value)==null||d.click()},T=()=>{m.value="",i.info("Imagem removida.")},J=d=>{const s=d.target.files[0];if(s){w.value=s;const a=new FileReader;a.onload=()=>{m.value=a.result,i.success("Imagem carregada com sucesso!")},a.readAsDataURL(s)}},O=()=>{M(),h("cancelar")},M=()=>{p.value="",r.value="",n.value="",m.value="",x.value=null,_.value=null,w.value=null,f.value=""},X=()=>!p.value||!r.value||!n.value||!_.value?(i.error("Por favor, preencha todos os campos obrigatórios."),f.value="Por favor, preencha todos os campos obrigatórios.",!1):!0,N=async()=>{var d,s;if(X())try{k.value=!0;const a=new FormData;a.append("name",p.value),a.append("email",r.value),a.append("cpf",n.value),a.append("unidade_id",x.value),a.append("cargo_id",_.value),w.value&&a.append("profile_photo",w.value);const W=await $.post("/api/usuarios",a,{headers:{"Content-Type":"multipart/form-data"}});console.log("Dados cadastrados com sucesso:",W.data),i.success("Cadastro realizado com sucesso!"),ne.Inertia.visit("/franqueados"),M()}catch(a){i.error("Erro ao realizar o cadastro."),f.value=((s=(d=a.response)==null?void 0:d.data)==null?void 0:s.message)||"Erro ao realizar o cadastro."}finally{k.value=!1}},Z=d=>{let s=d.target.value.replace(/\D/g,"");s.length>11&&(s=s.slice(0,11)),s=s.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"),n.value=s},G=d=>{j.value=d,U.value=!0},H=()=>{N(),U.value=!1},K=()=>{U.value=!1};return(d,s)=>t.isVisible?(l(),c("div",Ne,[k.value?(l(),c("div",Le,s[7]||(s[7]=[e("div",{class:"spinner"},null,-1)]))):(l(),c("div",ze,[e("form",{onSubmit:F(N,["prevent"])},[e("div",Ae,[e("div",{class:"w-[110px] h-[110px] bg-[#f3f8f3] rounded-xl flex items-center justify-center cursor-pointer overflow-hidden relative",onClick:R},[m.value?(l(),c(y,{key:0},[e("img",{src:m.value,alt:"Imagem selecionada",class:"w-full h-full object-cover"},null,8,Qe),e("div",{class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",onClick:s[0]||(s[0]=F(()=>{},["stop"]))},[e("button",{onClick:F(T,["stop"]),class:"w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold text-sm"}," X ")])],64)):(l(),c("img",Re))]),e("input",{type:"file",ref_key:"fileInput",ref:q,accept:"image/*",class:"hidden",onChange:J},null,544)]),v(C,{text:"Nome Completo"}),v(V,{modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=a=>p.value=a),placeholder:"João Silva Souza"},null,8,["modelValue"]),v(C,{text:"E-mail"}),v(V,{modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=a=>r.value=a),placeholder:"usuario@email.com"},null,8,["modelValue"]),v(C,{text:"CPF"}),v(V,{modelValue:n.value,"onUpdate:modelValue":s[3]||(s[3]=a=>n.value=a),onInput:Z,placeholder:"000.000.000-00"},null,8,["modelValue"]),v(C,{text:"Unidade Responsável"}),e("div",Te,[E(e("select",{"onUpdate:modelValue":s[4]||(s[4]=a=>x.value=a),class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-gray-700 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[e("option",{value:"",disabled:"",selected:!x.value}," Selecione uma unidade ",8,Je),(l(!0),c(y,null,I(B.value,a=>(l(),c("option",{key:a.id,value:a.id},g(a.name),9,Oe))),128))],512),[[L,x.value]])]),v(C,{text:"Cargo"}),e("div",Xe,[E(e("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>_.value=a),class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-gray-700 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[e("option",{value:"",disabled:"",selected:!_.value}," Selecione um cargo ",8,Ze),(l(!0),c(y,null,I(P.value,a=>(l(),c("option",{key:a.id,value:a.id},g(a.name),9,Ge))),128))],512),[[L,_.value]])]),f.value?(l(),c("div",He,g(f.value),1)):b("",!0),v(ie,{isVisible:U.value,motivo:j.value,onConfirm:H,onCancel:K},null,8,["isVisible","motivo"]),e("div",Ke,[v(re,{text:"Cancelar",onClick:O}),v(z,{text:"Cadastrar",onClick:s[6]||(s[6]=a=>G("Criar novo Franqueado?"))})])],32)]))])):b("",!0)}},Ye=S(We,[["__scopeId","data-v-ffce48f3"]]),es={class:"grid grid-cols-1 gap-4 mt-3 sm:grid-cols-2"},ss={class:"flex flex-col gap-4"},as={class:"absolute bottom-4 right-4"},os={key:1,class:"mt-4"},ns={__name:"Index",setup(t){const o=u(null),i=u(!1),h=()=>{i.value=!i.value},p=()=>{r(),i.value=!1},r=()=>{var f;(f=u("listarUnidades").value)==null||f.fetchUnidades()},n=m=>{m&&typeof m=="object"?o.value=m:console.warn("Dados inválidos recebidos no evento usuario-selecionado:",m)};return(m,f)=>(l(),D(de,null,{default:se(()=>[v(ae(oe),{title:"Franqueados"}),e("div",es,[e("div",null,[v(Ce,{ref:"listarUnidades",onUnidadeCadastrada:r,onUsuarioSelecionado:n},null,512)]),e("div",ss,[i.value?(l(),c("div",os,[v(Ye,{isVisible:i.value,onUnidadeCadastrada:p,onCancelar:h},null,8,["isVisible"])])):(l(),c(y,{key:0},[o.value?(l(),D(Me,{key:0,usuario:o.value},null,8,["usuario"])):b("",!0),e("div",as,[v(z,{text:"Novo Franqueado",iconPath:"/storage/images/arrow_left_alt.svg",onClick:h})])],64))])])]),_:1}))}};export{ns as default};
