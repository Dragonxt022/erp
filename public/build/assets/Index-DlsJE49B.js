import{d,i as j,e as r,o as l,a as e,t as c,j as z,c as I,w as O,b as Y,f as J,u as U,Z as G,F as m,h as f,k as T}from"./app-DEOfEQ61.js";import{L as W}from"./LayoutFranqueado-Dbq0Xqcq.js";import{p as q}from"./chartjs-plugin-datalabels.esm-BIjjlP_n.js";import{C as B,A as H,p as Z,a as K,D as Q,P as X,b as ee,i as te}from"./chart-lMt0pmU3.js";import{d as L}from"./dayjs.min-D7euKn-l.js";import"./pt-br-3EmSUEBy.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"flex items-center space-x-2"},ae={class:"font-semibold text-gray-900 text-[17px]"},le={__name:"CalendarFilterDre",emits:["update-filters"],setup(S,{emit:x}){L.locale("pt-br");const h=x,i=d(L()),g=()=>{i.value=i.value.subtract(1,"month"),p()},y=()=>{i.value=i.value.add(1,"month"),p()},p=()=>{const w=i.value.startOf("month").format("DD-MM-YYYY"),n=i.value.endOf("month").format("DD-MM-YYYY");h("update-filters",{startDate:w,endDate:n})};return j(()=>{p()}),(w,n)=>(l(),r("div",se,[e("button",{onClick:g,class:"text-indigo-600 hover:underline"},n[0]||(n[0]=[e("img",{src:"/storage/images/arrow_drop_down_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)])),e("span",ae,c(i.value.format("MMMM YYYY")),1),e("button",{onClick:y,class:"text-indigo-600 hover:underline"},n[1]||(n[1]=[e("img",{src:"/storage/images/arrow_drop_direita_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)]))]))}},re={class:"flex justify-end mb-4"},ne={xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",style:{fill:"#018f7f",transform:"msfilter"}},de={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},ie={class:"flex items-center space-x-2 justify-end"},ue={class:"text-gray-900 text-[17px] font-semibold"},ce={class:"mt-5"},pe={class:"grid grid-cols-2 grid-rows-1 gap-4"},me={class:"rounded-lg"},ge={class:"w-full text-left text-[14px] border-collapse font-['Figtree']"},_e={key:0},fe={key:1},xe={class:"px-5 py-2 text-right valores"},he={class:"bg-[#174111] text-white"},ve={colspan:"2",class:"p-1 px-5"},be={key:0},ye={key:1},we={class:"p-1 px-5 categorias align-middle"},Fe={class:"px-5 py-1 text-right valores"},$e={class:"bg-[#174111] text-white"},De={colspan:"1",class:"p-2 text-right font-bold"},Ce={class:"mt-4 p-4 bg-green-100 text-green-800 rounded font-medium text-sm"},ke={class:"mt-5"},Re={class:"bg-white rounded-lg shadow"},Me={ref:"scrollContainer",class:"overflow-y-auto max-h-96 scroll-hidden"},Ae={class:"space-y-2"},Ye={key:0},Be={class:"text-center text-gray-600 font-semibold"},Le={class:"text-center text-gray-600 font-medium"},je={class:"text-center text-gray-600 font-semibold"},Se={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ne={class:"bg-white rounded-lg max-w-xl p-6 shadow-lg relative"},Pe={class:"text-gray-700 leading-relaxed text-sm whitespace-pre-line"},Ee={__name:"Index",setup(S){const x=d("0,00"),h=d("0,00"),i=d([]),g=d([]),y=d(""),p=d(!0),w=d("pie");let n=null;const D=d([]),C=d([]),F=d([]),k=d(!1),N=z(()=>V(g.value)),P=s=>{console.log("Filtros atualizados:",s),M(s.startDate,s.endDate)},M=async(s,t)=>{p.value=!0;try{const o=(await T.get("/api/painel-dre/analitycs-dre",{params:{start_date:s,end_date:t}})).data;x.value=o.total_caixas||"0,00",h.value=o.resultado_do_periodo||"0,00",i.value=o.grupos||[],g.value=o.calendario||[],y.value=o.explicacao_dre||[],C.value=o.grafico_data.labels||[],D.value=o.grafico_data.data||[],F.value=o.grafico_data.porcentagens||[],E()}catch(a){console.error("Erro ao buscar os dados do DRE:",a),x.value="0,00",h.value="0,00",i.value=[],g.value=[],C.value=[],D.value=[],F.value=[],n&&(n.destroy(),n=null)}finally{p.value=!1}};B.register(H,Z,K,Q,X,ee,te,q);const E=()=>{const s=document.getElementById("myChart");if(!s)return;const t=s.getContext("2d");n&&n.destroy();const a={type:w.value,data:{labels:C.value,datasets:[{data:D.value,backgroundColor:["#6DB631","#FF9500","#FF2D55","#5856D6","#F7464A","#FF7F50"],borderColor:void 0,borderWidth:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(o){const u=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.raw),_=F.value[o.dataIndex];return`${o.label}: ${u} (${_})`}}},legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,boxWidth:10}},datalabels:{display:!0,color:"#fff",formatter:(o,u)=>{const _=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),$=F.value[u.dataIndex];return`${_}
(${$})`},font:{weight:"bold",size:10},anchor:"end",align:"start",offset:10}},scales:{}}};n=new B(t,a)};j(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1).toLocaleDateString("pt-BR").split("/").join("-"),a=new Date(s.getFullYear(),s.getMonth()+1,0).toLocaleDateString("pt-BR").split("/").join("-");M(t,a)});const V=s=>{if(!s||s.length===0)return"";const t=new Date,a=t.getMonth()+1;t.getFullYear();const o=s.find(b=>b.nome_mes.toLowerCase()===A(a).toLowerCase()),u=s.find(b=>b.nome_mes.toLowerCase()===A(a-1).toLowerCase());if(!o)return"";const _=b=>Number(b.replace(/\./g,"").replace(",",".")),$=o?_(o.resultado_do_periodo):0,R=u?_(u.resultado_do_periodo):null;let v="";return R===null?v=`Ol√°! No m√™s de ${o.nome_mes}, seu resultado foi de R$ ${o.resultado_do_periodo}. Vamos continuar assim! üöÄ`:$>R?v=`Boa not√≠cia! Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) melhorou em rela√ß√£o a ${u.nome_mes} (R$ ${u.resultado_do_periodo}). Continue assim! üéâ`:$<R?v=`Aten√ß√£o: o resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° abaixo do m√™s anterior (${u.nome_mes} - R$ ${u.resultado_do_periodo}). Vamos analisar juntos para melhorar`:v=`Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° est√°vel em rela√ß√£o a ${u.nome_mes}. Seguimos firmes! üëç`,v},A=s=>{const t=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];return s<1&&(s=12+s),s>12&&(s=s%12),t[s-1]};return(s,t)=>(l(),I(W,null,{default:O(()=>[Y(U(G),{title:"Painel"}),t[13]||(t[13]=e("div",{class:"painel-title"},"DRE Gerencial",-1)),t[14]||(t[14]=e("div",{class:"painel-subtitle"},[e("p",null,"Acompanhe a sa√∫de da sua opera√ß√£o")],-1)),e("div",re,[e("button",{onClick:t[0]||(t[0]=a=>k.value=!0),class:"mr-2",placeholder:"Ajuda a entender esses gr√°ficos!"},[(l(),r("svg",ne,t[2]||(t[2]=[e("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"},null,-1)])))]),e("div",de,[e("div",ie,[e("span",ue,[Y(le,{onUpdateFilters:P})])])])]),e("div",ce,[e("div",pe,[e("div",me,[e("table",ge,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"bg-[#174111] text-white"},[e("th",{colspan:"2",class:"p-1 px-5"},"Faturamento do Per√≠odo")])],-1)),p.value?(l(),r("tbody",_e,[(l(),r(m,null,f(1,a=>e("tr",{key:a},t[3]||(t[3]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)]))),64))])):(l(),r("tbody",fe,[e("tr",null,[t[4]||(t[4]=e("td",{class:"p-1 px-5 categorias"},"Faturamento do Per√≠odo",-1)),e("td",xe," R$ "+c(x.value),1)])])),(l(!0),r(m,null,f(i.value,a=>(l(),r(m,{key:a.nome_grupo},[e("thead",null,[e("tr",he,[e("th",ve,c(a.nome_grupo),1)])]),p.value?(l(),r("tbody",be,[(l(!0),r(m,null,f(a.categorias.length||3,o=>(l(),r("tr",{key:o},t[5]||(t[5]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)])))),128))])):(l(),r("tbody",ye,[(l(!0),r(m,null,f(a.categorias,o=>(l(),r("tr",{key:o.categoria,class:"odd:bg-gray-100 even:bg-white p-1 px-5"},[e("td",we,c(o.categoria),1),e("td",Fe," R$ "+c(o.total),1)]))),128))]))],64))),128)),e("thead",null,[e("tr",$e,[t[6]||(t[6]=e("th",{colspan:"1",class:"p-2"},"Resultado do Per√≠odo",-1)),e("th",De," R$ "+c(h.value),1)])])])]),e("div",null,[t[11]||(t[11]=e("div",{class:"bg-white rounded-lg p-5 flex justify-center w-full h-[480px]"},[e("canvas",{id:"myChart"})],-1)),e("div",Ce,c(N.value),1),e("div",ke,[t[10]||(t[10]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"}," Hist√≥rico de Resultados ")],-1)),e("div",Re,[t[9]||(t[9]=e("div",{class:"bg-[#164110] grid grid-cols-3 gap-4 py-2 px-6 text-xs font-semibold text-[#FFFFFF] uppercase tracking-wider rounded-tl-2xl rounded-tr-2xl"},[e("span",{class:"text-center px-5"},"M√äS"),e("span",{class:"text-center"},"CMV"),e("span",{class:"text-center"},"RESULTADO")],-1)),e("div",Me,[e("ul",Ae,[p.value?(l(),r("li",Ye,[(l(),r(m,null,f(5,a=>e("div",{key:a,class:"grid grid-cols-3 gap-4 px-6 py-2"},t[8]||(t[8]=[e("span",{class:"shimmer h-5 w-3/4 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1)]))),64))])):(l(!0),r(m,{key:1},f(g.value,a=>(l(),r("li",{key:a.nome_mes,class:"hover:bg-gray-200 grid grid-cols-3 text-[15px] p-1"},[e("span",Be,c(a.nome_mes),1),e("span",Le," R$ "+c(a.valor_cmv),1),e("span",je," R$ "+c(a.resultado_do_periodo),1)]))),128))])],512)])])])])]),k.value?(l(),r("div",Se,[e("div",Ne,[e("button",{onClick:t[1]||(t[1]=a=>k.value=!1),class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-xl font-bold"}," √ó "),t[12]||(t[12]=e("h2",{class:"text-xl font-bold mb-4"},"Como funcionam os c√°lculos do DRE",-1)),e("p",Pe,c(y.value),1)])])):J("",!0)]),_:1}))}},Te=oe(Ee,[["__scopeId","data-v-fbeddde2"]]);export{Te as default};
