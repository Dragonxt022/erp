import{d,j as O,i as j,e as r,o as l,a as e,f as I,t as m,p as U,m as N,x as E,F as f,h,c as G,w as T,b as V,u as W,Z as q,k as H}from"./app-DkJ7DwOP.js";import{L as Z}from"./LayoutFranqueado-BIDaewFz.js";import{p as K}from"./chartjs-plugin-datalabels.esm-BIjjlP_n.js";import{C as z,A as Q,p as X,a as ee,D as te,P as oe,b as se,i as ae}from"./chart-lMt0pmU3.js";import{d as k}from"./dayjs.min-IXJumFU2.js";import"./pt-br-BrNEzpgZ.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"relative flex items-center space-x-2"},ne={class:"relative"},ie={class:"space-y-3"},de=["value"],ue=["value"],ce={__name:"CalendarFilterDre",emits:["update-filters"],setup(J,{emit:C}){k.locale("pt-br");const $=C,u=d(k()),c=d(!1),_=d(k().month()),g=d(k().year()),B=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],x=O(()=>{const v=k().year(),n=[];for(let i=v-10;i<=v+2;i++)n.push(i);return n}),F=()=>{u.value=u.value.subtract(1,"month"),y()},D=()=>{u.value=u.value.add(1,"month"),y()},b=()=>{c.value=!c.value,c.value&&(_.value=u.value.month(),g.value=u.value.year())},M=()=>{c.value=!1},P=()=>{u.value=k().year(g.value).month(_.value),c.value=!1,y()},y=()=>{const v=u.value.startOf("month").format("DD-MM-YYYY"),n=u.value.endOf("month").format("DD-MM-YYYY");$("update-filters",{startDate:v,endDate:n})};j(()=>{y()});const Y=v=>{c.value&&!v.target.closest(".relative")&&(c.value=!1)};return j(()=>{document.addEventListener("click",Y)}),(v,n)=>(l(),r("div",re,[e("button",{onClick:F,class:"text-indigo-600 hover:underline"},n[3]||(n[3]=[e("img",{src:"/storage/images/arrow_drop_down_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)])),e("div",ne,[e("span",{onClick:b,class:"font-semibold text-gray-900 text-[17px] cursor-pointer hover:text-[#6db631] transition-colors"},m(u.value.format("MMMM YYYY")),1),c.value?(l(),r("div",{key:0,class:"absolute right-[-33%] z-50 bg-white border rounded-lg shadow-lg p-4 mt-2 min-w-[250px]",onClick:n[2]||(n[2]=U(()=>{},["stop"]))},[e("div",ie,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"M√™s",-1)),N(e("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>_.value=i),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#6db631]"},[(l(),r(f,null,h(B,(i,s)=>e("option",{key:s,value:s},m(i),9,de)),64))],512),[[E,_.value]])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Ano",-1)),N(e("select",{"onUpdate:modelValue":n[1]||(n[1]=i=>g.value=i),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#6db631]"},[(l(!0),r(f,null,h(x.value,i=>(l(),r("option",{key:i,value:i},m(i),9,ue))),128))],512),[[E,g.value]])]),e("div",{class:"flex justify-end gap-2 pt-2"},[e("button",{onClick:M,class:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium"}," Cancelar "),e("button",{onClick:P,class:"px-4 py-2 text-sm bg-[#6db631] text-white rounded-md hover:bg-[#5a9929] font-medium"}," Aplicar ")])])])):I("",!0)]),e("button",{onClick:D,class:"text-indigo-600 hover:underline"},n[6]||(n[6]=[e("img",{src:"/storage/images/arrow_drop_direita_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)]))]))}},me={class:"flex justify-end mb-4"},pe={xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",style:{fill:"#018f7f",transform:"msfilter"}},ge={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},ve={class:"flex items-center space-x-2 justify-end"},fe={class:"text-gray-900 text-[17px] font-semibold"},xe={class:"mt-5"},he={class:"grid grid-cols-2 grid-rows-1 gap-4"},_e={class:"rounded-lg"},be={class:"w-full text-left text-[14px] border-collapse font-['Figtree']"},ye={key:0},we={key:1},ke={class:"px-5 py-2 text-right valores"},Ce={class:"bg-[#174111] text-white"},$e={colspan:"2",class:"p-1 px-5"},Fe={key:0},De={key:1},Me={class:"p-1 px-5 categorias align-middle"},Re={class:"px-5 py-1 text-right valores"},Ae={class:"bg-[#174111] text-white"},Ye={colspan:"1",class:"p-2 text-right font-bold"},Le={class:"mt-4 p-4 bg-green-100 text-green-800 rounded font-medium text-sm"},Be={class:"mt-5"},Pe={class:"bg-white rounded-lg shadow"},Se={ref:"scrollContainer",class:"overflow-y-auto max-h-96 scroll-hidden"},je={class:"space-y-2"},Ne={key:0},Ee={class:"text-center text-gray-600 font-semibold"},Ve={class:"text-center text-gray-600 font-medium"},ze={class:"text-center text-gray-600 font-semibold"},Oe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ie={class:"bg-white rounded-lg max-w-xl p-6 shadow-lg relative"},Je={class:"text-gray-700 leading-relaxed text-sm whitespace-pre-line"},Ue={__name:"Index",setup(J){const C=d("0,00"),$=d("0,00"),u=d([]),c=d([]),_=d(""),g=d(!0),B=d("pie");let x=null;const F=d([]),D=d([]),b=d([]),M=d(!1),P=O(()=>n(c.value)),y=s=>{console.log("Filtros atualizados:",s),Y(s.startDate,s.endDate)},Y=async(s,t)=>{g.value=!0;try{const o=(await H.get("/api/painel-dre/analitycs-dre",{params:{start_date:s,end_date:t}})).data;C.value=o.total_caixas||"0,00",$.value=o.resultado_do_periodo||"0,00",u.value=o.grupos||[],c.value=o.calendario||[],_.value=o.explicacao_dre||[],D.value=o.grafico_data.labels||[],F.value=o.grafico_data.data||[],b.value=o.grafico_data.porcentagens||[],v()}catch(a){console.error("Erro ao buscar os dados do DRE:",a),C.value="0,00",$.value="0,00",u.value=[],c.value=[],D.value=[],F.value=[],b.value=[],x&&(x.destroy(),x=null)}finally{g.value=!1}};z.register(Q,X,ee,te,oe,se,ae,K);const v=()=>{const s=document.getElementById("myChart");if(!s)return;const t=s.getContext("2d");x&&x.destroy();const a={type:B.value,data:{labels:D.value,datasets:[{data:F.value,backgroundColor:["#6DB631","#FF9500","#FF2D55","#5856D6","#F7464A","#FF7F50"],borderColor:void 0,borderWidth:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(o){const p=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.raw),w=b.value[o.dataIndex];return`${o.label}: ${p} (${w})`}}},legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,boxWidth:10}},datalabels:{display:!0,color:"#fff",formatter:(o,p)=>{const w=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),L=b.value[p.dataIndex];return`${w}
(${L})`},font:{weight:"bold",size:10},anchor:"end",align:"start",offset:10}},scales:{}}};x=new z(t,a)};j(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1).toLocaleDateString("pt-BR").split("/").join("-"),a=new Date(s.getFullYear(),s.getMonth()+1,0).toLocaleDateString("pt-BR").split("/").join("-");Y(t,a)});const n=s=>{if(!s||s.length===0)return"";const t=new Date,a=t.getMonth()+1;t.getFullYear();const o=s.find(A=>A.nome_mes.toLowerCase()===i(a).toLowerCase()),p=s.find(A=>A.nome_mes.toLowerCase()===i(a-1).toLowerCase());if(!o)return"";const w=A=>Number(A.replace(/\./g,"").replace(",",".")),L=o?w(o.resultado_do_periodo):0,S=p?w(p.resultado_do_periodo):null;let R="";return S===null?R=`Ol√°! No m√™s de ${o.nome_mes}, seu resultado foi de R$ ${o.resultado_do_periodo}. Vamos continuar assim! üöÄ`:L>S?R=`Boa not√≠cia! Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) melhorou em rela√ß√£o a ${p.nome_mes} (R$ ${p.resultado_do_periodo}). Continue assim! üéâ`:L<S?R=`Aten√ß√£o: o resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° abaixo do m√™s anterior (${p.nome_mes} - R$ ${p.resultado_do_periodo}). Vamos analisar juntos para melhorar`:R=`Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° est√°vel em rela√ß√£o a ${p.nome_mes}. Seguimos firmes! üëç`,R},i=s=>{const t=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];return s<1&&(s=12+s),s>12&&(s=s%12),t[s-1]};return(s,t)=>(l(),G(Z,null,{default:T(()=>[V(W(q),{title:"Painel"}),t[13]||(t[13]=e("div",{class:"painel-title"},"DRE Gerencial",-1)),t[14]||(t[14]=e("div",{class:"painel-subtitle"},[e("p",null,"Acompanhe a sa√∫de da sua opera√ß√£o")],-1)),e("div",me,[e("button",{onClick:t[0]||(t[0]=a=>M.value=!0),class:"mr-2",placeholder:"Ajuda a entender esses gr√°ficos!"},[(l(),r("svg",pe,t[2]||(t[2]=[e("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"},null,-1)])))]),e("div",ge,[e("div",ve,[e("span",fe,[V(ce,{onUpdateFilters:y})])])])]),e("div",xe,[e("div",he,[e("div",_e,[e("table",be,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"bg-[#174111] text-white"},[e("th",{colspan:"2",class:"p-1 px-5"},"Faturamento do Per√≠odo")])],-1)),g.value?(l(),r("tbody",ye,[(l(),r(f,null,h(1,a=>e("tr",{key:a},t[3]||(t[3]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)]))),64))])):(l(),r("tbody",we,[e("tr",null,[t[4]||(t[4]=e("td",{class:"p-1 px-5 categorias"},"Faturamento do Per√≠odo",-1)),e("td",ke," R$ "+m(C.value),1)])])),(l(!0),r(f,null,h(u.value,a=>(l(),r(f,{key:a.nome_grupo},[e("thead",null,[e("tr",Ce,[e("th",$e,m(a.nome_grupo),1)])]),g.value?(l(),r("tbody",Fe,[(l(!0),r(f,null,h(a.categorias.length||3,o=>(l(),r("tr",{key:o},t[5]||(t[5]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)])))),128))])):(l(),r("tbody",De,[(l(!0),r(f,null,h(a.categorias,o=>(l(),r("tr",{key:o.categoria,class:"odd:bg-gray-100 even:bg-white p-1 px-5"},[e("td",Me,m(o.categoria),1),e("td",Re," R$ "+m(o.total),1)]))),128))]))],64))),128)),e("thead",null,[e("tr",Ae,[t[6]||(t[6]=e("th",{colspan:"1",class:"p-2"},"Resultado do Per√≠odo",-1)),e("th",Ye," R$ "+m($.value),1)])])])]),e("div",null,[t[11]||(t[11]=e("div",{class:"bg-white rounded-lg p-5 flex justify-center w-full h-[480px]"},[e("canvas",{id:"myChart"})],-1)),e("div",Le,m(P.value),1),e("div",Be,[t[10]||(t[10]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"}," Hist√≥rico de Resultados ")],-1)),e("div",Pe,[t[9]||(t[9]=e("div",{class:"bg-[#164110] grid grid-cols-3 gap-4 py-2 px-6 text-xs font-semibold text-[#FFFFFF] uppercase tracking-wider rounded-tl-2xl rounded-tr-2xl"},[e("span",{class:"text-center px-5"},"M√äS"),e("span",{class:"text-center"},"CMV"),e("span",{class:"text-center"},"RESULTADO")],-1)),e("div",Se,[e("ul",je,[g.value?(l(),r("li",Ne,[(l(),r(f,null,h(5,a=>e("div",{key:a,class:"grid grid-cols-3 gap-4 px-6 py-2"},t[8]||(t[8]=[e("span",{class:"shimmer h-5 w-3/4 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1)]))),64))])):(l(!0),r(f,{key:1},h(c.value,a=>(l(),r("li",{key:a.nome_mes,class:"hover:bg-gray-200 grid grid-cols-3 text-[15px] p-1"},[e("span",Ee,m(a.nome_mes),1),e("span",Ve," R$ "+m(a.valor_cmv),1),e("span",ze," R$ "+m(a.resultado_do_periodo),1)]))),128))])],512)])])])])]),M.value?(l(),r("div",Oe,[e("div",Ie,[e("button",{onClick:t[1]||(t[1]=a=>M.value=!1),class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-xl font-bold"}," √ó "),t[12]||(t[12]=e("h2",{class:"text-xl font-bold mb-4"},"Como funcionam os c√°lculos do DRE",-1)),e("p",Je,m(_.value),1)])])):I("",!0)]),_:1}))}},Qe=le(Ue,[["__scopeId","data-v-fbeddde2"]]);export{Qe as default};
