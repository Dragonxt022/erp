import{d as n,i as V,j as z,c as J,o as l,w as O,b as S,a as e,e as r,f as T,u as U,Z as Y,F as u,h as m,t as i,k as G}from"./app-DAiSBrZd.js";import{L as W}from"./LayoutFranqueado-Di9HsLxs.js";import{p as q}from"./chartjs-plugin-datalabels.esm-BFtiKef5.js";import{C as L,A as H,p as Z,a as K,D as Q,P as X,b as ee,i as te}from"./chart-CX66tr7T.js";import{_ as oe}from"./CalendarFilterDre-D4EbOK0c.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dayjs.min-ofoZK7NO.js";import"./pt-br-BrJq68FE.js";const ae={class:"flex justify-end mb-4"},le={xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",style:{fill:"#018f7f",transform:"msfilter"}},re={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},ne={class:"flex items-center space-x-2 justify-end"},de={class:"text-gray-900 text-[17px] font-semibold"},ie={class:"mt-5"},ue={class:"grid grid-cols-2 grid-rows-1 gap-4"},ce={class:"rounded-lg"},pe={class:"w-full text-left text-[14px] border-collapse font-['Figtree']"},me={key:0},ge={key:1},_e={class:"px-5 py-2 text-right valores"},xe={class:"bg-[#174111] text-white"},fe={colspan:"2",class:"p-1 px-5"},he={key:0},ve={key:1},be={class:"p-1 px-5 categorias align-middle"},ye={class:"px-5 py-1 text-right valores"},we={class:"bg-[#174111] text-white"},Fe={colspan:"1",class:"p-2 text-right font-bold"},$e={class:"mt-4 p-4 bg-green-100 text-green-800 rounded font-medium text-sm"},Ce={class:"mt-5"},Re={class:"bg-white rounded-lg shadow"},ke={ref:"scrollContainer",class:"overflow-y-auto max-h-96 scroll-hidden"},De={class:"space-y-2"},Ae={key:0},Be={class:"text-center text-gray-600 font-semibold"},Se={class:"text-center text-gray-600 font-medium"},Le={class:"text-center text-gray-600 font-semibold"},Pe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},je={class:"bg-white rounded-lg max-w-xl p-6 shadow-lg relative"},Ne={class:"text-gray-700 leading-relaxed text-sm whitespace-pre-line"},Ee={__name:"Index",setup(Me){const b=n("0,00"),k=n("0,00"),y=n("0,00"),w=n([]),f=n([]),D=n(""),g=n(!0),P=n("pie");let c=null;const F=n([]),$=n([]),h=n([]),C=n(!1),j=V(()=>I(f.value)),N=s=>{console.log("Filtros atualizados:",s),A(s.startDate,s.endDate)},E=()=>{window.open("/relatorios/faturamento-anual","_blank")},A=async(s,t)=>{g.value=!0;try{const o=(await G.get("/api/painel-dre/analitycs-dre",{params:{start_date:s,end_date:t}})).data;console.log("DRE API Response:",o),console.log("Total Salarios from API:",o.total_salarios),b.value=o.total_caixas||"0,00",k.value=o.total_salarios||"0,00",y.value=o.resultado_do_periodo||"0,00",w.value=o.grupos||[],f.value=o.calendario||[],D.value=o.explicacao_dre||[],$.value=o.grafico_data.labels||[],F.value=o.grafico_data.data||[],h.value=o.grafico_data.porcentagens||[],M()}catch(a){console.error("Erro ao buscar os dados do DRE:",a),b.value="0,00",k.value="0,00",y.value="0,00",w.value=[],f.value=[],$.value=[],F.value=[],h.value=[],c&&(c.destroy(),c=null)}finally{g.value=!1}};L.register(H,Z,K,Q,X,ee,te,q);const M=()=>{const s=document.getElementById("myChart");if(!s)return;const t=s.getContext("2d");c&&c.destroy();const a={type:P.value,data:{labels:$.value,datasets:[{data:F.value,backgroundColor:["#6DB631","#FF9500","#FF2D55","#5856D6","#F7464A","#FF7F50"],borderColor:void 0,borderWidth:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(o){const d=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.raw),p=h.value[o.dataIndex];return`${o.label}: ${d} (${p})`}}},legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,boxWidth:10}},datalabels:{display:!0,color:"#fff",formatter:(o,d)=>{const p=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),v=h.value[d.dataIndex];return`${p}
(${v})`},font:{weight:"bold",size:10},anchor:"end",align:"start",offset:10}},scales:{}}};c=new L(t,a)};z(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1).toLocaleDateString("pt-BR").split("/").join("-"),a=new Date(s.getFullYear(),s.getMonth()+1,0).toLocaleDateString("pt-BR").split("/").join("-");A(t,a)});const I=s=>{if(!s||s.length===0)return"";const t=new Date,a=t.getMonth()+1;t.getFullYear();const o=s.find(x=>x.nome_mes.toLowerCase()===B(a).toLowerCase()),d=s.find(x=>x.nome_mes.toLowerCase()===B(a-1).toLowerCase());if(!o)return"";const p=x=>Number(x.replace(/\./g,"").replace(",",".")),v=o?p(o.resultado_do_periodo):0,R=d?p(d.resultado_do_periodo):null;let _="";return R===null?_=`Ol√°! No m√™s de ${o.nome_mes}, seu resultado foi de R$ ${o.resultado_do_periodo}. Vamos continuar assim! üöÄ`:v>R?_=`Boa not√≠cia! Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) melhorou em rela√ß√£o a ${d.nome_mes} (R$ ${d.resultado_do_periodo}). Continue assim! üéâ`:v<R?_=`Aten√ß√£o: o resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° abaixo do m√™s anterior (${d.nome_mes} - R$ ${d.resultado_do_periodo}). Vamos analisar juntos para melhorar`:_=`Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° est√°vel em rela√ß√£o a ${d.nome_mes}. Seguimos firmes! üëç`,_},B=s=>{const t=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];return s<1&&(s=12+s),s>12&&(s=s%12),t[s-1]};return(s,t)=>(l(),J(W,null,{default:O(()=>[S(U(Y),{title:"Painel"}),t[13]||(t[13]=e("div",{class:"painel-title"},"DRE Gerencial",-1)),t[14]||(t[14]=e("div",{class:"painel-subtitle"},[e("p",null,"Acompanhe a sa√∫de da sua opera√ß√£o")],-1)),e("div",ae,[e("button",{onClick:t[0]||(t[0]=a=>C.value=!0),class:"mr-2",placeholder:"Ajuda a entender esses gr√°ficos!"},[(l(),r("svg",le,t[2]||(t[2]=[e("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"},null,-1)])))]),e("button",{onClick:E,class:"mr-3 bg-[#174111] hover:bg-[#12330d] text-white font-bold py-1 px-3 rounded text-sm transition duration-300"}," Imprimir Relat√≥rio Anual "),e("div",re,[e("div",ne,[e("span",de,[S(oe,{onUpdateFilters:N})])])])]),e("div",ie,[e("div",ue,[e("div",ce,[e("table",pe,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"bg-[#174111] text-white"},[e("th",{colspan:"2",class:"p-1 px-5"},"Faturamento do Per√≠odo")])],-1)),g.value?(l(),r("tbody",me,[(l(),r(u,null,m(1,a=>e("tr",{key:a},t[3]||(t[3]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)]))),64))])):(l(),r("tbody",ge,[e("tr",null,[t[4]||(t[4]=e("td",{class:"p-1 px-5 categorias"},"Faturamento do Per√≠odo",-1)),e("td",_e," R$ "+i(b.value),1)])])),(l(!0),r(u,null,m(w.value,a=>(l(),r(u,{key:a.nome_grupo},[e("thead",null,[e("tr",xe,[e("th",fe,i(a.nome_grupo),1)])]),g.value?(l(),r("tbody",he,[(l(!0),r(u,null,m(a.categorias.length||3,o=>(l(),r("tr",{key:o},t[5]||(t[5]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)])))),128))])):(l(),r("tbody",ve,[(l(!0),r(u,null,m(a.categorias,o=>(l(),r("tr",{key:o.categoria,class:"odd:bg-gray-100 even:bg-white p-1 px-5"},[e("td",be,i(o.categoria),1),e("td",ye," R$ "+i(o.total),1)]))),128))]))],64))),128)),e("thead",null,[e("tr",we,[t[6]||(t[6]=e("th",{colspan:"1",class:"p-2"},"Resultado do Per√≠odo",-1)),e("th",Fe," R$ "+i(y.value),1)])])])]),e("div",null,[t[11]||(t[11]=e("div",{class:"bg-white rounded-lg p-5 flex justify-center w-full h-[480px]"},[e("canvas",{id:"myChart"})],-1)),e("div",$e,i(j.value),1),e("div",Ce,[t[10]||(t[10]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"}," Hist√≥rico de Resultados ")],-1)),e("div",Re,[t[9]||(t[9]=e("div",{class:"bg-[#164110] grid grid-cols-3 gap-4 py-2 px-6 text-xs font-semibold text-[#FFFFFF] uppercase tracking-wider rounded-tl-2xl rounded-tr-2xl"},[e("span",{class:"text-center px-5"},"M√äS"),e("span",{class:"text-center"},"CMV"),e("span",{class:"text-center"},"RESULTADO")],-1)),e("div",ke,[e("ul",De,[g.value?(l(),r("li",Ae,[(l(),r(u,null,m(5,a=>e("div",{key:a,class:"grid grid-cols-3 gap-4 px-6 py-2"},t[8]||(t[8]=[e("span",{class:"shimmer h-5 w-3/4 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1)]))),64))])):(l(!0),r(u,{key:1},m(f.value,a=>(l(),r("li",{key:a.nome_mes,class:"hover:bg-gray-200 grid grid-cols-3 text-[15px] p-1"},[e("span",Be,i(a.nome_mes),1),e("span",Se," R$ "+i(a.valor_cmv),1),e("span",Le," R$ "+i(a.resultado_do_periodo),1)]))),128))])],512)])])])])]),C.value?(l(),r("div",Pe,[e("div",je,[e("button",{onClick:t[1]||(t[1]=a=>C.value=!1),class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-xl font-bold"}," √ó "),t[12]||(t[12]=e("h2",{class:"text-xl font-bold mb-4"},"Como funcionam os c√°lculos do DRE",-1)),e("p",Ne,i(D.value),1)])])):T("",!0)]),_:1}))}},Ge=se(Ee,[["__scopeId","data-v-bb3055ca"]]);export{Ge as default};
