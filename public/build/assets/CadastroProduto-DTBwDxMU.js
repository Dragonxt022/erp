import{l as L,d as l,i as E,o as s,e as r,a as e,j as V,s as K,F as R,g as P,t as _,b as k,h as $,v as M,w as N,f as I,p as G,k as A,y as O,q as j,c as J}from"./app-nikgK0qS.js";import{_ as T,I as H,B as W,a as Q,d as X}from"./ButtonCancelar-BTyy3aOP.js";import{B as Y}from"./ButtonPrimary-Cfkpbydk.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={key:0,class:"w-[100%] h-full flex flex-col p-4 bg-gray-50"},ee={class:"mb-6 relative"},oe={class:"relative"},te=["value"],ae={class:"w-full bg-white rounded-lg p-6 mb-6"},se={class:"flex items-center"},re={class:"flex-shrink-0"},ne=["src"],le={class:"ml-6"},de={class:"text-2xl font-semibold text-gray-800"},ie={key:0,class:"text-red-500 text-sm text-center"},ue={class:"relative flex items-center w-full"},ce={class:"flex justify-end space-x-4"},ve={__name:"CadastrarInsumoEstoque",props:{produtoSelecionado:{type:Object,required:!1}},setup(y,{emit:q}){var B;const c=L(),h=q,v=y,p=l([]),f=l(""),d=l(""),m=l(((B=v.produtoSelecionado)==null?void 0:B.valor)||""),w=l(!1);l(!1);const C=l(!1),x=l(""),D=E(()=>v.produtoSelecionado.unidadeDeMedida==="a_granel"?"Kg":"Quantidade"),S=E(()=>v.produtoSelecionado.unidadeDeMedida==="a_granel"?"Digite o peso (ex: 1.5)":"Digite a quantidade"),o=()=>{let i=/^[0-9]+(\.[0-9]+)?$/;v.produtoSelecionado.unidadeDeMedida==="unidade"&&(i=/^[0-9]+$/),w.value=!i.test(d.value),v.produtoSelecionado.unidadeDeMedida==="a_granel"&&(d.value.includes(".")||(d.value=`${d.value}.0`))},t=()=>{const i=m.value.replace(/\D/g,""),n=i.slice(0,-2)||"0",g=i.slice(-2).padStart(2,"0");m.value=`R$ ${Number(n).toLocaleString("pt-BR")},${g}`},a=()=>{d.value="",m.value=""};(async()=>{try{const i=await A.get("/api/estoque/fornecedores");p.value=i.data.data.map(n=>({id:n.id||"N/D",razao_social:n.razao_social||"N/D"}))}catch(i){console.error("Erro ao carregar fornecedores:",i)}})();const b=i=>i?new URL(i,window.location.origin).href:"/storage/images/no_imagem.svg",z=()=>(x.value="",f.value?!d.value||w.value?(c.error("Quantidade inválida."),x.value="Quantidade inválida.",!1):!m.value||C.value?(c.error("Valor inválido."),x.value="Valor inválido.",!1):!0:(c.error("Fornecedor não selecionado."),x.value="Fornecedor não selecionado.",!1)),F=()=>{if(!z())return;const i={...v.produtoSelecionado,fornecedor_id:f.value,quantidade:d.value,valor:m.value,unidade_de_medida:v.produtoSelecionado.unidadeDeMedida};c.success("Inusmo adicionado"),a(),h("adicionarAoCarrinho",i)};return(i,n)=>y.produtoSelecionado?(s(),r("div",Z,[n[5]||(n[5]=e("h3",{class:"text-xl font-bold mb-4 text-gray-500"}," Estou recebendo os itens de ",-1)),e("div",ee,[e("div",oe,[V(e("select",{"onUpdate:modelValue":n[0]||(n[0]=g=>f.value=g),id:"fornecedor",class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-green-600 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[n[3]||(n[3]=e("option",{value:"",disabled:""},"Selecione um fornecedor",-1)),(s(!0),r(R,null,P(p.value,g=>(s(),r("option",{key:g.id,value:g.id},_(g.razao_social),9,te))),128))],512),[[K,f.value]])])]),e("div",ae,[e("div",se,[e("div",re,[e("img",{src:b(y.produtoSelecionado.profile_photo),alt:"Foto do Produto",class:"w-24 h-24 rounded-lg"},null,8,ne)]),e("div",le,[e("div",de,_(y.produtoSelecionado.nome||"N/A"),1)])])]),e("form",{onSubmit:G(F,["prevent"]),class:"space-y-4"},[e("div",null,[k(T,{text:D.value},null,8,["text"]),k(H,{modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=g=>d.value=g),placeholder:S.value,onInput:o},null,8,["modelValue","placeholder"]),w.value?(s(),r("p",ie," Insira um valor válido. ")):$("",!0)]),e("div",null,[k(T,{text:"Valor"}),e("div",ue,[V(e("input",{"onUpdate:modelValue":n[2]||(n[2]=g=>m.value=g),placeholder:"R$ 0,00",onInput:t,class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-gray-700 focus:ring-2 focus:ring-green-500 font-['Figtree']"},null,544),[[M,m.value]])])]),e("div",ce,[k(Y,{onClick:F},{default:N(()=>n[4]||(n[4]=[I("Adicionar")])),_:1})])],32)])):$("",!0)}},pe=U(ve,[["__scopeId","data-v-8e8bc66e"]]),fe={class:"flex gap-5"},me={key:0,class:"loading-overlay"},ge={class:"flex-1"},xe={class:"min-w-full table-auto"},_e=["onDblclick"],ye={class:"px-6 py-4 text-[16px] text-left text-gray-900 font-semibold"},he={class:"px-6 py-4 text-[16px] text-gray-900 font-semibold text-center"},be=["onUpdate:modelValue"],$e={key:1},ke={class:"px-6 py-4 text-[16px] text-gray-900 font-semibold text-left"},we={key:0},qe=["onUpdate:modelValue"],Ce={key:2},Ve={class:"px-6 py-4 text-[16px] text-gray-500 text-center"},De=["onUpdate:modelValue"],Se={key:1},Me={class:"px-6 py-4 text-center"},Ie=["onClick"],Re={key:0,class:"botao-container"},Ee={__name:"ResumoCarrinho",props:{carrinho:{type:Array,required:!0}},emits:["confirmar","cancelar"],setup(y,{emit:q}){const c=L(),h=y,v=q,p=l(!1),f=l(!1),d=l(null),m=o=>{h.carrinho.splice(o,1),c.info("Item removido com sucesso!")},w=o=>{d.value=o},C=o=>{const t=parseFloat((o.valor||"0").replace("R$","").replace(",","."));return o.quantidade>0?t/o.quantidade:0},x=o=>o.unidadeDeMedida==="a_granel"?C(o)*o.quantidade:o.quantidade*parseFloat(o.valor.replace("R$","").replace(",",".")),D=async()=>{var o;p.value=!0,f.value=!0;try{const t={fornecedor_id:((o=h.carrinho[0])==null?void 0:o.fornecedor_id)||null,itens:h.carrinho.map(u=>({id:u.id,nome:u.nome,quantidade:u.quantidade,unidadeDeMedida:u.unidadeDeMedida,valorUnitario:Math.round(parseFloat(u.valor.replace("R$","").replace(",","."))*100),total:Math.round(x(u)*100)}))};console.log("Dados enviados:",JSON.stringify(t,null,2));const a=await axios.post("/api/estoque/armazenar-entrada",t);a.status===201?(console.log("Resposta da API:",a.data),X.Inertia.visit(route("franqueado.inventario")),c.success("Lista de insumos salvas em seu estoque.")):c.error("Erro ao salvar no estoque, tente novamente.")}catch(t){console.error("Erro ao enviar entrada:",t),c.error("Erro ao confirmar entrada. Tente novamente ou chame o suporte.")}finally{p.value=!1}},S=()=>{v("cancelar")};return(o,t)=>(s(),r("div",fe,[p.value?(s(),r("div",me,t[0]||(t[0]=[e("div",{class:"spinner"},null,-1)]))):$("",!0),t[3]||(t[3]=e("div",{class:"flex-1"},[e("div",{class:"painel-title"},"Confirmar entrada"),e("div",{class:"painel-subtitle"},[e("p",null,"Vamos conferir se está tudo certo")]),e("div",{class:"mt-[25%] text-[#6d6d6d] text-[18px] font-normal font-['Figtree'] leading-[23px] tracking-tight"},[I(" Você confirma que está "),e("br"),I(" realizando uma nova entrada "),e("br"),I(" com os seguintes itens? ")])],-1)),e("div",ge,[e("table",xe,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-xs text-left font-medium text-gray-500 uppercase tracking-wider TrRedonEsquerda"}," Item "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," QTD. "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," V. UN/KG "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," TOTAL "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider TrRedonDireita"}," AÇÃO ")])],-1)),e("tbody",null,[(s(!0),r(R,null,P(y.carrinho,(a,u)=>(s(),r("tr",{key:a.id,onDblclick:b=>w(u)},[e("td",ye,_(a.nome),1),e("td",he,[d.value===u?V((s(),r("input",{key:0,type:"number","onUpdate:modelValue":b=>a.quantidade=b,class:"border border-gray-300 rounded px-2 py-1 w-16"},null,8,be)),[[M,a.quantidade,void 0,{number:!0}]]):(s(),r("span",$e,_(a.quantidade)+" "+_(a.unidadeDeMedida==="a_granel"?"KG":"UN"),1))]),e("td",ke,[a.unidadeDeMedida==="a_granel"?(s(),r("span",we," R$ "+_(C(a).toFixed(2)),1)):d.value===u?V((s(),r("input",{key:1,type:"text","onUpdate:modelValue":b=>a.valor=b,class:"border border-gray-300 rounded px-2 py-1 w-20"},null,8,qe)),[[M,a.valor]]):(s(),r("span",Ce,_(a.valor),1))]),e("td",Ve,[d.value===u&&a.unidadeDeMedida==="a_granel"?V((s(),r("input",{key:0,type:"number","onUpdate:modelValue":b=>a.valorTotal=b,class:"border border-gray-300 rounded px-2 py-1 w-20"},null,8,De)),[[M,a.valorTotal,void 0,{number:!0}]]):(s(),r("span",Se,_(x(a).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),1))]),e("td",Me,[e("button",{onClick:b=>m(u),class:"w-[16] h-[16]"},t[1]||(t[1]=[e("img",{src:"/storage/images/delete.svg",alt:"icone de excluir",class:"w-[16px] h-[16px]"},null,-1)]),8,Ie)])],40,_e))),128))])]),f.value?$("",!0):(s(),r("div",Re,[k(W,{text:"Voltar",onClick:S}),k(Q,{text:"Confirmar",onClick:D})]))])]))}},Pe=U(Ee,[["__scopeId","data-v-44b49a7a"]]),Ue={key:0},Fe={key:0,class:"sidebar-container"},Be={key:0,class:"loading-overlay"},Te={key:1,class:"flex"},Le={class:"flex-1 p-4"},Ne={class:"relative flex items-center w-full mb-4"},Ae={class:"space-y-4"},Qe=["onClick"],ze={class:"flex-shrink-0"},Ke=["src"],Ge={class:"ml-4 flex-1"},Oe={class:"text-lg font-semibold flex items-center"},je={key:0,class:"ml-5 text-xs bg-green-100 text-green-600 font-bold rounded-full px-2 py-1"},Je={key:1,class:"mr-2 ml-5 text-yellow-500",title:"Essa estrela sigifinica que esse insumo e um produto princial"},He={class:"absolute bottom-4 right-4 mt-5 botao-container"},We={class:"flex-1 p-4"},Xe={__name:"CadastroProduto",props:{isVisible:{type:Boolean,required:!0}},setup(y){const q=l([]),c=l(""),h=l(!1),v=l(null),p=l([]),f=l(!1),d=()=>{console.log("Entrada confirmada",p.value),mostrarModalRevisao.value=!1,p.value=[]},m=async()=>{h.value=!0;try{const o=await A.get("/api/produtos/lista");q.value=o.data}catch(o){console.error("Erro ao carregar os produtos:",o)}finally{h.value=!1}},w=o=>o?new URL(o,window.location.origin).href:"/storage/images/no_imagem.svg",C=o=>{v.value=o},x=o=>p.value.filter(t=>t.id===o).length,D=o=>{p.value.push(o),v.value=null},S=E(()=>q.value.filter(o=>o.nome.toLowerCase().includes(c.value.toLowerCase())));return O(m),(o,t)=>(s(),r(R,null,[k(j,{name:"fade"},{default:N(()=>[f.value?$("",!0):(s(),r("div",Ue,[y.isVisible?(s(),r("div",Fe,[h.value?(s(),r("div",Be,t[3]||(t[3]=[e("div",{class:"spinner"},null,-1)]))):(s(),r("div",Te,[e("div",Le,[t[5]||(t[5]=e("div",{class:"painel-title"},"Nova entrada",-1)),t[6]||(t[6]=e("div",{class:"painel-subtitle"},[e("p",null,"Adicione os itens que você recebeu ao estoque")],-1)),e("div",Ne,[t[4]||(t[4]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),V(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),placeholder:"Buscar um produto",class:"pl-10 w-full py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[M,c.value]])]),e("div",Ae,[(s(!0),r(R,null,P(S.value,a=>(s(),r("div",{key:a.id,class:"flex items-center p-4 bg-white rounded-lg cursor-pointer",onClick:u=>C(a)},[e("div",ze,[e("img",{src:w(a.profile_photo),alt:"Imagem do produto",class:"w-12 h-12 rounded-lg"},null,8,Ke)]),e("div",Ge,[e("div",Oe,[I(_(a.nome)+" ",1),x(a.id)>0?(s(),r("span",je,_(x(a.id)),1)):$("",!0),a.estrela?(s(),r("span",Je," ★ ")):$("",!0)])])],8,Qe))),128))])]),e("div",He,[k(Q,{text:"Finalizar",onClick:t[1]||(t[1]=a=>f.value=!0),iconPath:"/storage/images/arrow_left_alt.svg"})]),e("div",We,[k(pe,{produtoSelecionado:v.value,onAdicionarAoCarrinho:D},null,8,["produtoSelecionado"])])]))])):$("",!0)]))]),_:1}),f.value?(s(),J(Pe,{key:0,carrinho:p.value,onConfirmar:d,onCancelar:t[2]||(t[2]=a=>f.value=!1)},null,8,["carrinho"])):$("",!0)],64))}},to=U(Xe,[["__scopeId","data-v-4deae6b8"]]);export{to as C};
