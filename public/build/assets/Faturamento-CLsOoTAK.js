import{Q as B,d as f,i as D,j as R,c as I,o as r,w as A,b as x,a as t,u as N,Z as V,e as l,f as y,F as b,h as v,t as i,n as h,k as z}from"./app-Dt5SICIA.js";import{A as j}from"./LayoutFranqueadora-Dm0gjYAB.js";import{p as E}from"./chartjs-plugin-datalabels.esm-puCX0kls.js";import{C as _,B as L,c as S,b as U,L as $,p as M,a as P,i as Q}from"./chart-CQTgaRiN.js";import{U as T}from"./UnidadeSelectorDropdown-BuVs-1aV.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"flex flex-col md:flex-row justify-end items-center mb-6 gap-4"},q={class:"w-full md:w-64"},G={class:"mt-5"},H={class:"grid grid-cols-1 gap-6"},J={class:"bg-white rounded-xl p-6 shadow-sm border border-gray-100"},K={class:"h-[450px] relative"},W={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-10"},X={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},Y={class:"overflow-x-auto"},tt={class:"w-full text-left border-collapse"},et={key:0,class:"divide-y divide-gray-100"},at={key:1,class:"divide-y divide-gray-100"},st={class:"px-6 py-4"},ot={class:"flex flex-col"},rt={class:"font-bold text-gray-800"},lt={class:"text-xs text-gray-400"},nt={class:"px-6 py-4 text-right font-bold text-gray-900 text-base"},it={class:"px-6 py-4 text-right"},dt={key:0,class:"text-xs"},ct={key:1,class:"text-xs"},pt={class:"font-semibold"},ut={class:"px-6 py-4 text-right"},mt={__name:"Faturamento",setup(ft){_.register(L,S,U,$,M,P,Q,E);const w=B(),p=f(w.props.auth.user.unidade_id),c=f(!0),n=f([]);let u=null;const F=D(()=>[...n.value].reverse()),k=o=>{p.value=o,g()},g=async()=>{c.value=!0;try{const o=await z.get("/api/admin/painel/faturamento-analitico",{params:{unidade_id:p.value}});n.value=o.data.dados||[],C()}catch(o){console.error("Erro ao buscar faturamento analítico:",o)}finally{c.value=!1}},C=()=>{const o=document.getElementById("revenueChart");if(!o)return;u&&u.destroy();const a=n.value.map(e=>`${e.nome_mes.substring(0,3)}/${e.ano.substring(2)}`),s=n.value.map(e=>e.faturamento),m=n.value.map(e=>e.diferenca);u=new _(o,{type:"bar",data:{labels:a,datasets:[{label:"Faturamento",data:s,backgroundColor:"#164110",borderRadius:4,order:2,yAxisID:"y",datalabels:{color:"#164110",anchor:"end",align:"top",offset:4,font:{weight:"bold",size:10,family:"Figtree"},formatter:e=>e===0?"":new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(e)}},{label:"Variação",data:m,backgroundColor:n.value.map(e=>e.diferenca>=0?"#6DB631":"#FF2D55"),borderRadius:4,order:1,yAxisID:"y1",datalabels:{display:!0,color:e=>e.dataset.backgroundColor[e.dataIndex],anchor:"start",align:"bottom",offset:4,font:{weight:"bold",size:9,family:"Figtree"},formatter:e=>e===0?"":(e>0?"+":"")+new Intl.NumberFormat("pt-BR",{notation:"compact",maximumFractionDigits:1}).format(e)}}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{grid:{display:!1},ticks:{font:{family:"Figtree",weight:"600"}}},y:{type:"linear",display:!0,position:"left",grid:{color:"#f3f4f6"},ticks:{font:{family:"Figtree"},callback:e=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(e)}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},ticks:{font:{family:"Figtree"},callback:e=>new Intl.NumberFormat("pt-BR",{notation:"compact"}).format(e)}}},plugins:{legend:{display:!1},tooltip:{padding:12,backgroundColor:"#164110",titleFont:{family:"Figtree",size:14,weight:"bold"},bodyFont:{family:"Figtree",size:13},cornerRadius:8,callbacks:{label:function(e){let d=e.dataset.label||"";return d&&(d+=": "),e.parsed.y!==null&&(d+=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.parsed.y)),d}}}}}})};return R(()=>{g()}),(o,a)=>(r(),I(j,null,{default:A(()=>[x(N(V),{title:"Faturamento Analítico"}),a[6]||(a[6]=t("div",{class:"painel-title"},"Faturamento Analítico",-1)),a[7]||(a[7]=t("div",{class:"painel-subtitle"},[t("p",null,"Análise comparativa de faturamento dos últimos 12 meses")],-1)),t("div",Z,[t("div",q,[x(T,{"default-unit-id":p.value,onUnitSelected:k},null,8,["default-unit-id"])])]),t("div",G,[t("div",H,[t("div",J,[a[2]||(a[2]=t("div",{class:"flex items-center justify-between mb-8"},[t("div",null,[t("h3",{class:"text-xl font-bold text-gray-800"},"Evolução de 12 Meses"),t("p",{class:"text-sm text-gray-500"},"Comparativo mensal e variação nominal")]),t("div",{class:"flex flex-wrap gap-4"},[t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-4 h-4 bg-[#164110] rounded-sm shadow-sm"}),t("div",{class:"flex flex-col"},[t("span",{class:"text-xs font-bold text-gray-700"},"Faturamento"),t("span",{class:"text-[10px] text-gray-400"},"Total do mês")])]),t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-4 h-4 bg-[#6DB631] rounded-sm shadow-sm"}),t("div",{class:"flex flex-col"},[t("span",{class:"text-xs font-bold text-green-700"},"Crescimento"),t("span",{class:"text-[10px] text-gray-400"},"Variação positiva")])]),t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-4 h-4 bg-[#FF2D55] rounded-sm shadow-sm"}),t("div",{class:"flex flex-col"},[t("span",{class:"text-xs font-bold text-red-700"},"Queda"),t("span",{class:"text-[10px] text-gray-400"},"Variação negativa")])])])],-1)),t("div",K,[c.value?(r(),l("div",W,a[0]||(a[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#164110]"},null,-1)]))):y("",!0),a[1]||(a[1]=t("canvas",{id:"revenueChart"},null,-1))])]),t("div",X,[a[5]||(a[5]=t("div",{class:"p-6 border-b border-gray-50"},[t("h3",{class:"text-lg font-bold text-gray-800"},"Detalhamento Mensal")],-1)),t("div",Y,[t("table",tt,[a[4]||(a[4]=t("thead",null,[t("tr",{class:"bg-gray-50 text-[11px] font-bold text-gray-500 uppercase tracking-wider"},[t("th",{class:"px-6 py-4"},"Período"),t("th",{class:"px-6 py-4 text-right"},"Faturamento Total"),t("th",{class:"px-6 py-4 text-right"},"Variação Nominal"),t("th",{class:"px-6 py-4 text-right"},"Variação Percentual")])],-1)),c.value?(r(),l("tbody",et,[(r(),l(b,null,v(5,s=>t("tr",{key:s},a[3]||(a[3]=[t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-24 animate-pulse"})],-1),t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-20 animate-pulse ml-auto"})],-1),t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-20 animate-pulse ml-auto"})],-1),t("td",{class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-100 rounded w-16 animate-pulse ml-auto"})],-1)]))),64))])):(r(),l("tbody",at,[(r(!0),l(b,null,v(F.value,(s,m)=>(r(),l("tr",{key:m,class:"hover:bg-gray-50 transition-colors"},[t("td",st,[t("div",ot,[t("span",rt,i(s.nome_mes),1),t("span",lt,i(s.ano),1)])]),t("td",nt," R$ "+i(s.faturamento_formatado),1),t("td",it,[t("div",{class:h(["flex items-center justify-end gap-1",s.diferenca>=0?"text-green-600":"text-red-600"])},[s.diferenca>0?(r(),l("span",dt,"▲")):s.diferenca<0?(r(),l("span",ct,"▼")):y("",!0),t("span",pt,"R$ "+i(s.diferenca_formatada),1)],2)]),t("td",ut,[t("span",{class:h(["px-2 py-1 rounded-full text-xs font-bold",s.percentual>=0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},i(s.percentual>=0?"+":"")+i(s.percentual)+"% ",3)])]))),128))]))])])])])])]),_:1}))}},_t=O(mt,[["__scopeId","data-v-d5ea04e3"]]);export{_t as default};
