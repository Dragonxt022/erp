import{d,j as O,i as N,e as r,o as l,a as e,f as J,t as m,p as G,m as E,x as V,F as f,h,c as T,w as W,b as z,u as q,Z as H,k as Z}from"./app-DErQXHrG.js";import{L as K}from"./LayoutFranqueado-DnaGqKTL.js";import{p as Q}from"./chartjs-plugin-datalabels.esm-BIjjlP_n.js";import{C as I,A as X,p as ee,a as te,D as oe,P as se,b as ae,i as le}from"./chart-lMt0pmU3.js";import{d as k}from"./dayjs.min-60FyhBhu.js";import"./pt-br-DlXf38zh.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"relative flex items-center space-x-2"},ie={class:"relative"},de={class:"space-y-3"},ue=["value"],ce=["value"],me={__name:"CalendarFilterDre",emits:["update-filters"],setup(U,{emit:C}){k.locale("pt-br");const $=C,u=d(k()),c=d(!1),b=d(k().month()),g=d(k().year()),B=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],x=O(()=>{const v=k().year(),n=[];for(let i=v-10;i<=v+2;i++)n.push(i);return n}),F=()=>{u.value=u.value.subtract(1,"month"),y()},D=()=>{u.value=u.value.add(1,"month"),y()},_=()=>{c.value=!c.value,c.value&&(b.value=u.value.month(),g.value=u.value.year())},R=()=>{c.value=!1},P=()=>{u.value=k().year(g.value).month(b.value),c.value=!1,y()},y=()=>{const v=u.value.startOf("month").format("DD-MM-YYYY"),n=u.value.endOf("month").format("DD-MM-YYYY");$("update-filters",{startDate:v,endDate:n})};N(()=>{y()});const S=v=>{c.value&&!v.target.closest(".relative")&&(c.value=!1)};return N(()=>{document.addEventListener("click",S)}),(v,n)=>(l(),r("div",ne,[e("button",{onClick:F,class:"text-indigo-600 hover:underline"},n[3]||(n[3]=[e("img",{src:"/storage/images/arrow_drop_down_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)])),e("div",ie,[e("span",{onClick:_,class:"font-semibold text-gray-900 text-[17px] cursor-pointer hover:text-[#6db631] transition-colors"},m(u.value.format("MMMM YYYY")),1),c.value?(l(),r("div",{key:0,class:"absolute right-[-33%] z-50 bg-white border rounded-lg shadow-lg p-4 mt-2 min-w-[250px]",onClick:n[2]||(n[2]=G(()=>{},["stop"]))},[e("div",de,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"M√™s",-1)),E(e("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>b.value=i),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#6db631]"},[(l(),r(f,null,h(B,(i,M)=>e("option",{key:M,value:M},m(i),9,ue)),64))],512),[[V,b.value]])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Ano",-1)),E(e("select",{"onUpdate:modelValue":n[1]||(n[1]=i=>g.value=i),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#6db631]"},[(l(!0),r(f,null,h(x.value,i=>(l(),r("option",{key:i,value:i},m(i),9,ce))),128))],512),[[V,g.value]])]),e("div",{class:"flex justify-end gap-2 pt-2"},[e("button",{onClick:R,class:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium"}," Cancelar "),e("button",{onClick:P,class:"px-4 py-2 text-sm bg-[#6db631] text-white rounded-md hover:bg-[#5a9929] font-medium"}," Aplicar ")])])])):J("",!0)]),e("button",{onClick:D,class:"text-indigo-600 hover:underline"},n[6]||(n[6]=[e("img",{src:"/storage/images/arrow_drop_direita_circle.svg",alt:"icone drop",class:"w-5 h-5"},null,-1)]))]))}},pe={class:"flex justify-end mb-4"},ge={xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",style:{fill:"#018f7f",transform:"msfilter"}},ve={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},fe={class:"flex items-center space-x-2 justify-end"},xe={class:"text-gray-900 text-[17px] font-semibold"},he={class:"mt-5"},be={class:"grid grid-cols-2 grid-rows-1 gap-4"},_e={class:"rounded-lg"},ye={class:"w-full text-left text-[14px] border-collapse font-['Figtree']"},we={key:0},ke={key:1},Ce={class:"px-5 py-2 text-right valores"},$e={class:"bg-[#174111] text-white"},Fe={colspan:"2",class:"p-1 px-5"},De={key:0},Re={key:1},Me={class:"p-1 px-5 categorias align-middle"},Ae={class:"px-5 py-1 text-right valores"},Ye={class:"bg-[#174111] text-white"},Le={colspan:"1",class:"p-2 text-right font-bold"},Be={class:"mt-4 p-4 bg-green-100 text-green-800 rounded font-medium text-sm"},Pe={class:"mt-5"},Se={class:"bg-white rounded-lg shadow"},je={ref:"scrollContainer",class:"overflow-y-auto max-h-96 scroll-hidden"},Ne={class:"space-y-2"},Ee={key:0},Ve={class:"text-center text-gray-600 font-semibold"},ze={class:"text-center text-gray-600 font-medium"},Ie={class:"text-center text-gray-600 font-semibold"},Oe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Je={class:"bg-white rounded-lg max-w-xl p-6 shadow-lg relative"},Ue={class:"text-gray-700 leading-relaxed text-sm whitespace-pre-line"},Ge={__name:"Index",setup(U){const C=d("0,00"),$=d("0,00"),u=d([]),c=d([]),b=d(""),g=d(!0),B=d("pie");let x=null;const F=d([]),D=d([]),_=d([]),R=d(!1),P=O(()=>i(c.value)),y=s=>{console.log("Filtros atualizados:",s),v(s.startDate,s.endDate)},S=()=>{window.open("/relatorios/faturamento-anual","_blank")},v=async(s,t)=>{g.value=!0;try{const o=(await Z.get("/api/painel-dre/analitycs-dre",{params:{start_date:s,end_date:t}})).data;C.value=o.total_caixas||"0,00",$.value=o.resultado_do_periodo||"0,00",u.value=o.grupos||[],c.value=o.calendario||[],b.value=o.explicacao_dre||[],D.value=o.grafico_data.labels||[],F.value=o.grafico_data.data||[],_.value=o.grafico_data.porcentagens||[],n()}catch(a){console.error("Erro ao buscar os dados do DRE:",a),C.value="0,00",$.value="0,00",u.value=[],c.value=[],D.value=[],F.value=[],_.value=[],x&&(x.destroy(),x=null)}finally{g.value=!1}};I.register(X,ee,te,oe,se,ae,le,Q);const n=()=>{const s=document.getElementById("myChart");if(!s)return;const t=s.getContext("2d");x&&x.destroy();const a={type:B.value,data:{labels:D.value,datasets:[{data:F.value,backgroundColor:["#6DB631","#FF9500","#FF2D55","#5856D6","#F7464A","#FF7F50"],borderColor:void 0,borderWidth:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(o){const p=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.raw),w=_.value[o.dataIndex];return`${o.label}: ${p} (${w})`}}},legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,boxWidth:10}},datalabels:{display:!0,color:"#fff",formatter:(o,p)=>{const w=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),L=_.value[p.dataIndex];return`${w}
(${L})`},font:{weight:"bold",size:10},anchor:"end",align:"start",offset:10}},scales:{}}};x=new I(t,a)};N(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1).toLocaleDateString("pt-BR").split("/").join("-"),a=new Date(s.getFullYear(),s.getMonth()+1,0).toLocaleDateString("pt-BR").split("/").join("-");v(t,a)});const i=s=>{if(!s||s.length===0)return"";const t=new Date,a=t.getMonth()+1;t.getFullYear();const o=s.find(Y=>Y.nome_mes.toLowerCase()===M(a).toLowerCase()),p=s.find(Y=>Y.nome_mes.toLowerCase()===M(a-1).toLowerCase());if(!o)return"";const w=Y=>Number(Y.replace(/\./g,"").replace(",",".")),L=o?w(o.resultado_do_periodo):0,j=p?w(p.resultado_do_periodo):null;let A="";return j===null?A=`Ol√°! No m√™s de ${o.nome_mes}, seu resultado foi de R$ ${o.resultado_do_periodo}. Vamos continuar assim! üöÄ`:L>j?A=`Boa not√≠cia! Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) melhorou em rela√ß√£o a ${p.nome_mes} (R$ ${p.resultado_do_periodo}). Continue assim! üéâ`:L<j?A=`Aten√ß√£o: o resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° abaixo do m√™s anterior (${p.nome_mes} - R$ ${p.resultado_do_periodo}). Vamos analisar juntos para melhorar`:A=`Seu resultado em ${o.nome_mes} (R$ ${o.resultado_do_periodo}) est√° est√°vel em rela√ß√£o a ${p.nome_mes}. Seguimos firmes! üëç`,A},M=s=>{const t=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];return s<1&&(s=12+s),s>12&&(s=s%12),t[s-1]};return(s,t)=>(l(),T(K,null,{default:W(()=>[z(q(H),{title:"Painel"}),t[13]||(t[13]=e("div",{class:"painel-title"},"DRE Gerencial",-1)),t[14]||(t[14]=e("div",{class:"painel-subtitle"},[e("p",null,"Acompanhe a sa√∫de da sua opera√ß√£o")],-1)),e("div",pe,[e("button",{onClick:t[0]||(t[0]=a=>R.value=!0),class:"mr-2",placeholder:"Ajuda a entender esses gr√°ficos!"},[(l(),r("svg",ge,t[2]||(t[2]=[e("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"},null,-1)])))]),e("button",{onClick:S,class:"mr-3 bg-[#174111] hover:bg-[#12330d] text-white font-bold py-1 px-3 rounded text-sm transition duration-300"}," Imprimir Relat√≥rio Anual "),e("div",ve,[e("div",fe,[e("span",xe,[z(me,{onUpdateFilters:y})])])])]),e("div",he,[e("div",be,[e("div",_e,[e("table",ye,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"bg-[#174111] text-white"},[e("th",{colspan:"2",class:"p-1 px-5"},"Faturamento do Per√≠odo")])],-1)),g.value?(l(),r("tbody",we,[(l(),r(f,null,h(1,a=>e("tr",{key:a},t[3]||(t[3]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)]))),64))])):(l(),r("tbody",ke,[e("tr",null,[t[4]||(t[4]=e("td",{class:"p-1 px-5 categorias"},"Faturamento do Per√≠odo",-1)),e("td",Ce," R$ "+m(C.value),1)])])),(l(!0),r(f,null,h(u.value,a=>(l(),r(f,{key:a.nome_grupo},[e("thead",null,[e("tr",$e,[e("th",Fe,m(a.nome_grupo),1)])]),g.value?(l(),r("tbody",De,[(l(!0),r(f,null,h(a.categorias.length||3,o=>(l(),r("tr",{key:o},t[5]||(t[5]=[e("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),e("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)])))),128))])):(l(),r("tbody",Re,[(l(!0),r(f,null,h(a.categorias,o=>(l(),r("tr",{key:o.categoria,class:"odd:bg-gray-100 even:bg-white p-1 px-5"},[e("td",Me,m(o.categoria),1),e("td",Ae," R$ "+m(o.total),1)]))),128))]))],64))),128)),e("thead",null,[e("tr",Ye,[t[6]||(t[6]=e("th",{colspan:"1",class:"p-2"},"Resultado do Per√≠odo",-1)),e("th",Le," R$ "+m($.value),1)])])])]),e("div",null,[t[11]||(t[11]=e("div",{class:"bg-white rounded-lg p-5 flex justify-center w-full h-[480px]"},[e("canvas",{id:"myChart"})],-1)),e("div",Be,m(P.value),1),e("div",Pe,[t[10]||(t[10]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"}," Hist√≥rico de Resultados ")],-1)),e("div",Se,[t[9]||(t[9]=e("div",{class:"bg-[#164110] grid grid-cols-3 gap-4 py-2 px-6 text-xs font-semibold text-[#FFFFFF] uppercase tracking-wider rounded-tl-2xl rounded-tr-2xl"},[e("span",{class:"text-center px-5"},"M√äS"),e("span",{class:"text-center"},"CMV"),e("span",{class:"text-center"},"RESULTADO")],-1)),e("div",je,[e("ul",Ne,[g.value?(l(),r("li",Ee,[(l(),r(f,null,h(5,a=>e("div",{key:a,class:"grid grid-cols-3 gap-4 px-6 py-2"},t[8]||(t[8]=[e("span",{class:"shimmer h-5 w-3/4 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1),e("span",{class:"shimmer h-5 w-1/2 rounded"},null,-1)]))),64))])):(l(!0),r(f,{key:1},h(c.value,a=>(l(),r("li",{key:a.nome_mes,class:"hover:bg-gray-200 grid grid-cols-3 text-[15px] p-1"},[e("span",Ve,m(a.nome_mes),1),e("span",ze," R$ "+m(a.valor_cmv),1),e("span",Ie," R$ "+m(a.resultado_do_periodo),1)]))),128))])],512)])])])])]),R.value?(l(),r("div",Oe,[e("div",Je,[e("button",{onClick:t[1]||(t[1]=a=>R.value=!1),class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-xl font-bold"}," √ó "),t[12]||(t[12]=e("h2",{class:"text-xl font-bold mb-4"},"Como funcionam os c√°lculos do DRE",-1)),e("p",Ue,m(b.value),1)])])):J("",!0)]),_:1}))}},Xe=re(Ge,[["__scopeId","data-v-d17c155e"]]);export{Xe as default};
